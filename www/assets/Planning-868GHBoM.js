import{c as L,u as Z,j as e,k as U,C as I,l as se,i as V,m as ge,f as $,g as B,B as w,M as le,A as be,S as ue,n as q,o as Ie,p as Pe,a as Fe,h as ce,T as Be,P as qe,X as je,D as He}from"./index-BZdsEwY1.js";import{r as c,a as Ue,R as fe}from"./charts-CCOFnOOy.js";import{C as We}from"./CommunicationProgress-2rVILIWn.js";import{U as pe,C as re,S as ee}from"./Select-1Wfo6vyj.js";import{M as ye,P as _e,I as H}from"./Input-Q56iw-Sl.js";import{X as he,T as ke,C as Ce,D as Xe,l as Ze,V as Ge}from"./VisitActionModal-Cof0s5O_.js";import{P as Ye,S as Se}from"./star-C-Wji6MC.js";import{T as Te}from"./trash-2-Dvv6Z4GN.js";import{f as E,s as Je,g as Ke,h as Qe,j as et,k as tt,l as at,m as st,n as Me,q as rt,r as lt,t as nt,p as X}from"./utils-BQuD9tR2.js";import{A as it,R as dt,a as oe}from"./rotate-ccw-DkpDzPaY.js";import{S as Ve}from"./MessageGeneratorModal-C8TFbNyw.js";import"./react-vendor-B9D_A6Vq.js";import"./link-CZVQdni7.js";const ct=L("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const ot=L("BatteryCharging",[["path",{d:"M15 7h1a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2h-2",key:"1sdynx"}],["path",{d:"M6 7H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h1",key:"1gkd3k"}],["path",{d:"m11 7-3 5h4l-3 5",key:"b4a64w"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);const xt=L("BatteryFull",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"13",key:"c6fn6x"}]]);const mt=L("BatteryLow",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}]]);const gt=L("BatteryMedium",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}],["line",{x1:"6",x2:"6",y1:"11",y2:"13",key:"1wd6dw"}],["line",{x1:"10",x2:"10",y1:"11",y2:"13",key:"haxvl5"}]]);const ht=L("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const Ae=L("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const ut=L("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const pt=L("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const yt=L("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const bt=L("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const jt=L("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);const ft=L("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),kt=({isOpen:t,onClose:r,visit:a,onResolve:o})=>{const{visits:s,hosts:g}=Z(),[n,p]=c.useState(new Map),m=c.useMemo(()=>{const x=[],b=s.find(h=>h.id===a.id&&h.visitId!==a.visitId&&h.visitDate===a.visitDate&&h.status!=="cancelled");if(b&&x.push({id:"conflict-speaker-date",type:"speaker",severity:"critical",message:"Orateur dÃ©jÃ  programmÃ©",details:`${a.nom} est dÃ©jÃ  programmÃ© le ${new Date(a.visitDate).toLocaleDateString("fr-FR")}`,affectedVisit:b,suggestions:[{id:"suggest-reschedule",type:"reschedule",description:"Reprogrammer cette visite Ã  une autre date",impact:"medium"},{id:"suggest-cancel-other",type:"cancel",description:"Annuler l'autre visite",impact:"high"}]}),g.find(h=>h.nom===a.host)?.unavailableDates?.includes(a.visitDate)){const h=g.filter(S=>!S.unavailableDates?.includes(a.visitDate)&&S.gender===a.congregation);x.push({id:"conflict-host-unavailable",type:"host",severity:"warning",message:"HÃ´te indisponible",details:`${a.host} n'est pas disponible le ${new Date(a.visitDate).toLocaleDateString("fr-FR")}`,suggestions:h.slice(0,3).map((S,A)=>({id:`suggest-host-${A}`,type:"change_host",description:`Assigner Ã  ${S.nom}`,newHost:S,impact:"low"}))})}const j=s.find(h=>h.visitId!==a.visitId&&h.talkNoOrType===a.talkNoOrType&&h.status==="completed"&&Math.abs(new Date(h.visitDate).getTime()-new Date(a.visitDate).getTime())<2160*60*60*1e3);j&&a.talkNoOrType&&x.push({id:"conflict-talk-recent",type:"talk",severity:"info",message:"Discours rÃ©cemment donnÃ©",details:`Le discours ${a.talkNoOrType} a Ã©tÃ© donnÃ© il y a moins de 3 mois`,affectedVisit:j,suggestions:[{id:"suggest-different-talk",type:"change_speaker",description:"Choisir un autre discours",impact:"low"},{id:"suggest-ignore",type:"reschedule",description:"Continuer quand mÃªme",impact:"low"}]});const f=s.filter(h=>{const S=new Date(h.visitDate),A=new Date(a.visitDate);return S.getMonth()===A.getMonth()&&S.getFullYear()===A.getFullYear()&&h.status!=="cancelled"});return f.length>5&&x.push({id:"conflict-overload",type:"date",severity:"warning",message:"Charge Ã©levÃ©e ce mois",details:`${f.length} visites programmÃ©es ce mois`,suggestions:[{id:"suggest-next-month",type:"reschedule",description:"DÃ©placer au mois suivant",impact:"medium"}]}),x},[a,s,g]),y=x=>{switch(x){case"critical":return"text-red-600 bg-red-100 dark:bg-red-900/20";case"warning":return"text-orange-600 bg-orange-100 dark:bg-orange-900/20";case"info":return"text-blue-600 bg-blue-100 dark:bg-blue-900/20"}},N=x=>{switch(x){case"critical":return e.jsx(he,{className:"w-5 h-5"});case"warning":return e.jsx(se,{className:"w-5 h-5"});case"info":return e.jsx(ge,{className:"w-5 h-5"})}},C=(x,b)=>{p(D=>{const j=new Map(D);return j.set(x,b),j})},k=()=>{n.forEach((x,b)=>{o&&o({conflictId:b,suggestionId:x,action:"apply"})}),r()};return e.jsx(U,{isOpen:t,onClose:r,title:"DÃ©tection de Conflits",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(I,{className:"w-6 h-6 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:a.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(a.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," Ã  ",a.visitTime]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[m.length," conflit",m.length>1?"s":""," dÃ©tectÃ©",m.length>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(V,{variant:"danger",children:[m.filter(x=>x.severity==="critical").length," critique",m.filter(x=>x.severity==="critical").length>1?"s":""]}),e.jsxs(V,{variant:"warning",children:[m.filter(x=>x.severity==="warning").length," avertissement",m.filter(x=>x.severity==="warning").length>1?"s":""]})]})]}),m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun conflit dÃ©tectÃ©"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Cette visite peut Ãªtre programmÃ©e sans problÃ¨me"})]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:m.map(x=>e.jsx($,{className:`border-l-4 ${x.severity==="critical"?"border-l-red-600":x.severity==="warning"?"border-l-orange-500":"border-l-blue-500"}`,children:e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${y(x.severity)}`,children:N(x.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:x.message}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:x.details})]})]}),x.suggestions.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Solutions suggÃ©rÃ©es :"}),x.suggestions.map(b=>e.jsx("button",{onClick:()=>C(x.id,b.id),className:`w-full text-left p-3 rounded-lg border-2 transition-all ${n.get(x.id)===b.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:b.description})]}),e.jsxs(V,{variant:b.impact==="high"?"danger":b.impact==="medium"?"warning":"default",children:["Impact ",b.impact==="high"?"Ã©levÃ©":b.impact==="medium"?"moyen":"faible"]})]})},b.id))]})]})},x.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(w,{variant:"secondary",onClick:r,children:"Annuler"}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:()=>{m.forEach(x=>{o&&o({conflictId:x.id,suggestionId:"",action:"ignore"})}),r()},children:"Ignorer les conflits"}),e.jsxs(w,{variant:"primary",onClick:k,disabled:n.size===0,children:["Appliquer les solutions (",n.size,")"]})]})]})]})})},xe=[{value:"speaker_unavailable",label:"Orateur indisponible",icon:"ðŸ‘¤"},{value:"host_unavailable",label:"HÃ´te indisponible",icon:"ðŸ "},{value:"congregation_conflict",label:"Conflit de congrÃ©gation",icon:"âš ï¸"},{value:"weather",label:"Conditions mÃ©tÃ©o",icon:"ðŸŒ§ï¸"},{value:"health",label:"Raisons de santÃ©",icon:"ðŸ¥"},{value:"emergency",label:"Urgence",icon:"ðŸš¨"},{value:"duplicate",label:"Doublon dÃ©tectÃ©",icon:"ðŸ“‹"},{value:"other",label:"Autre raison",icon:"ðŸ“"}],Nt=({isOpen:t,onClose:r,visit:a,onCancel:o})=>{const[s,g]=c.useState(null),[n,p]=c.useState(""),[m,y]=c.useState(!0),[N,C]=c.useState(!0),[k,x]=c.useState(!1),[b,D]=c.useState(""),[j,f]=c.useState(""),[h,S]=c.useState(!1),A=()=>{if(!s)return;const l={visitId:a.visitId,reason:s,customReason:s==="other"?n:void 0,notifySpeaker:m,notifyHost:N,proposeReschedule:k,suggestedNewDate:k?b:void 0,internalNotes:j,cancelledBy:"Coordinateur",cancelledAt:new Date().toISOString()};o(l),r()},P=()=>{const l=xe.find(d=>d.value===s);return`Bonjour ${a.nom},

Nous sommes au regret de vous informer que la visite prÃ©vue le ${new Date(a.visitDate).toLocaleDateString("fr-FR")} doit Ãªtre annulÃ©e.

Raison : ${l?.label}${s==="other"&&n?` - ${n}`:""}

${k&&b?`Nous vous proposons de reprogrammer cette visite le ${new Date(b).toLocaleDateString("fr-FR")}.

`:""}Nous vous contacterons prochainement pour convenir d'une nouvelle date.

Cordialement,
KBV Lyon`};return h?e.jsx(U,{isOpen:t,onClose:r,title:"Confirmer l'annulation",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(se,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200 mb-2",children:"Attention : Action irrÃ©versible"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:"Vous Ãªtes sur le point d'annuler dÃ©finitivement cette visite. Cette action ne peut pas Ãªtre annulÃ©e."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Orateur"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.nom})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Date"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:new Date(a.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Raison"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:xe.find(l=>l.value===s)?.label})]})]}),(m||N)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Notifications Ã  envoyer"})]}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-1",children:[m&&e.jsxs("li",{children:["â€¢ Notification Ã  l'orateur (",a.nom,")"]}),N&&e.jsxs("li",{children:["â€¢ Notification Ã  l'hÃ´te (",a.host,")"]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(w,{variant:"secondary",onClick:()=>S(!1),children:"Retour"}),e.jsxs(w,{variant:"danger",onClick:A,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Confirmer l'annulation"]})]})]})}):e.jsx(U,{isOpen:t,onClose:r,title:"Annuler une visite",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(I,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:a.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(a.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," Ã  ",a.visitTime]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Discours :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:a.talkNoOrType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"HÃ´te :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:a.host})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Raison de l'annulation *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:xe.map(l=>e.jsx("button",{onClick:()=>g(l.value),className:`p-3 rounded-lg border-2 text-left transition-all ${s===l.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:l.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:l.label})]})},l.value))})]}),s==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"PrÃ©cisez la raison"}),e.jsx("textarea",{value:n,onChange:l=>p(l.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,placeholder:"DÃ©crivez la raison de l'annulation..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notifications"}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:l=>y(l.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'orateur"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation Ã  ",a.nom]})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:l=>C(l.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'hÃ´te"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation Ã  ",a.host]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:l=>x(l.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Proposer une reprogrammation"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"SuggÃ©rer une nouvelle date dans le message d'annulation"})]})]}),k&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouvelle date proposÃ©e"}),e.jsx("input",{type:"date",value:b,onChange:l=>D(l.target.value),min:new Date().toISOString().split("T")[0],"aria-label":"Nouvelle date proposÃ©e",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes internes (optionnel)"}),e.jsx("textarea",{value:j,onChange:l=>f(l.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:2,placeholder:"Notes pour l'Ã©quipe (non envoyÃ©es aux participants)..."})]}),(m||N)&&s&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"AperÃ§u du message"})]}),e.jsx("pre",{className:"text-xs text-blue-800 dark:text-blue-300 whitespace-pre-wrap font-sans",children:P()})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(w,{variant:"secondary",onClick:r,children:"Annuler"}),e.jsxs(w,{variant:"danger",onClick:()=>S(!0),disabled:!s||s==="other"&&!n,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Annuler la visite"]})]})]})})},vt=({isOpen:t,onClose:r,visit:a,onSelectReplacement:o})=>{const{speakers:s,visits:g}=Z(),[n,p]=c.useState(""),[m,y]=c.useState(!1),[N,C]=c.useState(!0),[k,x]=c.useState(null),[b,D]=c.useState(!0),[j,f]=c.useState(!1),h=c.useMemo(()=>{const l=[];return s.forEach(d=>{if(d.id===a.id)return;let u=0;const v=[],W=[],_=d.talkHistory.map(T=>T.talkNo.toString());if(a.talkNoOrType&&_.includes(a.talkNoOrType)?(u+=50,v.push("PossÃ¨de le mÃªme discours"),W.push(a.talkNoOrType)):_.forEach(T=>W.push(T)),!g.some(T=>T.id===d.id&&T.visitDate===a.visitDate&&T.status!=="cancelled"))u+=30,v.push("Disponible Ã  cette date");else{if(N)return;v.push("âš ï¸ DÃ©jÃ  programmÃ© ce jour")}d.congregation===a.congregation&&(u+=20,v.push("MÃªme congrÃ©gation")),g.filter(T=>T.id===d.id&&T.status==="completed"&&new Date(T.visitDate)>new Date(Date.now()-2160*60*60*1e3)).length===0&&(u+=15,v.push("Pas de visite rÃ©cente")),d.isVehiculed&&(u+=10,v.push("VÃ©hiculÃ©")),d.telephone&&(u+=5,v.push("TÃ©lÃ©phone disponible"));const Y=g.filter(T=>T.id===d.id&&T.status==="completed").sort((T,J)=>new Date(J.visitDate).getTime()-new Date(T.visitDate).getTime())[0];l.push({speaker:d,score:u,reasons:v,availableTalks:W,lastVisit:Y?.visitDate})}),l.sort((d,u)=>u.score-d.score).filter(d=>n?d.speaker.nom.toLowerCase().includes(n.toLowerCase())||d.speaker.congregation.toLowerCase().includes(n.toLowerCase()):!0)},[s,g,a,n,N]),S=()=>{k&&(o(k,b),r())},A=l=>l>=80?"text-green-600 bg-green-100 dark:bg-green-900/20":l>=50?"text-blue-600 bg-blue-100 dark:bg-blue-900/20":l>=30?"text-orange-600 bg-orange-100 dark:bg-orange-900/20":"text-gray-600 bg-gray-100 dark:bg-gray-900/20",P=l=>l>=80?"Excellent match":l>=50?"Bon match":l>=30?"Match acceptable":"Match faible";return e.jsx(U,{isOpen:t,onClose:r,title:"Trouver un remplaÃ§ant d'urgence",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(be,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200",children:"Remplacement d'urgence requis"}),e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300 mt-1",children:["Visite de ",e.jsx("strong",{children:a.nom})," le"," ",e.jsx("strong",{children:new Date(a.visitDate).toLocaleDateString("fr-FR")})," Ã "," ",e.jsx("strong",{children:a.visitTime})]}),a.talkNoOrType&&e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300",children:["Discours : ",e.jsx("strong",{children:a.talkNoOrType})," - ",a.talkTheme]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:l=>p(l.target.value),placeholder:"Rechercher un orateur...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs(w,{variant:"outline",onClick:()=>f(!j),children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Filtres"]})]}),j&&e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:l=>C(l.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Uniquement disponibles"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:l=>y(l.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"ProximitÃ© gÃ©ographique"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:h.length}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Orateurs trouvÃ©s"})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.filter(l=>l.score>=50).length}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:"Bons matchs"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h.filter(l=>l.availableTalks.includes(a.talkNoOrType||"")).length}),e.jsx("div",{className:"text-sm text-purple-800 dark:text-purple-300",children:"MÃªme discours"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun orateur trouvÃ©"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Essayez de modifier vos critÃ¨res de recherche"})]}):h.map(l=>e.jsx($,{hoverable:!0,className:`cursor-pointer transition-all ${k?.id===l.speaker.id?"ring-2 ring-primary-500 bg-primary-50 dark:bg-primary-900/20":""}`,onClick:()=>x(l.speaker),children:e.jsx(B,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:l.speaker.nom.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:l.speaker.nom}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(ye,{className:"w-3 h-3"}),l.speaker.congregation]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:l.reasons.map((d,u)=>e.jsx(V,{variant:"default",className:"text-xs",children:d},u))}),l.availableTalks.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Discours : "}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[l.availableTalks.slice(0,5).join(", "),l.availableTalks.length>5&&` +${l.availableTalks.length-5}`]})]}),l.speaker.telephone&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(_e,{className:"w-3 h-3"}),l.speaker.telephone]}),l.lastVisit&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 dark:text-gray-500",children:[e.jsx(I,{className:"w-3 h-3"}),"DerniÃ¨re visite : ",new Date(l.lastVisit).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full ${A(l.score)}`,children:e.jsx("span",{className:"text-lg font-bold",children:l.score})}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:P(l.score)})]})]})})},l.speaker.id))}),k&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:l=>D(l.target.checked),className:"mt-1 w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Envoyer une notification immÃ©diate"})]}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300 mt-1",children:["Un message sera envoyÃ© Ã  ",k.nom," pour l'informer du remplacement d'urgence"]})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(w,{variant:"secondary",onClick:r,children:"Annuler"}),e.jsxs(w,{variant:"primary",onClick:S,disabled:!k,children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"SÃ©lectionner ce remplaÃ§ant"]})]})]})})},wt=({visit:t,onClick:r,onAction:a})=>{const[o,s]=c.useState(!1),g=c.useRef(null),n=y=>{switch(y){case"confirmed":return e.jsx(V,{variant:"success",size:"sm",children:"ConfirmÃ©"});case"pending":return e.jsx(V,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(V,{variant:"default",size:"sm",children:"TerminÃ©"});case"cancelled":return e.jsx(V,{variant:"danger",size:"sm",children:"AnnulÃ©"});default:return e.jsx(V,{variant:"default",size:"sm",children:y})}},p=(y,N)=>{N.stopPropagation(),a&&a(t,y),s(!1)},m=[{action:"edit",label:"Modifier",icon:Ye,color:"text-blue-600"},{action:"message",label:"Envoyer un message",icon:le,color:"text-green-600"},{action:"expenses",label:"DÃ©penses",icon:Ce,color:"text-purple-600"},{action:"logistics",label:"Logistique",icon:ke,color:"text-blue-500"},{action:"status",label:"Changer le statut",icon:ge,color:"text-orange-600"},{action:"feedback",label:"Bilan",icon:Se,color:"text-yellow-500"},{action:"delete",label:"Supprimer",icon:Te,color:"text-red-600"}];return e.jsx($,{hoverable:!0,className:"h-full relative overflow-visible",onClick:r,children:e.jsxs(B,{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-sm",children:t.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm line-clamp-1",children:t.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.congregation})]})]}),n(t.status)]}),e.jsxs("div",{className:"space-y-2 mb-4 flex-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(I,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"capitalize",children:E(new Date(t.visitDate),"EEEE d MMMM yyyy",{locale:q})})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(re,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:t.visitTime})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(ye,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"line-clamp-1",children:t.locationType==="physical"?"Salle du Royaume":"VisioconfÃ©rence"})]}),t.host&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(pe,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsxs("span",{className:"line-clamp-1",children:["Chez ",t.host]})]}),t.logistics?.checklist&&t.logistics.checklist.some(y=>!y.isCompleted)&&e.jsxs("div",{className:"flex items-center text-xs text-orange-600 dark:text-orange-400 mt-1",children:[e.jsx(ke,{className:"w-3 h-3 mr-2"}),e.jsx("span",{children:"Logistique Ã  complÃ©ter"})]})]}),e.jsx("div",{className:"pt-3 mt-3 border-t border-gray-100 dark:border-gray-700",children:e.jsx(We,{visit:t,size:"sm"})}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"text-xs font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded inline-block mb-1",children:["Discours nÂ°",t.talkNoOrType]}),t.talkTheme&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2 mt-1",children:t.talkTheme})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:g,"aria-label":"Options",className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:y=>{y.stopPropagation(),s(!o)},children:e.jsx(bt,{className:"w-4 h-4"})}),o&&Ue.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/20 backdrop-blur-sm",onClick:y=>{y.stopPropagation(),s(!1)}}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl z-50 w-72 overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:e.jsx("div",{className:"p-2",children:m.map(y=>e.jsxs("button",{className:"w-full px-4 py-3 text-left text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3 transition-colors mb-1 last:mb-0",onClick:N=>p(y.action,N),children:[e.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${y.color.replace("text-","bg-")}`,children:e.jsx(y.icon,{className:`w-5 h-5 ${y.color}`})}),y.label]},y.action))})})]}),document.body)]})]})]})})},Dt=({visits:t,onVisitClick:r,onVisitAction:a})=>t.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouvÃ©e pour cette pÃ©riode."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:t.map((o,s)=>e.jsx(wt,{visit:o,onClick:()=>r?.(o),onAction:a},`${o.id}-${s}`))}),Ct=({visits:t,onVisitClick:r,onVisitAction:a})=>{const o=s=>{switch(s){case"confirmed":return e.jsx(V,{variant:"success",size:"sm",children:"ConfirmÃ©"});case"pending":return e.jsx(V,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(V,{variant:"default",size:"sm",children:"TerminÃ©"});case"cancelled":return e.jsx(V,{variant:"danger",size:"sm",children:"AnnulÃ©"});default:return e.jsx(V,{variant:"default",size:"sm",children:s})}};return t.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouvÃ©e pour cette pÃ©riode."})}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Orateur"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Discours"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Lieu / HÃ´te"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:t.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:()=>r?.(s),children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:E(new Date(s.visitDate),"dd/MM/yyyy")}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.visitTime})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-xs mr-3",children:s.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.nom}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.congregation})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:["NÂ°",s.talkNoOrType]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:s.talkTheme})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:s.locationType==="physical"?"Salle du Royaume":"VisioconfÃ©rence"}),s.host&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Chez ",s.host]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:o(s.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 p-1",onClick:g=>{g.stopPropagation(),a?.(s,"edit")},title:"Modifier",children:e.jsx(jt,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 p-1",onClick:g=>{g.stopPropagation(),a?.(s,"message")},title:"Message",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-red-600 dark:hover:text-red-400 p-1",onClick:g=>{g.stopPropagation(),a?.(s,"delete")},title:"Supprimer",children:e.jsx(Te,{className:"w-4 h-4"})})]})})]},s.id))})]})})})},St=({visits:t,onVisitClick:r})=>{const[a,o]=c.useState(new Date),s=()=>o(rt(a,1)),g=()=>o(Me(a,1)),n=()=>o(new Date),p=Je(a),m=Ke(p),y=Qe(p,{locale:q}),N=et(m,{locale:q}),C=tt({start:y,end:N}),k=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],x=b=>t.filter(D=>lt(new Date(D.visitDate),b));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:E(a,"MMMM yyyy",{locale:q})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:g,"aria-label":"Mois prÃ©cÃ©dent",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"px-3 py-1 text-sm font-medium text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/20 rounded-md",children:"Aujourd'hui"}),e.jsx("button",{onClick:s,"aria-label":"Mois suivant",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:k.map(b=>e.jsx("div",{className:"py-3 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:b},b))}),e.jsx("div",{className:"grid grid-cols-7 auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:C.map(b=>{const D=x(b),j=at(b,p),f=st(b);return e.jsxs("div",{className:`
                min-h-[120px] bg-white dark:bg-gray-800 p-2 transition-colors
                ${j?"":"bg-gray-50 dark:bg-gray-800/50 text-gray-400 dark:text-gray-600"}
                ${f?"bg-blue-50/30 dark:bg-blue-900/10":""}
              `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`
                    text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                    ${f?"bg-primary-600 text-white":j?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}
                  `,children:E(b,"d")}),D.length>0&&e.jsx("span",{className:"text-xs font-medium text-gray-400",children:D.length})]}),e.jsx("div",{className:"space-y-1 mt-1",children:D.map(h=>e.jsxs("button",{onClick:()=>r?.(h),className:`
                      w-full text-left px-2 py-1 rounded text-xs font-medium truncate transition-colors
                      ${h.status==="confirmed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50":h.status==="pending"?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300 hover:bg-orange-200 dark:hover:bg-orange-900/50":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                    `,children:[h.visitTime," - ",h.nom]},h.id))})]},b.toString())})})]})};let te;const Tt=new Uint8Array(16);function Mt(){if(!te&&(te=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!te))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return te(Tt)}const M=[];for(let t=0;t<256;++t)M.push((t+256).toString(16).slice(1));function Vt(t,r=0){return M[t[r+0]]+M[t[r+1]]+M[t[r+2]]+M[t[r+3]]+"-"+M[t[r+4]]+M[t[r+5]]+"-"+M[t[r+6]]+M[t[r+7]]+"-"+M[t[r+8]]+M[t[r+9]]+"-"+M[t[r+10]]+M[t[r+11]]+M[t[r+12]]+M[t[r+13]]+M[t[r+14]]+M[t[r+15]]}const At=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ne={randomUUID:At};function Lt(t,r,a){if(Ne.randomUUID&&!t)return Ne.randomUUID();t=t||{};const o=t.random||(t.rng||Mt)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,Vt(o)}const Ot=({isOpen:t,onClose:r,initialDate:a})=>{const{speakers:o,hosts:s,addVisit:g,publicTalks:n,visits:p,congregationProfile:m}=Z(),{addToast:y}=Fe(),[N,C]=c.useState(!1),[k,x]=c.useState(""),[b,D]=c.useState({has:!1}),[j,f]=c.useState({visitDate:a?a.toISOString().split("T")[0]:"",visitTime:m.meetingTime||"14:30",locationType:"physical",status:"pending",talkNoOrType:"",talkTheme:"",nom:"",id:"",host:"",congregation:""});c.useEffect(()=>{j.visitDate&&(h(j.visitDate),S(j.visitDate))},[j.visitDate]);const h=d=>{const u=new Date(d),v=new Date;return v.setHours(0,0,0,0),u<v?(x("La date doit Ãªtre dans le futur"),!1):(x(""),!0)},S=d=>{const u=p.find(v=>v.visitDate===d);D(u?{has:!0,speakerName:u.nom}:{has:!1})},A=async d=>{if(d.preventDefault(),!h(j.visitDate||"")){y("Veuillez sÃ©lectionner une date valide dans le futur","error");return}C(!0);try{if(!j.id||!j.visitDate)throw new Error("Veuillez remplir les champs obligatoires");const u={...j,visitId:Lt(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await g(u),y("Visite programmÃ©e avec succÃ¨s","success"),r()}catch(u){y(u instanceof Error?u.message:"Erreur lors de la crÃ©ation","error")}finally{C(!1)}},P=d=>{const u=o.find(v=>v.id===d);u&&f(v=>({...v,id:u.id,nom:u.nom,congregation:u.congregation}))},l=d=>{const u=n.find(v=>v.number.toString()===d);u&&f(v=>({...v,talkNoOrType:u.number.toString(),talkTheme:u.theme}))};return e.jsx(U,{isOpen:t,onClose:r,title:"Programmer une visite",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"ghost",onClick:r,disabled:N,children:"Annuler"}),e.jsx(w,{onClick:A,isLoading:N,children:"Enregistrer"})]}),children:e.jsx("form",{onSubmit:A,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(ee,{label:"Orateur",options:[{value:"",label:"SÃ©lectionner un orateur"},...o.map(d=>({value:d.id,label:`${d.nom} (${d.congregation})`}))],value:j.id,onChange:d=>P(d.target.value),required:!0})}),e.jsx(H,{type:"date",label:"Date",value:j.visitDate,onChange:d=>f(u=>({...u,visitDate:d.target.value})),required:!0,error:k}),b.has&&!k&&e.jsx("div",{className:"col-span-2 -mt-4",children:e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(se,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[e.jsx("p",{className:"font-medium",children:"Une visite est dÃ©jÃ  programmÃ©e ce jour"}),e.jsxs("p",{className:"text-xs mt-1",children:["Orateur prÃ©vu : ",b.speakerName]})]})]})}),e.jsx(H,{type:"time",label:"Heure",value:j.visitTime,onChange:d=>f(u=>({...u,visitTime:d.target.value})),required:!0}),e.jsx("div",{className:"col-span-2",children:e.jsx(ee,{label:"Discours (liste)",options:[{value:"",label:"SÃ©lectionner un discours"},...n.map(d=>({value:d.number.toString(),label:`NÂ°${d.number} - ${d.theme}`}))],value:j.talkNoOrType||"",onChange:d=>l(d.target.value)})}),e.jsx(H,{label:"NÂ° Discours (manuel)",value:j.talkNoOrType||"",onChange:d=>f(u=>({...u,talkNoOrType:d.target.value})),placeholder:"Ex: 185"}),e.jsx(H,{label:"Titre du discours (manuel)",value:j.talkTheme||"",onChange:d=>f(u=>({...u,talkTheme:d.target.value})),placeholder:"Ex: Nega iluzon di mundu..."}),e.jsx(ee,{label:"Type de lieu",options:[{value:"physical",label:"Salle du Royaume"},{value:"zoom",label:"VisioconfÃ©rence"},{value:"streaming",label:"Streaming"}],value:j.locationType,onChange:d=>f(u=>({...u,locationType:d.target.value}))}),e.jsx(ee,{label:"Contact d'accueil",options:[{value:"",label:"Aucun"},...s.map(d=>({value:d.nom,label:d.nom}))],value:j.host||"",onChange:d=>f(u=>({...u,host:d.target.value}))})]})})})},ve=2,Rt=(t,r,a=new Date)=>{const o=Me(a,6),s=r.filter(k=>k.id===t.id&&(k.status==="completed"||k.status==="confirmed")&&nt(X(k.visitDate),o)),n=s.length/6/ve*100,p=Math.min(Math.round(n),100);let m=1;p>80?m=5:p>60?m=4:p>40?m=3:p>20&&(m=2);const y=[...s].sort((k,x)=>new Date(x.visitDate).getTime()-new Date(k.visitDate).getTime()),N=y.length>0?y[0].visitDate:null;return{speakerId:t.id,speakerName:t.nom,currentLoad:p,maxCapacity:ve*100,lastVisit:N,travelTime:30,workloadScore:m,availabilityNextMonth:p<80}},zt=t=>{switch(t){case 5:return"bg-red-500 text-white";case 4:return"bg-orange-500 text-white";case 3:return"bg-yellow-500 text-white";case 2:return"bg-blue-500 text-white";default:return"bg-green-500 text-white"}},$t=t=>{switch(t){case 5:return"SurchargÃ©";case 4:return"TrÃ¨s occupÃ©";case 3:return"OccupÃ©";case 2:return"ModÃ©rÃ©";default:return"Disponible"}},Et=({workload:t,showLabel:r=!1,size:a="md"})=>{const o=zt(t.workloadScore),s=$t(t.workloadScore),g=()=>t.workloadScore>=5?e.jsx(mt,{className:"w-4 h-4 rotate-90"}):t.workloadScore>=4?e.jsx(gt,{className:"w-4 h-4 rotate-90"}):t.workloadScore>=3?e.jsx(xt,{className:"w-4 h-4 rotate-90"}):e.jsx(ot,{className:"w-4 h-4"}),n=a==="sm"?"px-2 py-0.5 text-xs":"px-3 py-1 text-sm";return e.jsxs("div",{className:`inline-flex items-center gap-2 rounded-full ${o} ${n}`,title:`Charge: ${t.currentLoad}% - ${s}`,children:[g(),(r||a==="md")&&e.jsx("span",{className:"font-medium",children:s}),a==="md"&&e.jsxs("span",{className:"opacity-80 text-xs ml-1",children:["(",t.currentLoad,"%)"]})]})},It=()=>{const{speakers:t,visits:r}=Z(),[a,o]=fe.useState(""),g=fe.useMemo(()=>t.map(n=>({speaker:n,workload:Rt(n,r)})).sort((n,p)=>p.workload.currentLoad-n.workload.currentLoad),[t,r]).filter(({speaker:n})=>n.nom.toLowerCase().includes(a.toLowerCase())||n.congregation.toLowerCase().includes(a.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analyse de la Charge et DisponibilitÃ©"}),e.jsx("div",{className:"w-64",children:e.jsx(H,{placeholder:"Rechercher un orateur...",leftIcon:e.jsx(ue,{className:"w-4 h-4"}),value:a,onChange:n=>o(n.target.value)})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(({speaker:n,workload:p})=>e.jsx($,{className:"overflow-hidden",children:e.jsxs(B,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold",children:n.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:n.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.congregation})]})]}),e.jsx(Et,{workload:p})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Charge actuelle"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[p.currentLoad,"%"]})]}),e.jsx("progress",{value:p.currentLoad,max:100,className:`w-full h-2 rounded-full ${p.workloadScore>=5?"[&::-webkit-progress-value]:bg-red-500 [&::-moz-progress-bar]:bg-red-500":p.workloadScore>=4?"[&::-webkit-progress-value]:bg-orange-500 [&::-moz-progress-bar]:bg-orange-500":p.workloadScore>=3?"[&::-webkit-progress-value]:bg-yellow-500 [&::-moz-progress-bar]:bg-yellow-500":"[&::-webkit-progress-value]:bg-green-500 [&::-moz-progress-bar]:bg-green-500"} [&::-webkit-progress-bar]:bg-gray-100 [&::-webkit-progress-bar]:dark:bg-gray-700 [&::-moz-progress-bar]:bg-gray-100 [&::-moz-progress-bar]:dark:bg-gray-700`})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 border-t border-gray-100 dark:border-gray-700 pt-3",children:[e.jsx("span",{children:"DerniÃ¨re visite:"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:p.lastVisit?new Date(p.lastVisit).toLocaleDateString():"Aucune"})]})]})]})},n.id))})]})},Pt=({visits:t})=>{if(t.length===0)return e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Aucune visite Ã  afficher dans la chronologie."});const r=t.reduce((o,s)=>{const g=X(s.visitDate),n=E(g,"yyyy-MM",{locale:q});return o[n]||(o[n]=[]),o[n].push(s),o},{}),a=Object.keys(r).sort();return e.jsxs("div",{className:"relative space-y-8 p-4",children:[e.jsx("div",{className:"absolute left-4 md:left-1/2 top-4 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700 -ml-[1px]"}),a.map(o=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-center mb-6 relative z-10",children:e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 px-4 py-1 rounded-full text-sm font-semibold border-4 border-white dark:border-gray-900",children:E(X(`${o}-01`),"MMMM yyyy",{locale:q})})}),e.jsx("div",{className:"space-y-6",children:r[o].map((s,g)=>{const n=X(s.visitDate),p=g%2===0;return e.jsxs("div",{className:`flex flex-col md:flex-row items-center gap-4 md:gap-8 ${p?"md:flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-full md:w-1/2 pl-8 md:pl-0",children:e.jsxs($,{className:"p-4 hover:shadow-lg transition-shadow border-l-4 border-l-primary-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-600 font-medium",children:[e.jsx(I,{className:"w-4 h-4"}),E(n,"EEEE d",{locale:q})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${s.status==="confirmed"?"bg-green-100 text-green-800":s.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:s.status==="confirmed"?"ConfirmÃ©":s.status==="pending"?"En attente":s.status})]}),e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-2",children:s.nom}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-3 h-3"}),s.congregation]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("div",{className:"flex-1 min-w-0",children:s.talkNoOrType?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:["NÂ°",s.talkNoOrType]}),s.talkTheme&&e.jsx("div",{className:"text-xs truncate",children:s.talkTheme})]}):"Pas de discours"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-3 h-3"}),s.visitTime]})]})]})}),e.jsx("div",{className:"absolute left-4 md:left-1/2 w-4 h-4 bg-primary-500 rounded-full md:-ml-2 border-4 border-white dark:border-gray-900 shadow-sm z-10 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("div",{className:"hidden md:block w-1/2"})]},s.id)})})]},o))]})},Ft=({visits:t})=>{const r=c.useMemo(()=>{const a=t.filter(g=>g.expenses&&g.expenses.length>0),o=t.reduce((g,n)=>{const p=(n.expenses||[]).reduce((m,y)=>m+y.amount,0);return g+p},0),s=a.length>0?o/a.length:0;return{total:o,visitsWithExpenses:a.length,average:s}},[t]);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs($,{children:[e.jsx(ce,{children:e.jsxs("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),"Total des dÃ©penses"]})}),e.jsx(B,{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.total.toFixed(2)," â‚¬"]})})]}),e.jsxs($,{children:[e.jsx(ce,{children:e.jsxs("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Visites avec dÃ©penses"]})}),e.jsx(B,{children:e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.visitsWithExpenses})})]}),e.jsxs($,{children:[e.jsx(ce,{children:e.jsxs("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4"}),"Moyenne par visite"]})}),e.jsx(B,{children:e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[r.average.toFixed(2)," â‚¬"]})})]})]})},we=({value:t,onChange:r,placeholder:a="SÃ©lectionner une date",className:o="",required:s=!1,disabled:g=!1,min:n,max:p})=>e.jsx("div",{className:`relative ${o}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:t||"",onChange:m=>r?.(m.target.value),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors",placeholder:a,required:s,disabled:g,min:n,max:p}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(I,{className:"w-4 h-4 text-gray-400"})})]})}),me=t=>t?E(t,"yyyy-MM-dd"):"",De=t=>t?X(t):null,Bt=({isOpen:t,onClose:r,dateRange:a,setDateRange:o,statusFilter:s,setStatusFilter:g,typeFilter:n,setTypeFilter:p})=>{const[m,y]=c.useState(a),[N,C]=c.useState(s),[k,x]=c.useState(n);c.useEffect(()=>{t&&(y(a),C(s),x(n))},[t,a,s,n]);const b=()=>{o(m),g(N),p(k),r()},D=()=>{r()},j=()=>{y({start:null,end:null}),C("all"),x("all")};return e.jsxs(U,{isOpen:t,onClose:r,title:"Filtres avancÃ©s",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Statut"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"pending",label:"En attente"},{value:"confirmed",label:"ConfirmÃ©"},{value:"completed",label:"TerminÃ©"},{value:"cancelled",label:"AnnulÃ©"}].map(f=>e.jsx("button",{onClick:()=>C(f.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${N===f.value?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Type de visite"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"physical",label:"Physique"},{value:"zoom",label:"Zoom"},{value:"streaming",label:"Streaming"}].map(f=>e.jsx("button",{onClick:()=>x(f.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${k===f.value?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:f.label},f.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Plage de dates"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{value:me(m.start),onChange:f=>y(h=>({...h,start:De(f)})),placeholder:"Date de dÃ©but"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(we,{value:me(m.end),onChange:f=>y(h=>({...h,end:De(f)})),placeholder:"Date de fin",min:me(m.start)})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(w,{variant:"ghost",onClick:j,children:"RÃ©initialiser"}),e.jsx(w,{variant:"ghost",onClick:D,children:"Annuler"}),e.jsx(w,{onClick:b,children:"Appliquer les filtres"})]})]})},ae=c.memo(({icon:t,value:r,label:a,bgColor:o,textColor:s,iconBg:g})=>e.jsx("div",{className:`${o} p-4 rounded-lg border`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${g} flex items-center justify-center`,children:e.jsx(t,{className:`w-4 h-4 ${s}`})}),e.jsxs("div",{children:[e.jsx("div",{className:`text-lg font-semibold ${s.replace("text-","text-").replace("blue-600","blue-900").replace("dark:text-blue-400","dark:text-blue-100")}`,children:r}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:a})]})]})})),qt=c.memo(({viewOption:t,currentView:r,onViewChange:a})=>e.jsx("button",{onClick:()=>a(t.id),className:`p-2 rounded-md transition-all text-xs ${r===t.id?"bg-white dark:bg-gray-600 shadow-sm text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,title:t.description,children:e.jsx(t.icon,{className:"w-4 h-4"})})),ra=()=>{const{visits:t,archivedVisits:r}=Z(),[a,o]=c.useState("cards"),[s,g]=c.useState(""),[n,p]=c.useState("all"),[m,y]=c.useState("all"),[N,C]=c.useState(!1),[k,x]=c.useState(!1),[b,D]=c.useState(!1),[j,f]=c.useState({start:null,end:null}),[h,S]=c.useState(null),[A,P]=c.useState("edit"),[l,d]=c.useState(!1),[u,v]=c.useState(!1),[W,_]=c.useState(!1),[ne,G]=c.useState(!1),Y=c.useRef(null),T=Ze.useReactToPrint({contentRef:Y,documentTitle:`Planning-visites-${new Date().toLocaleDateString()}`}),J=c.useCallback(i=>o(i),[]),Le=c.useCallback(i=>g(i.target.value),[]),Oe=c.useCallback(()=>C(!0),[]),Re=c.useCallback(()=>C(!1),[]),F=c.useCallback((i,z)=>{S(i),P(z),x(!0)},[]),ze=c.useCallback(()=>{x(!1),S(null)},[]),O=c.useMemo(()=>t.filter(i=>{const z=i.nom.toLowerCase().includes(s.toLowerCase())||i.congregation.toLowerCase().includes(s.toLowerCase())||i.talkNoOrType?.toLowerCase().includes(s.toLowerCase())||i.notes?.toLowerCase().includes(s.toLowerCase()),ie=n==="all"||i.status===n,de=m==="all"||i.locationType===m,Q=new Date(i.visitDate),R=(!j.start||Q>=j.start)&&(!j.end||Q<=j.end);return z&&ie&&de&&R}).sort((i,z)=>new Date(i.visitDate).getTime()-new Date(z.visitDate).getTime()),[t,s,n,m,j]),K=c.useMemo(()=>{const i=O.length,z=O.filter(R=>R.status==="confirmed").length,ie=O.filter(R=>R.status==="pending").length,de=O.filter(R=>R.status==="completed").length,Q=O.filter(R=>new Date(R.visitDate)>=new Date&&R.status==="confirmed").length;return{total:i,confirmed:z,pending:ie,completed:de,upcoming:Q}},[O]),$e=c.useMemo(()=>[{id:"cards",label:"Cartes",icon:ut,description:"Vue visuelle des visites"},{id:"list",label:"Liste",icon:pt,description:"Tableau dÃ©taillÃ©"},{id:"calendar",label:"Calendrier",icon:I,description:"Vue calendrier"}],[]),Ee=c.useMemo(()=>[{id:"archives",label:"Archives",icon:oe,description:"Visites terminÃ©es"},{id:"timeline",label:"Chronologie",icon:ht,description:"Timeline verticale"},{id:"workload",label:"DisponibilitÃ©",icon:ct,description:"Charge des orateurs"},{id:"finance",label:"Finances",icon:ft,description:"Suivi des coÃ»ts"}],[]);return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{leftIcon:e.jsx(qe,{className:"w-4 h-4"}),onClick:Oe,size:"lg",children:"Programmer une visite"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(ae,{icon:I,value:K.total,label:"Total",bgColor:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",textColor:"text-blue-600 dark:text-blue-400",iconBg:"bg-blue-100 dark:bg-blue-900"}),e.jsx(ae,{icon:()=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),value:K.confirmed,label:"ConfirmÃ©es",bgColor:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",textColor:"text-green-600 dark:text-green-400",iconBg:"bg-green-100 dark:bg-green-900"}),e.jsx(ae,{icon:re,value:K.pending,label:"En attente",bgColor:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",textColor:"text-orange-600 dark:text-orange-400",iconBg:"bg-orange-100 dark:bg-orange-900"}),e.jsx(ae,{icon:()=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),value:K.upcoming,label:"Ã€ venir",bgColor:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",textColor:"text-purple-600 dark:text-purple-400",iconBg:"bg-purple-100 dark:bg-purple-900"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between bg-white dark:bg-gray-800 p-3 md:p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0 md:min-w-64",children:e.jsx(H,{placeholder:"Rechercher une visite...",leftIcon:e.jsx(ue,{className:"w-4 h-4"}),value:s,onChange:Le})}),e.jsx(w,{variant:"secondary",size:"sm",leftIcon:e.jsx(Ae,{className:"w-4 h-4"}),onClick:()=>D(!0),children:"Filtres"})]}),(n!=="all"||m!=="all")&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n!=="all"&&e.jsxs("button",{onClick:()=>p("all"),className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[n==="pending"&&"En attente",n==="confirmed"&&"ConfirmÃ©",n==="completed"&&"TerminÃ©",n==="cancelled"&&"AnnulÃ©",e.jsx(je,{className:"w-3 h-3"})]}),m!=="all"&&e.jsxs("button",{onClick:()=>y("all"),className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors",children:[m==="physical"&&"Physique",m==="zoom"&&"Zoom",m==="streaming"&&"Streaming",e.jsx(je,{className:"w-3 h-3"})]}),e.jsx("button",{onClick:()=>{p("all"),y("all")},className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 underline",children:"Effacer tout"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full lg:w-auto justify-between lg:justify-end",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-gray-700 p-1 rounded-lg",children:[$e.map(i=>e.jsx(qt,{viewOption:i,currentView:a,onViewChange:J},i.id)),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>G(!ne),className:`p-2 rounded-md transition-all text-xs ${["timeline","workload","finance"].includes(a)?"bg-white dark:bg-gray-600 shadow-sm text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,title:"Plus de vues",children:e.jsx(yt,{className:"w-4 h-4"})}),ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>G(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:Ee.map(i=>e.jsxs("button",{onClick:()=>{J(i.id),G(!1)},className:`w-full flex items-center gap-3 px-4 py-3 text-sm transition-colors ${a===i.id?"bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:i.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:i.description})]})]},i.id))})]})]})]}),e.jsx(w,{variant:"secondary",size:"sm",leftIcon:e.jsx(He,{className:"w-4 h-4"}),onClick:T,children:"Exporter"})]})]}),e.jsxs("div",{className:"min-h-[400px] md:min-h-[600px]",ref:Y,children:[a==="cards"&&e.jsx(Dt,{visits:O,onVisitAction:F,onVisitClick:i=>F(i,"edit")}),a==="list"&&e.jsx(Ct,{visits:O,onVisitAction:F,onVisitClick:i=>F(i,"edit")}),a==="calendar"&&e.jsx(St,{visits:O,onVisitClick:i=>F(i,"edit")}),a==="timeline"&&e.jsx(Pt,{visits:O}),a==="workload"&&e.jsx(It,{}),a==="finance"&&e.jsx(Ft,{visits:O}),a==="archives"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(oe,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Visites archivÃ©es (",r.length,")"]})]}),r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(oe,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Aucune visite archivÃ©e"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Les visites terminÃ©es apparaÃ®tront ici automatiquement."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:r.sort((i,z)=>new Date(z.visitDate).getTime()-new Date(i.visitDate).getTime()).map(i=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:i.nom}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.congregation})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:"TerminÃ©e"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date(i.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Heure:"}),e.jsx("span",{children:i.visitTime})]}),i.talkNoOrType&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Discours:"}),e.jsx("span",{children:i.talkNoOrType})]}),i.host&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"HÃ´te:"}),e.jsx("span",{children:i.host})]})]}),i.talkTheme&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 italic",children:['"',i.talkTheme,'"']})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(w,{variant:"secondary",size:"sm",onClick:()=>F(i,"message"),leftIcon:e.jsx(le,{className:"w-3 h-3"}),children:"Message"}),e.jsx(w,{variant:"secondary",size:"sm",onClick:()=>F(i,"feedback"),leftIcon:e.jsx(Se,{className:"w-3 h-3"}),children:"Bilan"})]})]},i.visitId))})]})]}),t.filter(i=>i.status==="confirmed"&&new Date(i.visitDate)<new Date).length>0&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-900/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-orange-100 dark:bg-orange-900 flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 md:w-5 md:h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-100",children:"Visites passÃ©es Ã  archiver"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:[t.filter(i=>i.status==="confirmed"&&new Date(i.visitDate)<new Date).length," visite(s) passÃ©e(s) nÃ©cessite(nt) une action"]})]})]}),e.jsx(w,{variant:"secondary",size:"sm",children:"Voir tout"})]})}),e.jsx(Ot,{isOpen:N,onClose:Re}),e.jsx(Ge,{isOpen:k,onClose:ze,visit:h,action:A}),e.jsx(Bt,{isOpen:b,onClose:()=>D(!1),dateRange:j,setDateRange:f,statusFilter:n,setStatusFilter:p,typeFilter:m,setTypeFilter:y}),h&&e.jsxs(e.Fragment,{children:[e.jsx(kt,{isOpen:l,onClose:()=>d(!1),visit:h,onResolve:i=>{console.log("Conflict resolved:",i),d(!1)}}),e.jsx(Nt,{isOpen:u,onClose:()=>v(!1),visit:h,onCancel:i=>{console.log("Visit cancelled:",i),v(!1)}}),e.jsx(vt,{isOpen:W,onClose:()=>_(!1),visit:h,onSelectReplacement:i=>{console.log("Replacement selected:",i),_(!1)}})]})]})};export{ra as Planning};
//# sourceMappingURL=Planning-868GHBoM.js.map
