import{c as U,j as e,B as p,f as V,g as $,s as T,M as S,C as G,n as B,u as E,t as F,a as H,k as W,i as M,v as _,b as Z,e as m,U as J,P as K,m as A,S as Q,A as X}from"./index-BZdsEwY1.js";import{r as o,R}from"./charts-CCOFnOOy.js";import{C as Y}from"./CommunicationProgress-2rVILIWn.js";import{P as ee,M as se,I as ae}from"./Input-Q56iw-Sl.js";import{C as I,U as re,a as te}from"./Select-1Wfo6vyj.js";import{f as ne}from"./utils-BQuD9tR2.js";import{g as le,C as de,S as ie,M as D}from"./MessageGeneratorModal-C8TFbNyw.js";import"./react-vendor-B9D_A6Vq.js";const ce=U("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),oe=({speaker:t,visits:g,onAction:i})=>{const f=[...g].sort((s,c)=>new Date(c.visitDate).getTime()-new Date(s.visitDate).getTime());return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:t.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-900 dark:text-white",children:t.nom}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.congregation})]})]}),e.jsxs("div",{className:"flex gap-2",children:[t.telephone&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(`tel:${t.telephone}`),children:e.jsx(ee,{className:"w-4 h-4"})}),t.email&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(`mailto:${t.email}`),children:e.jsx(ce,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:f.length>0?f.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 font-medium uppercase tracking-wider justify-center my-4",children:[e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"}),ne(new Date(s.visitDate),"d MMMM yyyy",{locale:B}),e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"})]}),e.jsx(V,{children:e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["Discours n¬∞",s.talkNoOrType]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.talkTheme||T(s.talkNoOrType)})]}),e.jsx("span",{className:`
                      px-2 py-1 rounded-full text-xs font-medium
                      ${s.status==="confirmed"?"bg-green-100 text-green-800":s.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}
                    `,children:s.status==="confirmed"?"Confirm√©":s.status==="pending"?"En attente":s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 text-gray-400"}),s.visitTime]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),s.locationType==="physical"?"Salle du Royaume":"Zoom"]}),s.host&&e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),"H√©berg√© par ",s.host]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(Y,{visit:s,showLabels:!0,size:"md"})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(p,{size:"sm",variant:"primary",leftIcon:e.jsx(S,{className:"w-4 h-4"}),onClick:()=>i("whatsapp",s),children:"G√©n√©rer un message"}),s.status==="pending"&&e.jsx(p,{size:"sm",variant:"primary",onClick:()=>i("confirm",s),children:"Confirmer"})]})]})})]},s.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(G,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Aucune visite programm√©e avec cet orateur"})]})})]})},xe=({isOpen:t,onClose:g,visitsNeedingHost:i})=>{const{congregationProfile:f}=E(),{settings:s}=F(),{addToast:c}=H(),[l,h]=o.useState(new Set(i.map(r=>r.visitId))),[k,y]=o.useState("");R.useEffect(()=>{l.size>0&&j()},[l]);const j=()=>{const r=i.filter(N=>l.has(N.visitId)),u=le(r,f,s.language);y(u)},z=r=>{const u=new Set(l);u.has(r)?u.delete(r):u.add(r),h(u)},w=()=>{l.size===i.length?h(new Set):h(new Set(i.map(r=>r.visitId)))},v=async()=>{try{await navigator.clipboard.writeText(k),c("Message copi√© dans le presse-papier","success")}catch{c("Erreur lors de la copie","error")}},b=()=>{const r=encodeURIComponent(k);window.open(`https://wa.me/?text=${r}`,"_blank"),g()};return e.jsx(W,{isOpen:t,onClose:g,title:"Demande d'accueil group√©e",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"ghost",onClick:g,children:"Annuler"}),e.jsx(p,{variant:"secondary",onClick:v,leftIcon:e.jsx(te,{className:"w-4 h-4"}),disabled:l.size===0,children:"Copier"}),e.jsx(p,{onClick:b,leftIcon:e.jsx(ie,{className:"w-4 h-4"}),disabled:l.size===0,children:"Envoyer (WhatsApp)"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-orange-900 dark:text-orange-300",children:[i.length," visite",i.length>1?"s":""," sans contact d'accueil"]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400 mt-1",children:"S√©lectionnez les visites pour lesquelles demander un contact"})]}),e.jsxs(M,{variant:"warning",size:"md",children:[l.size," s√©lectionn√©e",l.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Visites"}),e.jsx("button",{onClick:w,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:l.size===i.length?"Tout d√©s√©lectionner":"Tout s√©lectionner"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:i.map(r=>e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l.has(r.visitId),onChange:()=>z(r.visitId),className:"mt-1 w-4 h-4 text-primary-600 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:r.nom}),e.jsx(M,{variant:"default",size:"sm",children:_(r.visitDate,s.language)})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.congregation," ‚Ä¢ ",r.visitTime]}),(r.talkTheme||T(r.talkNoOrType))&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["N¬∞",r.talkNoOrType," - ",r.talkTheme||T(r.talkNoOrType)]})]})]},r.visitId))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Aper√ßu du message"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:"w-full h-64 p-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none font-mono text-sm",value:k,onChange:r=>y(r.target.value),placeholder:l.size===0?"S√©lectionnez au moins une visite pour g√©n√©rer le message...":"G√©n√©ration du message...",disabled:l.size===0}),l.size>0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(M,{variant:"success",size:"sm",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Message pr√™t"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"üí° Vous pouvez modifier le message avant de l'envoyer"})]})]})})},be=()=>{const{visits:t,speakers:g,updateVisit:i,refreshData:f}=E(),{isPhoneS25Ultra:s}=Z();R.useEffect(()=>{f&&f()},[]);const[c,l]=o.useState(null),[h,k]=o.useState(""),[y,j]=o.useState(!1),[z,w]=o.useState(!1),[v,b]=o.useState(null),[r,u]=o.useState("all"),N=o.useMemo(()=>{const a=[],n=new Set;return g.forEach(d=>{if(!n.has(d.id)){n.add(d.id);const x=t.filter(L=>L.id===d.id);x.length>0&&a.push({speaker:d,visits:x})}}),a},[t,g]),O=o.useMemo(()=>N.filter(a=>{const n=a.speaker.nom.toLowerCase().includes(h.toLowerCase())||a.speaker.congregation.toLowerCase().includes(h.toLowerCase()),d=r==="all"||r==="pending"&&a.visits.some(x=>x.status==="pending");return n&&d}),[N,h,r]),C=o.useMemo(()=>{const a=N.length,n=t.filter(x=>x.status==="pending").length,d=t.filter(x=>!x.host||x.host==="√Ä d√©finir"||x.host==="").length;return{total:a,pending:n,needingHost:d}},[N,t]),P=a=>{switch(a.status){case"pending":return e.jsx(I,{className:"w-4 h-4 text-orange-500"});case"confirmed":return e.jsx(A,{className:"w-4 h-4 text-green-500"});default:return e.jsx(X,{className:"w-4 h-4 text-gray-500"})}},q=(a,n)=>{if(a==="whatsapp"||a==="email")n&&c&&(b(n),j(!0));else if(a==="confirm"&&n){const d={...n,status:"confirmed",updatedAt:new Date().toISOString()};i(d)}else a==="host_request"&&n&&(b(n),w(!0))};return e.jsxs("div",{className:m("min-h-[calc(100vh-12rem)] flex flex-col",s&&"s25-ultra-optimized"),children:[e.jsxs("div",{className:m("flex justify-end gap-3 mb-6",s&&"flex-col gap-2"),children:[C.needingHost>0&&e.jsxs(p,{variant:"secondary",className:"bg-orange-100 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:hover:bg-orange-900/50",leftIcon:e.jsx(J,{className:"w-4 h-4"}),onClick:()=>w(!0),children:["Demande d'accueil (",C.needingHost,")"]}),e.jsx(p,{variant:"secondary",leftIcon:e.jsx(K,{className:"w-4 h-4"}),onClick:()=>j(!0),children:"Nouveau message"})]}),e.jsxs("div",{className:m("grid gap-4 mb-6",s?"grid-cols-1":"grid-cols-3"),children:[e.jsx("div",{className:m("bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",s&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(S,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-blue-900 dark:text-blue-100",children:C.total}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Orateurs"})]})]})}),e.jsx("div",{className:m("bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",s&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-orange-900 dark:text-orange-100",children:C.pending}),e.jsx("div",{className:"text-xs text-orange-700 dark:text-orange-300",children:"En attente"})]})]})}),e.jsx("div",{className:m("bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",s&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-6 h-6 text-green-600 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-green-900 dark:text-green-100",children:t.filter(a=>a.status==="confirmed").length}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:"Confirm√©es"})]})]})})]}),e.jsx("div",{className:m("flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-6",s&&"p-3"),children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsx(ae,{placeholder:"Rechercher un orateur...",leftIcon:e.jsx(Q,{className:"w-4 h-4"}),value:h,onChange:a=>k(a.target.value),className:"min-w-64"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-2 text-sm rounded-lg transition-colors ${r==="all"?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:"Tous"}),e.jsxs("button",{onClick:()=>u("pending"),className:`px-3 py-2 text-sm rounded-lg transition-colors ${r==="pending"?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-600 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700"}`,children:["En attente (",C.pending,")"]})]})]})}),e.jsxs("div",{className:m("flex-1 flex gap-6 min-h-0",s&&"flex-col gap-4"),children:[e.jsxs("div",{className:m("w-full lg:w-96 flex flex-col bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",s&&"w-full min-h-0 flex-1"),children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Orateurs"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:O.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:O.map(({speaker:a,visits:n})=>e.jsx("div",{onClick:()=>l(a),className:`p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${c?.id===a.id?"bg-primary-50 dark:bg-primary-900/20 border-r-2 border-primary-500":""}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold flex-shrink-0",children:a.nom.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white truncate",children:a.nom}),n.some(d=>d.status==="pending")&&e.jsx(M,{variant:"danger",className:"text-xs px-1.5 py-0.5",children:"!"})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1 truncate",children:a.congregation}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 dark:text-gray-500",children:[e.jsxs("span",{children:[n.length," visite",n.length>1?"s":""]}),e.jsx("span",{children:"‚Ä¢"}),e.jsxs("span",{children:[n.filter(d=>d.status==="pending").length," en attente"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[n.some(d=>P(d)),e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:a.telephone||a.email?"Contact√©":"Sans contact"})]})]})},a.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(S,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{className:"text-center",children:h?"Aucun orateur trouv√©":"Aucun orateur"})]})})]}),e.jsx("div",{className:m("flex-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",s&&"w-full"),children:c?e.jsx(oe,{speaker:c,visits:t.filter(a=>a.nom===c.nom),onAction:q}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx(S,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"S√©lectionnez un orateur"}),e.jsx("p",{className:"text-center max-w-md",children:"Choisissez un orateur dans la liste pour voir les d√©tails et envoyer des messages."})]})})]}),y&&c&&v&&e.jsx(D,{isOpen:y,onClose:()=>{j(!1),b(null)},speaker:c,visit:v}),y&&!v&&e.jsx(D,{isOpen:y,onClose:()=>{j(!1),b(null)},speaker:c||g[0],visit:t[0]}),e.jsx(xe,{isOpen:z,onClose:()=>w(!1),visitsNeedingHost:t.filter(a=>!a.host||a.host==="√Ä d√©finir"||a.host==="")})]})};export{be as Messages};
//# sourceMappingURL=Messages-y7yPK-Ed.js.map
