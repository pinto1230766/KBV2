import{c as P,j as e,B as y,d as D,e as O,t as R,g as q,M as E,C as $,l as W,u as G,v as K,b as Z,n as J,w as Q,x as X,P as Y,U as ee,k as se,f as j,h as ae,i as te,I as re}from"./index-D_fRgLDA.js";import{r as g,R as U}from"./charts-Cazb4rp-.js";import{C as le}from"./CommunicationProgress-DqLZb70l.js";import{P as ne,M as ie,U as oe,B as v}from"./Badge-SUWuRPpc.js";import{M as F,U as ce}from"./user-check-DzgxfSjm.js";import{f as de}from"./utils-FTT-aY8U.js";import{g as xe,C as me,S as H,M as ge}from"./MessageGeneratorModal-DAzL5aGB.js";import{a as he}from"./Select-BowyyWmv.js";import"./react-vendor-B9D_A6Vq.js";const pe=P("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);const ue=P("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),fe=({speaker:l,visits:p,onAction:c})=>{const u=[...p.filter((t,n,o)=>n===o.findIndex(b=>b.id===t.id))].sort((t,n)=>new Date(n.visitDate).getTime()-new Date(t.visitDate).getTime());return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:l.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-900 dark:text-white",children:l.nom}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l.congregation})]})]}),e.jsxs("div",{className:"flex gap-2",children:[l.telephone&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>window.open(`tel:${l.telephone}`),children:e.jsx(ne,{className:"w-4 h-4"})}),l.email&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>window.open(`mailto:${l.email}`),children:e.jsx(F,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:u.length>0?u.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 font-medium uppercase tracking-wider justify-center my-4",children:[e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"}),de(new Date(t.visitDate),"d MMMM yyyy",{locale:W}),e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"})]}),e.jsx(D,{children:e.jsxs(O,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["Discours n¬∞",t.talkNoOrType]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.talkTheme||R(t.talkNoOrType)})]}),e.jsx("span",{className:`
                      px-2 py-1 rounded-full text-xs font-medium
                      ${t.status==="confirmed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}
                    `,children:t.status==="confirmed"?"Confirm√©":t.status==="pending"?"En attente":t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4 text-gray-400"}),t.visitTime]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-400"}),t.locationType==="physical"?"Salle du Royaume":"Zoom"]}),t.host&&e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(oe,{className:"w-4 h-4 text-gray-400"}),"H√©berg√© par ",t.host]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(le,{visit:t,showLabels:!0,size:"md"})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(y,{size:"sm",variant:"primary",leftIcon:e.jsx(E,{className:"w-4 h-4"}),onClick:()=>c("whatsapp",t),children:"G√©n√©rer un message"}),t.status==="pending"&&e.jsx(y,{size:"sm",variant:"primary",onClick:()=>c("confirm",t),children:"Confirmer"})]})]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Aucune visite programm√©e avec cet orateur"})]})})]})},ye=({isOpen:l,onClose:p,visitsNeedingHost:c})=>{const{congregationProfile:k}=G(),{settings:u}=K(),{addToast:t}=Z(),[n,o]=g.useState(new Set(c.map(a=>a.visitId))),[b,w]=g.useState("");U.useEffect(()=>{n.size>0&&A()},[n]);const A=()=>{const a=c.filter(V=>n.has(V.visitId)),f=xe(a,k,u.language);w(f)},N=a=>{const f=new Set(n);f.has(a)?f.delete(a):f.add(a),o(f)},I=()=>{n.size===c.length?o(new Set):o(new Set(c.map(a=>a.visitId)))},S=async()=>{try{await navigator.clipboard.writeText(b),t("Message copi√© dans le presse-papier","success")}catch{t("Erreur lors de la copie","error")}},C=()=>{const a=encodeURIComponent(b);window.open(`https://wa.me/?text=${a}`,"_blank"),p()};return e.jsx(J,{isOpen:l,onClose:p,title:"Demande d'accueil group√©e",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(y,{variant:"ghost",onClick:p,children:"Annuler"}),e.jsx(y,{variant:"secondary",onClick:S,leftIcon:e.jsx(he,{className:"w-4 h-4"}),disabled:n.size===0,children:"Copier"}),e.jsx(y,{onClick:C,leftIcon:e.jsx(H,{className:"w-4 h-4"}),disabled:n.size===0,children:"Envoyer (WhatsApp)"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-orange-900 dark:text-orange-300",children:[c.length," visite",c.length>1?"s":""," sans contact d'accueil"]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400 mt-1",children:"S√©lectionnez les visites pour lesquelles demander un contact"})]}),e.jsxs(v,{variant:"warning",size:"md",children:[n.size," s√©lectionn√©e",n.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Visites"}),e.jsx("button",{onClick:I,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:n.size===c.length?"Tout d√©s√©lectionner":"Tout s√©lectionner"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:c.map(a=>e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.has(a.visitId),onChange:()=>N(a.visitId),className:"mt-1 w-4 h-4 text-primary-600 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.nom}),e.jsx(v,{variant:"default",size:"sm",children:Q(a.visitDate,u.language)})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.congregation," ‚Ä¢ ",a.visitTime]}),(a.talkTheme||R(a.talkNoOrType))&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["N¬∞",a.talkNoOrType," - ",a.talkTheme||R(a.talkNoOrType)]})]})]},a.visitId))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Aper√ßu du message"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:"w-full h-64 p-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none font-mono text-sm",value:b,onChange:a=>w(a.target.value),placeholder:n.size===0?"S√©lectionnez au moins une visite pour g√©n√©rer le message...":"G√©n√©ration du message...",disabled:n.size===0}),n.size>0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(v,{variant:"success",size:"sm",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),"Message pr√™t"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"üí° Vous pouvez modifier le message avant de l'envoyer"})]})]})})},Me=()=>{const{visits:l,speakers:p,updateVisit:c,refreshData:k}=G(),{deviceType:u}=X(),t=u==="tablet",n=t&&window.innerWidth>=1200;U.useEffect(()=>{k&&k()},[]);const[o,b]=g.useState(null),[w,A]=g.useState(""),[N,I]=g.useState("all"),[S,C]=g.useState(!1),[a,f]=g.useState(!1),[V,T]=g.useState(null),M=g.useMemo(()=>{const s=[],i=new Set;return p.forEach(d=>{if(!i.has(d.id)){i.add(d.id);const r=l.filter(h=>{const x=(h.talkNoOrType||"").toLowerCase(),m=x.includes("assembl")||x.includes("congr")||x.includes("especial")||x.includes("circun");return h.id===d.id&&!m&&h.status!=="cancelled"});if(r.length>0){const h=[...r].sort((m,_)=>new Date(m.visitDate).getTime()-new Date(_.visitDate).getTime()),x=h.filter(m=>new Date(m.visitDate)>=new Date(new Date().setHours(0,0,0,0)));x.length>0&&s.push({speaker:d,visits:h,nextVisitDate:x[0].visitDate})}}}),s.sort((d,r)=>new Date(d.nextVisitDate).getTime()-new Date(r.nextVisitDate).getTime())},[l,p]),L=g.useMemo(()=>M.filter(s=>{const i=s.speaker.nom.toLowerCase().includes(w.toLowerCase())||s.speaker.congregation.toLowerCase().includes(w.toLowerCase()),d=N==="all"||N==="pending"&&s.visits.some(r=>r.status==="pending")||N==="needs_host"&&s.visits.some(r=>!r.host||r.host==="√Ä d√©finir");return i&&d}),[M,w,N]),z=g.useMemo(()=>{const s=l.filter(r=>r.status==="pending").length,i=l.filter(r=>r.status==="confirmed").length,d=l.filter(r=>(!r.host||r.host==="√Ä d√©finir")&&r.locationType==="physical").length;return{pendingTotal:s,confirmedTotal:i,needingHostTotal:d,totalConversations:M.length}},[l,M]),B=(s,i)=>{(s==="whatsapp"||s==="email")&&i&&o?(T(i),C(!0)):s==="confirm"&&i?c({...i,status:"confirmed",updatedAt:new Date().toISOString()}):s==="host_request"&&i&&(T(i),f(!0))};return e.jsxs("div",{className:"max-w-[1600px] mx-auto space-y-8 px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-gray-200 dark:border-gray-700 pb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-600 dark:text-primary-400 font-medium mb-1",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Communications Hub"})]}),e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight",children:"Messages & Suivi"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2 max-w-2xl text-sm",children:"G√©rez vos √©changes avec les orateurs, confirmez les visites et organisez l'accueil en un seul endroit."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[u==="phone"&&o&&e.jsx(y,{variant:"ghost",onClick:()=>b(null),leftIcon:e.jsx(pe,{className:"w-4 h-4"}),children:"Retour"}),e.jsx(y,{className:"shadow-lg shadow-primary-200 dark:shadow-none",leftIcon:e.jsx(Y,{className:"w-4 h-4"}),onClick:()=>{T(null),C(!0)},children:"Nouveau Message"})]})]}),(!o||!t)&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 animate-in fade-in duration-500",children:[{label:"Conversations",value:z.totalConversations,icon:E,color:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-900/20"},{label:"En attente",value:z.pendingTotal,icon:q,color:"text-orange-600",bg:"bg-orange-50 dark:bg-orange-900/20"},{label:"√Ä confirmer",value:z.needingHostTotal,icon:ee,color:"text-red-600",bg:"bg-red-50 dark:bg-red-900/20"},{label:"Confirm√©es",value:z.confirmedTotal,icon:se,color:"text-green-600",bg:"bg-green-50 dark:bg-green-900/20"}].map((s,i)=>e.jsx(D,{className:"border-none shadow-sm hover:translate-y-[-2px] transition-transform",children:e.jsxs(O,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-widest",children:s.label}),e.jsx("p",{className:"text-xl font-black text-gray-900 dark:text-white mt-1",children:s.value})]}),e.jsx("div",{className:j("p-2.5 rounded-xl",s.bg),children:e.jsx(s.icon,{className:j("w-4 h-4",s.color)})})]})},i))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 items-start min-h-[600px]",children:[(!o||u!=="phone")&&e.jsx("div",{className:j("flex flex-col w-full shrink-0",n?"lg:w-[450px]":"lg:w-96"),children:e.jsxs("div",{className:"space-y-4 sticky top-4",children:[e.jsx(D,{className:"border-none shadow-md overflow-hidden",children:e.jsxs(O,{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{className:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm focus:ring-2 focus:ring-primary-500 transition-all",placeholder:"Rechercher un orateur...",value:w,onChange:s=>A(s.target.value)})]}),e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-1 scrollbar-none",children:[{id:"all",label:"Tout"},{id:"pending",label:"En attente"},{id:"needs_host",label:"Sans accueil"}].map(s=>e.jsx("button",{onClick:()=>I(s.id),className:j("px-3 py-1.5 rounded-lg text-xs font-bold whitespace-nowrap transition-all uppercase tracking-tighter",N===s.id?"bg-primary-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-800 text-gray-500 hover:bg-gray-200"),children:s.label},s.id))})]})}),e.jsx("div",{className:"space-y-2 max-h-[calc(100vh-250px)] overflow-y-auto pr-2 scrollbar-thin scrollbar-thumb-gray-200 dark:scrollbar-thumb-gray-700",children:L.length>0?L.map(({speaker:s,visits:i,nextVisitDate:d})=>{const r=o?.id===s.id,h=i.some(m=>m.status==="pending"),x=i.some(m=>(!m.host||m.host==="√Ä d√©finir")&&m.locationType==="physical");return e.jsxs("button",{onClick:()=>b(s),className:j("w-full flex items-start gap-3 p-4 rounded-2xl text-left transition-all duration-200 group relative",r?"bg-white dark:bg-gray-800 shadow-xl border-l-[6px] border-primary-500 translate-x-1":"hover:bg-white/50 dark:hover:bg-white/5"),children:[e.jsxs("div",{className:j("relative w-12 h-12 rounded-2xl flex items-center justify-center font-bold text-lg shrink-0 transition-transform group-hover:scale-105",r?"bg-primary-600 text-white shadow-lg":"bg-gray-100 dark:bg-gray-800 text-gray-400"),children:[s.nom.charAt(0).toUpperCase(),(h||x)&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3.5 h-3.5 bg-red-500 border-2 border-white dark:border-gray-900 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:j("font-bold truncate text-sm uppercase tracking-tight",r?"text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"),children:s.nom}),e.jsx("span",{className:"text-[10px] text-gray-400 font-bold uppercase",children:new Date(d).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})})]}),e.jsx("p",{className:"text-[11px] text-gray-500 truncate mb-2",children:s.congregation}),e.jsxs("div",{className:"flex gap-1.5",children:[h&&e.jsx(v,{variant:"danger",className:"text-[9px] px-1.5 py-0",children:"√Ä CONFIRMER"}),x&&e.jsx(v,{variant:"warning",className:"text-[9px] px-1.5 py-0",children:"SANS ACCUEIL"}),!h&&!x&&e.jsx(v,{variant:"success",className:"text-[9px] px-1.5 py-0",children:"OK"})]})]}),e.jsx(te,{className:j("w-4 h-4 mt-1 transition-all",r?"opacity-100 text-primary-500":"opacity-0 group-hover:opacity-100 text-gray-300")})]},s.id)}):e.jsxs("div",{className:"py-20 text-center opacity-40",children:[e.jsx(re,{className:"w-8 h-8 mx-auto mb-3"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest",children:"Aucun r√©sultat"})]})})]})}),(o||t)&&e.jsx("div",{className:"flex-1 w-full min-h-[600px]",children:o?e.jsx("div",{className:"animate-in fade-in slide-in-from-right-4 duration-300 h-full",children:e.jsx(D,{className:"border-none shadow-xl h-full flex flex-col bg-gray-50 dark:bg-gray-900/40 rounded-3xl overflow-hidden",children:e.jsx(fe,{speaker:o,visits:l.filter(s=>s.id===o.id),onAction:B})})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-12 text-center animate-in zoom-in-95 duration-500",children:[e.jsxs("div",{className:"relative mb-10",children:[e.jsx("div",{className:"absolute -inset-4 bg-primary-100 dark:bg-primary-900/30 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 bg-white dark:bg-gray-800 rounded-3xl shadow-xl flex items-center justify-center",children:e.jsx(H,{className:"w-12 h-12 text-primary-500 rotate-[-15deg]"})})]}),e.jsx("h3",{className:"text-2xl font-black text-gray-900 dark:text-white tracking-tighter mb-4",children:"Pr√™t √† communiquer ?"}),e.jsx("p",{className:"text-gray-500 max-w-sm mb-12 text-sm leading-relaxed",children:"S√©lectionnez un orateur dans la liste de gauche pour pr√©parer son arriv√©e, g√©rer l'accueil ou simplement lui envoyer un message de confirmation."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-2xl",children:[{icon:F,label:"Mod√®les SMS",desc:"Gagnez du temps"},{icon:ce,label:"Suivi Pr√©cis",desc:"Statut en direct"},{icon:ue,label:"Gestion Hosting",desc:"Alertes accueil"}].map((s,i)=>e.jsxs("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700/50 hover:shadow-md transition-all",children:[e.jsx(s.icon,{className:"w-6 h-6 text-primary-500 mx-auto mb-3"}),e.jsx("p",{className:"font-bold text-xs uppercase tracking-tighter mb-1",children:s.label}),e.jsx("p",{className:"text-[10px] text-gray-400",children:s.desc})]},i))})]})})]}),S&&e.jsx(ge,{isOpen:S,onClose:()=>{C(!1),T(null)},speaker:o||p[0],visit:V||l.find(s=>s.id===o?.id)||l[0]}),a&&e.jsx(ye,{isOpen:a,onClose:()=>f(!1),visitsNeedingHost:l.filter(s=>(!s.host||s.host==="√Ä d√©finir")&&s.locationType==="physical")})]})};export{Me as Messages,Me as default};
//# sourceMappingURL=Messages-D38-X_hJ.js.map
