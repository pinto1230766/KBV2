import{j as e,B as p,f as $,g as F,s as I,M as z,C as H,n as W,u as q,t as Z,a as _,k as J,i as D,v as K,b as Q,e as m,U as X,P as Y,m as E,S as ee,A as se}from"./index-CUj4VCjl.js";import{r as h,R as L}from"./charts-CCOFnOOy.js";import{C as ae}from"./CommunicationProgress-D-eCyIL9.js";import{P as te,M as re,U as ne,I as le}from"./Select-Bwvzh9xp.js";import{M as ie}from"./mail-CathfI1s.js";import{C as O,a as de}from"./copy-BQBGxYHl.js";import{f as oe}from"./utils-FTT-aY8U.js";import{g as ce,C as xe,S as me,M as P}from"./MessageGeneratorModal-BGVep8eO.js";import"./react-vendor-B9D_A6Vq.js";const ge=({speaker:r,visits:u,onAction:x})=>{const o=[...u.filter((t,n,f)=>n===f.findIndex(i=>i.id===t.id))].sort((t,n)=>new Date(n.visitDate).getTime()-new Date(t.visitDate).getTime());return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 p-4 flex items-center justify-between shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:r.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-gray-900 dark:text-white",children:r.nom}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.congregation})]})]}),e.jsxs("div",{className:"flex gap-2",children:[r.telephone&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(`tel:${r.telephone}`),children:e.jsx(te,{className:"w-4 h-4"})}),r.email&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(`mailto:${r.email}`),children:e.jsx(ie,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:o.length>0?o.map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400 font-medium uppercase tracking-wider justify-center my-4",children:[e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"}),oe(new Date(t.visitDate),"d MMMM yyyy",{locale:W}),e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 h-px w-12"})]}),e.jsx($,{children:e.jsxs(F,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white",children:["Discours n¬∞",t.talkNoOrType]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.talkTheme||I(t.talkNoOrType)})]}),e.jsx("span",{className:`
                      px-2 py-1 rounded-full text-xs font-medium
                      ${t.status==="confirmed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}
                    `,children:t.status==="confirmed"?"Confirm√©":t.status==="pending"?"En attente":t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-400"}),t.visitTime]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-gray-400"}),t.locationType==="physical"?"Salle du Royaume":"Zoom"]}),t.host&&e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(ne,{className:"w-4 h-4 text-gray-400"}),"H√©berg√© par ",t.host]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ae,{visit:t,showLabels:!0,size:"md"})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(p,{size:"sm",variant:"primary",leftIcon:e.jsx(z,{className:"w-4 h-4"}),onClick:()=>x("whatsapp",t),children:"G√©n√©rer un message"}),t.status==="pending"&&e.jsx(p,{size:"sm",variant:"primary",onClick:()=>x("confirm",t),children:"Confirmer"})]})]})})]},t.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"Aucune visite programm√©e avec cet orateur"})]})})]})},he=({isOpen:r,onClose:u,visitsNeedingHost:x})=>{const{congregationProfile:C}=q(),{settings:o}=Z(),{addToast:t}=_(),[n,f]=h.useState(new Set(x.map(a=>a.visitId))),[i,M]=h.useState("");L.useEffect(()=>{n.size>0&&y()},[n]);const y=()=>{const a=x.filter(k=>n.has(k.visitId)),g=ce(a,C,o.language);M(g)},V=a=>{const g=new Set(n);g.has(a)?g.delete(a):g.add(a),f(g)},N=()=>{n.size===x.length?f(new Set):f(new Set(x.map(a=>a.visitId)))},w=async()=>{try{await navigator.clipboard.writeText(i),t("Message copi√© dans le presse-papier","success")}catch{t("Erreur lors de la copie","error")}},A=()=>{const a=encodeURIComponent(i);window.open(`https://wa.me/?text=${a}`,"_blank"),u()};return e.jsx(J,{isOpen:r,onClose:u,title:"Demande d'accueil group√©e",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(p,{variant:"ghost",onClick:u,children:"Annuler"}),e.jsx(p,{variant:"secondary",onClick:w,leftIcon:e.jsx(de,{className:"w-4 h-4"}),disabled:n.size===0,children:"Copier"}),e.jsx(p,{onClick:A,leftIcon:e.jsx(me,{className:"w-4 h-4"}),disabled:n.size===0,children:"Envoyer (WhatsApp)"})]}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-orange-900 dark:text-orange-300",children:[x.length," visite",x.length>1?"s":""," sans contact d'accueil"]}),e.jsx("p",{className:"text-sm text-orange-700 dark:text-orange-400 mt-1",children:"S√©lectionnez les visites pour lesquelles demander un contact"})]}),e.jsxs(D,{variant:"warning",size:"md",children:[n.size," s√©lectionn√©e",n.size>1?"s":""]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Visites"}),e.jsx("button",{onClick:N,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:n.size===x.length?"Tout d√©s√©lectionner":"Tout s√©lectionner"})]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2 border border-gray-200 dark:border-gray-700 rounded-lg p-3",children:x.map(a=>e.jsxs("label",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.has(a.visitId),onChange:()=>V(a.visitId),className:"mt-1 w-4 h-4 text-primary-600 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:a.nom}),e.jsx(D,{variant:"default",size:"sm",children:K(a.visitDate,o.language)})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[a.congregation," ‚Ä¢ ",a.visitTime]}),(a.talkTheme||I(a.talkNoOrType))&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["N¬∞",a.talkNoOrType," - ",a.talkTheme||I(a.talkNoOrType)]})]})]},a.visitId))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-2",children:"Aper√ßu du message"}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{className:"w-full h-64 p-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none font-mono text-sm",value:i,onChange:a=>M(a.target.value),placeholder:n.size===0?"S√©lectionnez au moins une visite pour g√©n√©rer le message...":"G√©n√©ration du message...",disabled:n.size===0}),n.size>0&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs(D,{variant:"success",size:"sm",children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),"Message pr√™t"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:"üí° Vous pouvez modifier le message avant de l'envoyer"})]})]})})},ve=()=>{const{visits:r,speakers:u,updateVisit:x,refreshData:C}=q(),{isPhoneS25Ultra:o,deviceType:t}=Q(),n=t==="tablet",f=n&&window.innerWidth>=1200;L.useEffect(()=>{C&&C()},[]);const[i,M]=h.useState(null),[y,V]=h.useState(""),[N,w]=h.useState(!1),[A,a]=h.useState(!1),[g,k]=h.useState(null),j=h.useMemo(()=>{const s=[],d=new Set;return u.forEach(l=>{if(!d.has(l.id)){d.add(l.id);const c=r.filter(v=>{const b=(v.talkNoOrType||"").toLowerCase(),S=b.includes("assembl")||b.includes("congr")||b.includes("especial")||b.includes("circun");return v.id===l.id&&!S&&v.status!=="cancelled"});if(c.length>0){const v=[...c].sort((S,B)=>new Date(S.visitDate).getTime()-new Date(B.visitDate).getTime()),b=v.filter(S=>new Date(S.visitDate)>=new Date(new Date().setHours(0,0,0,0)));b.length>0&&s.push({speaker:l,visits:v,nextVisitDate:b[0].visitDate})}}}),s.sort((l,c)=>new Date(l.nextVisitDate).getTime()-new Date(c.nextVisitDate).getTime())},[r,u]),R=h.useMemo(()=>j.filter(s=>s.speaker.nom.toLowerCase().includes(y.toLowerCase())||s.speaker.congregation.toLowerCase().includes(y.toLowerCase())||s.nextVisitDate.includes(y)),[j,y]),T=h.useMemo(()=>{const s=j.length,d=r.filter(c=>c.status==="pending").length,l=r.filter(c=>!c.host||c.host==="√Ä d√©finir"||c.host==="").length;return{total:s,pending:d,needingHost:l}},[j,r]),U=s=>{switch(s.status){case"pending":return e.jsx(O,{className:"w-4 h-4 text-orange-500"});case"confirmed":return e.jsx(E,{className:"w-4 h-4 text-green-500"});default:return e.jsx(se,{className:"w-4 h-4 text-gray-500"})}},G=(s,d)=>{if(s==="whatsapp"||s==="email")d&&i&&(k(d),w(!0));else if(s==="confirm"&&d){const l={...d,status:"confirmed",updatedAt:new Date().toISOString()};x(l)}else s==="host_request"&&d&&(k(d),a(!0))};return e.jsxs("div",{className:m("min-h-[calc(100vh-12rem)] flex flex-col",o&&"s25-ultra-optimized"),children:[e.jsxs("div",{className:m("flex justify-end gap-3 mb-6",o&&"flex-col gap-2"),children:[T.needingHost>0&&e.jsxs(p,{variant:"secondary",className:"bg-orange-100 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-300 dark:hover:bg-orange-900/50",leftIcon:e.jsx(X,{className:"w-4 h-4"}),onClick:()=>a(!0),children:["Demande d'accueil (",T.needingHost,")"]}),e.jsx(p,{variant:"secondary",leftIcon:e.jsx(Y,{className:"w-4 h-4"}),onClick:()=>w(!0),children:"Nouveau message"})]}),e.jsxs("div",{className:m("grid gap-3 mb-4",o?"grid-cols-1":"grid-cols-3"),children:[e.jsx("div",{className:m("bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-200 dark:border-blue-800",o&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-blue-900 dark:text-blue-100 leading-tight",children:T.total}),e.jsx("div",{className:"text-[10px] text-blue-700 dark:text-blue-300",children:"Orateurs"})]})]})}),e.jsx("div",{className:m("bg-orange-50 dark:bg-orange-900/20 p-3 rounded-lg border border-orange-200 dark:border-orange-800",o&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-orange-900 dark:text-orange-100 leading-tight",children:T.pending}),e.jsx("div",{className:"text-[10px] text-orange-700 dark:text-orange-300",children:"En attente"})]})]})}),e.jsx("div",{className:m("bg-green-50 dark:bg-green-900/20 p-3 rounded-lg border border-green-200 dark:border-green-800",o&&"s25-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-600 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-green-900 dark:text-green-100 leading-tight",children:r.filter(s=>s.status==="confirmed").length}),e.jsx("div",{className:"text-[10px] text-green-700 dark:text-green-300",children:"Confirm√©es"})]})]})})]}),e.jsx("div",{className:m("flex items-center bg-white dark:bg-gray-800 p-2 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 mb-4",o&&"p-1"),children:e.jsx(le,{placeholder:"Rechercher un orateur ou une date (AAAA-MM-DD)...",leftIcon:e.jsx(ee,{className:"w-4 h-4"}),value:y,onChange:s=>V(s.target.value),className:"w-full border-none focus:ring-0 bg-transparent"})}),e.jsxs("div",{className:m("flex-1 flex gap-6 min-h-0",o&&"flex-col gap-4"),children:[e.jsxs("div",{className:m("flex flex-col bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",o?"w-full min-h-0 flex-1":f?"w-[800px]":"w-full lg:w-96"),children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Orateurs"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:R.length>0?e.jsx("div",{className:m("grid gap-3",f?"grid-cols-3":n?"grid-cols-2":"grid-cols-1"),children:R.map(({speaker:s,visits:d})=>e.jsx("div",{onClick:()=>M(s),className:m("p-3 rounded-lg cursor-pointer border transition-all",i?.id===s.id?"bg-primary-50 dark:bg-primary-900/20 border-primary-500 shadow-sm":"border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:border-gray-200 dark:hover:border-gray-600"),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold flex-shrink-0",children:s.nom.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white leading-tight",children:s.nom}),d.some(l=>l.status==="pending")&&e.jsx(D,{variant:"danger",className:"text-[10px] px-1.5 py-0 flex-shrink-0",children:"!"})]}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400 font-medium leading-tight",children:s.congregation}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] font-medium text-primary-600 dark:text-primary-400",children:new Date(j.find(l=>l.speaker.id===s.id)?.nextVisitDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"})}),e.jsx(D,{className:"text-[9px] px-1 py-0 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-none",children:d.find(l=>l.visitDate===j.find(c=>c.speaker.id===s.id)?.nextVisitDate)?.locationType==="physical"?"Pr√©sentiel":d.find(l=>l.visitDate===j.find(c=>c.speaker.id===s.id)?.nextVisitDate)?.locationType==="zoom"?"Zoom":"Streaming"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[d.some(l=>U(l)),e.jsx("span",{className:"text-[10px] text-gray-400 dark:text-gray-500",children:s.telephone||s.email?"Contact√©":"Sans contact"})]})]})},s.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(z,{className:"w-12 h-12 mb-4 opacity-20"}),e.jsx("p",{className:"text-center",children:y?"Aucun orateur trouv√©":"Aucun orateur"})]})})]}),e.jsx("div",{className:m("flex-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden",o&&"w-full"),children:i?e.jsx(ge,{speaker:i,visits:r.filter(s=>s.nom===i.nom),onAction:G}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx(z,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"S√©lectionnez un orateur"}),e.jsx("p",{className:"text-center max-w-md",children:"Choisissez un orateur dans la liste pour voir les d√©tails et envoyer des messages."})]})})]}),N&&i&&g&&e.jsx(P,{isOpen:N,onClose:()=>{w(!1),k(null)},speaker:i,visit:g}),N&&!g&&e.jsx(P,{isOpen:N,onClose:()=>{w(!1),k(null)},speaker:i||u[0],visit:i&&(r.find(s=>s.id===i.id&&(s.status==="pending"||s.status==="confirmed"))||r.find(s=>s.id===i.id))||r[0]}),e.jsx(he,{isOpen:A,onClose:()=>a(!1),visitsNeedingHost:r.filter(s=>!s.host||s.host==="√Ä d√©finir"||s.host==="")})]})};export{ve as Messages};
//# sourceMappingURL=Messages-FYYQ-1Ny.js.map
