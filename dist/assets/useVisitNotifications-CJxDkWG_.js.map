{"version":3,"mappings":";gJASK,MAACA,EAAOC,EAAiB,OAAQ,CACpC,CAAC,OAAQ,CAAE,EAAG,8DAA+D,IAAK,QAAQ,CAAE,EAC5F,CAAC,OAAQ,CAAE,EAAG,+DAAgE,IAAK,QAAQ,CAAE,CAC/F,CAAC,ECHI,MAACC,EAAOD,EAAiB,OAAQ,CACpC,CAAC,OAAQ,CAAE,EAAG,kEAAmE,IAAK,QAAQ,CAAE,EAChG,CAAC,WAAY,CAAE,OAAQ,wBAAyB,IAAK,QAAQ,CAAE,EAC/D,CAAC,WAAY,CAAE,OAAQ,eAAgB,IAAK,QAAQ,CAAE,CACxD,CAAC,ECTM,IAAIE,GACV,SAAUA,EAAS,CAChBA,EAAQA,EAAQ,OAAY,CAAC,EAAI,SACjCA,EAAQA,EAAQ,OAAY,CAAC,EAAI,SACjCA,EAAQA,EAAQ,QAAa,CAAC,EAAI,UAClCA,EAAQA,EAAQ,UAAe,CAAC,EAAI,YACpCA,EAAQA,EAAQ,SAAc,CAAC,EAAI,WACnCA,EAAQA,EAAQ,OAAY,CAAC,EAAI,SACjCA,EAAQA,EAAQ,SAAc,CAAC,EAAI,UACvC,GAAGA,IAAYA,EAAU,GAAG,ECZvB,MAACC,EAAqBC,EAAe,qBAAsB,CAC5D,IAAK,IAAKC,EAAA,IAAC,OAAO,mBAAO,kCAAE,KAAKC,GAAK,IAAIA,EAAE,qBAAuB,CACtE,CAAC,ECIM,SAASC,GAAwB,CACtC,KAAM,CAAE,SAAAC,CAAA,EAAaC,EAAA,EAEfC,EAAqBC,cAAY,UACtB,MAAMR,EAAmB,sBAC1B,UAAY,UACzB,EAAE,EAECS,EAAwBD,cAC5B,MAAOE,GAAiB,CACtB,GAAI,CAACL,EAAS,cAAc,QAAS,OAErC,MAAMM,EAAY,IAAI,KAAKD,EAAM,SAAS,EAEpCE,EACJP,EAAS,cAAc,aAAa,OAAS,EAAIA,EAAS,cAAc,aAAe,CAAC,CAAC,EAE3F,UAAWQ,KAAcD,EAAW,CAClC,MAAME,EAAe,IAAI,KAAKH,CAAS,EAKvC,GAJAG,EAAa,QAAQH,EAAU,UAAYE,CAAU,EACrDC,EAAa,SAAS,EAAG,EAAG,EAAG,CAAC,EAG5B,EAAAA,EAAa,UAAY,KAAK,OAElC,GAAI,CACF,MAAMd,EAAmB,SAAS,CAChC,cAAe,CACb,CACE,MAAO,mBACP,KAAM,aAAaU,EAAM,GAAG,cAAcK,EAAOJ,EAAW,cAAe,CAAE,OAAQK,CAAA,CAAI,CAAC,OAAOH,CAAU,IAC3G,GACE,SAASH,EAAM,GAAG,QAAQ,MAAO,EAAE,EAAE,UAAU,EAAG,CAAC,CAAC,EAAIG,EAAa,KACrE,KAAK,MAAM,KAAK,SAAW,GAAM,EACnC,SAAU,CAAE,GAAIC,CAAA,EAChB,MAAO,UACP,YAAa,GACb,aAAc,GACd,MAAO,CAAE,QAASJ,EAAM,GAAG,CAC7B,CACF,CACD,CACH,OAASO,EAAO,CACd,QAAQ,MAAM,sDAAuDA,CAAK,CAC5E,CACF,CACF,EACA,CAACZ,EAAS,aAAa,GAGnBa,EAAsBV,cAAY,MAAOW,GAAoB,CAIjE,MAAMC,GADU,MAAMpB,EAAmB,cACZ,cAAc,KAAMqB,GAAMA,EAAE,OAAO,UAAYF,CAAO,EAE/EC,GACF,MAAMpB,EAAmB,OAAO,CAAE,cAAe,CAAC,CAAE,GAAIoB,EAAa,GAAI,EAAG,CAEhF,EAAG,EAAE,EAEL,MAAO,CACL,mBAAAb,EACA,sBAAAE,EACA,oBAAAS,CAAA,CAEJ","names":["Link","createLucideIcon","Save","Weekday","LocalNotifications","registerPlugin","__vitePreload","m","useVisitNotifications","settings","useSettings","requestPermissions","useCallback","scheduleVisitReminder","visit","visitDate","reminders","daysBefore","reminderDate","format","fr","error","cancelVisitReminder","visitId","notification","n"],"ignoreList":[0,1,2,3],"sources":["../../node_modules/lucide-react/dist/esm/icons/link.js","../../node_modules/lucide-react/dist/esm/icons/save.js","../../node_modules/@capacitor/local-notifications/dist/esm/definitions.js","../../node_modules/@capacitor/local-notifications/dist/esm/index.js","../../src/hooks/useVisitNotifications.ts"],"sourcesContent":["/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Link = createLucideIcon(\"Link\", [\n  [\"path\", { d: \"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71\", key: \"1cjeqo\" }],\n  [\"path\", { d: \"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71\", key: \"19qd67\" }]\n]);\n\nexport { Link as default };\n//# sourceMappingURL=link.js.map\n","/**\n * @license lucide-react v0.294.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Save = createLucideIcon(\"Save\", [\n  [\"path\", { d: \"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z\", key: \"1owoqh\" }],\n  [\"polyline\", { points: \"17 21 17 13 7 13 7 21\", key: \"1md35c\" }],\n  [\"polyline\", { points: \"7 3 7 8 15 8\", key: \"8nz8an\" }]\n]);\n\nexport { Save as default };\n//# sourceMappingURL=save.js.map\n","/// <reference types=\"@capacitor/cli\" />\n/**\n * Day of the week. Used for scheduling notifications on a particular weekday.\n */\nexport var Weekday;\n(function (Weekday) {\n    Weekday[Weekday[\"Sunday\"] = 1] = \"Sunday\";\n    Weekday[Weekday[\"Monday\"] = 2] = \"Monday\";\n    Weekday[Weekday[\"Tuesday\"] = 3] = \"Tuesday\";\n    Weekday[Weekday[\"Wednesday\"] = 4] = \"Wednesday\";\n    Weekday[Weekday[\"Thursday\"] = 5] = \"Thursday\";\n    Weekday[Weekday[\"Friday\"] = 6] = \"Friday\";\n    Weekday[Weekday[\"Saturday\"] = 7] = \"Saturday\";\n})(Weekday || (Weekday = {}));\n//# sourceMappingURL=definitions.js.map","import { registerPlugin } from '@capacitor/core';\nconst LocalNotifications = registerPlugin('LocalNotifications', {\n    web: () => import('./web').then(m => new m.LocalNotificationsWeb()),\n});\nexport * from './definitions';\nexport { LocalNotifications };\n//# sourceMappingURL=index.js.map","import { useCallback } from 'react';\nimport { LocalNotifications } from '@capacitor/local-notifications';\nimport { Visit } from '@/types';\nimport { useSettings } from '@/contexts/SettingsContext';\nimport { format } from 'date-fns';\nimport { fr } from 'date-fns/locale';\n\nexport function useVisitNotifications() {\n  const { settings } = useSettings();\n\n  const requestPermissions = useCallback(async () => {\n    const result = await LocalNotifications.requestPermissions();\n    return result.display === 'granted';\n  }, []);\n\n  const scheduleVisitReminder = useCallback(\n    async (visit: Visit) => {\n      if (!settings.notifications.enabled) return;\n\n      const visitDate = new Date(visit.visitDate);\n      // Programmer les rappels pour chaque délai configuré\n      const reminders =\n        settings.notifications.reminderDays.length > 0 ? settings.notifications.reminderDays : [3]; // Par défaut 3 jours avant\n\n      for (const daysBefore of reminders) {\n        const reminderDate = new Date(visitDate);\n        reminderDate.setDate(visitDate.getDate() - daysBefore);\n        reminderDate.setHours(9, 0, 0, 0); // À 9h du matin\n\n        // Ne pas programmer si la date est passée\n        if (reminderDate.getTime() < Date.now()) continue;\n\n        try {\n          await LocalNotifications.schedule({\n            notifications: [\n              {\n                title: 'Rappel de visite',\n                body: `Visite de ${visit.nom} prévue le ${format(visitDate, 'EEEE d MMMM', { locale: fr })} (J-${daysBefore})`,\n                id:\n                  parseInt(visit.id.replace(/\\D/g, '').substring(0, 5)) + daysBefore * 10000 ||\n                  Math.floor(Math.random() * 100000),\n                schedule: { at: reminderDate },\n                sound: 'default',\n                attachments: [],\n                actionTypeId: '',\n                extra: { visitId: visit.id },\n              },\n            ],\n          });\n        } catch (error) {\n          console.error('Erreur lors de la programmation de la notification:', error);\n        }\n      }\n    },\n    [settings.notifications]\n  );\n\n  const cancelVisitReminder = useCallback(async (visitId: string) => {\n    // Note: Idéalement, il faudrait stocker l'ID de notification associé à la visite\n    // Pour l'instant, c'est une implémentation simplifiée\n    const pending = await LocalNotifications.getPending();\n    const notification = pending.notifications.find((n) => n.extra?.visitId === visitId);\n\n    if (notification) {\n      await LocalNotifications.cancel({ notifications: [{ id: notification.id }] });\n    }\n  }, []);\n\n  return {\n    requestPermissions,\n    scheduleVisitReminder,\n    cancelVisitReminder,\n  };\n}\n"],"file":"useVisitNotifications-CJxDkWG_.js"}