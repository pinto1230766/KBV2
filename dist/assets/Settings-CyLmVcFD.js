import{c as B,u as le,j as e,k as ne,m as Q,f as V,g as H,i as _,l as me,B as L,D as te,F as Oe,S as Le,C as $e,X as Re,U as fe,A as Pe,t as Ue,a as qe,x as pe,h as X,w as Ve}from"./index-bnVslkA6.js";import{r as m,R as He}from"./charts-CCOFnOOy.js";import{P as oe,M as Ge,U as ie,I as K,S as de}from"./Select-26hgwUaR.js";import{T as ke,S as xe}from"./trash-2-CY5rOcGh.js";import{a as Y,C as ue}from"./copy-CGzJgjrd.js";import{A as ce,a as Be,R as _e}from"./rotate-ccw-BU5mQ1Mp.js";import{L as Je}from"./link-IbseOFph.js";import"./react-vendor-B9D_A6Vq.js";import"./utils-FTT-aY8U.js";const re=B("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);const ye=B("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);const Ye=B("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]);const We=B("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);const Xe=B("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);const be=B("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);const ae=B("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);const Ke=B("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);const Ze=B("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);const ee=B("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Qe=({isOpen:T,onClose:v,onMerge:E})=>{const{speakers:i,hosts:g,visits:d,speakerMessages:S,archivedVisits:$}=le(),[f,O]=m.useState(new Set),[p,P]=m.useState("keep-recent"),[y,M]=m.useState(!1),o=95,C=90,b=m.useMemo(()=>{const s=[],n=new Map;i.forEach(r=>{const x=r.nom.toLowerCase().trim().replace(/\s+/g," ");n.has(x)||n.set(x,[]),n.get(x).push(r)}),n.forEach(r=>{if(r.length>1){const j=["Nom identique"],x=r.map(R=>R.telephone).filter(Boolean);x.length>1&&new Set(x).size<x.length&&j.push("T√©l√©phone identique");const F=r.map(R=>R.congregation);new Set(F).size===1&&j.push("M√™me congr√©gation");const G=o;s.push({type:"speaker",items:r,similarity:G,reason:j})}});const t=new Map;g.forEach(r=>{const x=r.nom.toLowerCase().trim().replace(/\s+/g," ");t.has(x)||t.set(x,[]),t.get(x).push(r)}),t.forEach(r=>{if(r.length>1){const j=["Nom identique"],x=r.map(R=>R.telephone).filter(Boolean);x.length>1&&new Set(x).size<x.length&&j.push("T√©l√©phone identique");const F=r.map(R=>R.address).filter(Boolean);F.length>1&&new Set(F).size<F.length&&j.push("Adresse identique");const G=o;s.push({type:"host",items:r,similarity:G,reason:j})}});const l=new Map;if(d.forEach(r=>{const j=`${r.id}-${r.visitDate}-${r.visitTime}`;l.has(j)||l.set(j,[]),l.get(j).push(r)}),l.forEach(r=>{r.length>1&&s.push({type:"visit",items:r,similarity:100,reason:["M√™me orateur, date et heure"]})}),y&&$){const r=new Map;$.forEach(x=>{const F=`${x.id}-${x.visitDate}-${x.visitTime}`;r.has(F)||r.set(F,[]),r.get(F).push(x)}),r.forEach(x=>{x.length>1&&s.push({type:"archivedVisit",items:x,similarity:100,reason:["Doublon dans les archives - M√™me orateur, date et heure"]})});const j=new Map;d.forEach(x=>{const F=`${x.id}-${x.visitDate}-${x.visitTime}`;j.has(F)||j.set(F,[]),j.get(F).push({...x,_source:"current"}),$.filter(R=>R.id===x.id&&R.visitDate===x.visitDate&&R.visitTime===x.visitTime).forEach(R=>{j.get(F).push({...R,_source:"archived"})})}),j.forEach(x=>{x.length>1&&s.push({type:"archivedVisit",items:x,similarity:100,reason:["Doublon entre visites actuelles et archiv√©es"]})})}const c=new Map;return S&&S.length>0&&S.forEach(r=>{const j=r.message?.trim().toLowerCase()||"",x=r.receivedAt?new Date(r.receivedAt).toISOString():"no-date",F=`${r.speakerId}-${j}-${x}`;c.has(F)||c.set(F,[]),c.get(F).push(r)}),c.forEach(r=>{r.length>1&&s.push({type:"message",items:r,similarity:100,reason:["Contenu et date identiques"]})}),s},[i,g,d,S,$,y]),h=s=>{O(n=>{const t=new Set(n);return t.has(s)?t.delete(s):t.add(s),t})},I=()=>{const s=Array.from(f).map(n=>b[n]);E(s,"merge",p),O(new Set)},k=()=>{const s=Array.from(f).map(n=>b[n]);E(s,"delete",p),O(new Set)},D=s=>{switch(s){case"speaker":return"Orateur";case"host":return"H√¥te";case"visit":return"Visite";case"archivedVisit":return"Visite archiv√©e";case"message":return"Message";default:return"Inconnu"}},z=s=>{switch(s){case"speaker":return"bg-blue-100 text-blue-700 dark:bg-blue-900/20 dark:text-blue-300";case"host":return"bg-green-100 text-green-700 dark:bg-green-900/20 dark:text-green-300";case"visit":return"bg-purple-100 text-purple-700 dark:bg-purple-900/20 dark:text-purple-300";case"archivedVisit":return"bg-orange-100 text-orange-700 dark:bg-orange-900/20 dark:text-orange-300";case"message":return"bg-red-100 text-red-700 dark:bg-red-900/20 dark:text-red-300";default:return"bg-gray-100 text-gray-700 dark:bg-gray-900/20 dark:text-gray-300"}};return e.jsx(ne,{isOpen:T,onClose:v,title:"D√©tection de doublons",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:b.filter(s=>s.type==="speaker").length}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Orateurs"})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:b.filter(s=>s.type==="host").length}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:"H√¥tes"})]}),e.jsxs("div",{className:"p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b.filter(s=>s.type==="visit").length}),e.jsx("div",{className:"text-sm text-purple-800 dark:text-purple-300",children:"Visites"})]}),e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.filter(s=>s.type==="archivedVisit").length}),e.jsx("div",{className:"text-sm text-orange-800 dark:text-orange-300",children:"Archives"})]}),e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.filter(s=>s.type==="message").length}),e.jsx("div",{className:"text-sm text-red-800 dark:text-red-300",children:"Messages"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("input",{type:"checkbox",id:"include-archives",checked:y,onChange:s=>M(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("label",{htmlFor:"include-archives",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Inclure les archives dans l'analyse"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"D√©tecte les doublons dans les visites archiv√©es et entre visites actuelles/archiv√©es"})]})]}),f.size>0&&e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Strat√©gie de fusion"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"keep-recent",checked:p==="keep-recent",onChange:s=>P(s.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Conserver l'entr√©e la plus r√©cente"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",value:"keep-first",checked:p==="keep-first",onChange:s=>P(s.target.value),className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Conserver la premi√®re entr√©e"})]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun doublon d√©tect√©"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vos donn√©es sont propres et sans doublons"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-100 dark:bg-gray-800 rounded-lg mb-2 sticky top-0 z-10",children:[e.jsx("input",{type:"checkbox","aria-label":"Tout s√©lectionner",checked:b.length>0&&f.size===b.length,onChange:s=>{s.target.checked?O(new Set(b.map((n,t)=>t))):O(new Set)},className:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Tout s√©lectionner (",b.length,")"]}),f.size>0&&e.jsxs("span",{className:"text-sm text-gray-500 ml-auto",children:[f.size," s√©lectionn√©(s)"]})]}),b.map((s,n)=>e.jsx(V,{className:`${s.similarity>=C?"border-l-4 border-l-red-600":"border-l-4 border-l-orange-500"} ${f.has(n)?"ring-2 ring-primary-500":""}`,children:e.jsx(H,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:f.has(n),onChange:()=>h(n),"aria-label":`S√©lectionner ce groupe de doublons ${D(s.type)}`,className:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(_,{className:z(s.type),children:D(s.type)}),e.jsxs(_,{variant:"warning",children:[s.similarity,"% similaire"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.reason.map((t,l)=>e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:["‚Ä¢ ",t]},l))})]})]}),e.jsx(Y,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.items.map((t,l)=>e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white mb-2",children:s.type==="message"?t.subject||"Message sans sujet":t.nom||`Visite ${l+1}`}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400",children:[s.type==="speaker"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Congr√©gation : ",t.congregation]}),t.telephone&&e.jsxs("div",{children:["T√©l : ",t.telephone]}),t.email&&e.jsxs("div",{children:["Email : ",t.email]}),e.jsxs("div",{children:["Visites : ",d.filter(c=>c.id===t.id).length]}),e.jsxs("div",{children:["Messages :"," ",d.filter(c=>c.id===t.id&&c.communicationStatus).length]}),t.createdAt&&e.jsxs("div",{className:"text-xs",children:["Cr√©√© : ",new Date(t.createdAt).toLocaleDateString("fr-FR")]})]}),s.type==="host"&&e.jsxs(e.Fragment,{children:[t.telephone&&e.jsxs("div",{children:["T√©l : ",t.telephone]}),t.address&&e.jsxs("div",{children:["Adresse : ",t.address]}),t.createdAt&&e.jsxs("div",{className:"text-xs",children:["Cr√©√© : ",new Date(t.createdAt).toLocaleDateString("fr-FR")]})]}),s.type==="visit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Date : ",new Date(t.visitDate).toLocaleDateString("fr-FR")]}),e.jsxs("div",{children:["Heure : ",t.visitTime]}),e.jsxs("div",{children:["Statut : ",t.status]})]}),s.type==="archivedVisit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Date : ",new Date(t.visitDate).toLocaleDateString("fr-FR")]}),e.jsxs("div",{children:["Heure : ",t.visitTime||"N/A"]}),e.jsxs("div",{children:["Statut : ",t.status]}),t._source&&e.jsx("div",{className:"mt-1",children:e.jsx(_,{variant:t._source==="archived"?"warning":"success",className:"text-xs",children:t._source==="archived"?"Archiv√©e":"Actuelle"})})]}),s.type==="message"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Orateur : ",t.speakerName]}),e.jsxs("div",{children:["Date : ",new Date(t.receivedAt).toLocaleDateString("fr-FR")," ",new Date(t.receivedAt).toLocaleTimeString("fr-FR")]}),e.jsxs("div",{className:"line-clamp-2",children:["Contenu : ",t.message]})]})]})]},l))})]})})},n))]})}),f.size>0&&e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:[e.jsx(me,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-orange-800 dark:text-orange-300",children:[e.jsx("strong",{children:"Attention :"})," La fusion des doublons est irr√©versible. Assurez-vous de v√©rifier les donn√©es avant de continuer."]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(L,{variant:"secondary",onClick:v,children:"Fermer"}),f.size>0&&e.jsxs(e.Fragment,{children:[e.jsxs(L,{variant:"danger",onClick:k,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Supprimer les doublons (",f.size,")"]}),e.jsxs(L,{variant:"primary",onClick:I,children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Fusionner (",f.size,")"]})]})]})]})})},es=({isOpen:T,onClose:v,onBackup:E,onRestore:i})=>{const[g,d]=m.useState("backup"),[S,$]=m.useState(!0),[f,O]=m.useState(!0),[p,P]=m.useState(!0),[y,M]=m.useState(!1),[o,C]=m.useState(""),[b,h]=m.useState(""),[I,k]=m.useState(!1),[D,z]=m.useState(null),s=[{id:"1",date:new Date().toISOString(),size:2048576,itemsCount:150,encrypted:!0}],n=async()=>{if(y&&o!==b){alert("Les mots de passe ne correspondent pas");return}k(!0);try{await E({includeArchived:S,includeSettings:f,includeTemplates:p,encrypt:y,password:y?o:void 0}),C(""),h(""),k(!1)}catch(r){console.error("Erreur lors de la sauvegarde:",r),k(!1)}},t=r=>{const j=r.target.files?.[0];j&&z(j)},l=async()=>{if(D&&confirm("‚ö†Ô∏è La restauration remplacera toutes les donn√©es actuelles. √ätes-vous s√ªr de vouloir continuer ?"))try{await i(D),v()}catch(r){console.error("Erreur lors de la restauration:",r)}},c=r=>r<1024?`${r} B`:r<1024*1024?`${(r/1024).toFixed(2)} KB`:`${(r/(1024*1024)).toFixed(2)} MB`;return e.jsx(ne,{isOpen:T,onClose:v,title:"Gestion des sauvegardes",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>d("backup"),className:`px-4 py-2 font-medium transition-colors ${g==="backup"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(xe,{className:"w-4 h-4 inline mr-2"}),"Cr√©er une sauvegarde"]}),e.jsxs("button",{onClick:()=>d("restore"),className:`px-4 py-2 font-medium transition-colors ${g==="restore"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(ee,{className:"w-4 h-4 inline mr-2"}),"Restaurer"]}),e.jsxs("button",{onClick:()=>d("history"),className:`px-4 py-2 font-medium transition-colors ${g==="history"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}`,children:[e.jsx(ue,{className:"w-4 h-4 inline mr-2"}),"Historique"]})]}),g==="backup"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Sauvegarde locale :"})," Les donn√©es seront export√©es dans un fichier JSON t√©l√©chargeable. Conservez ce fichier en lieu s√ªr pour pouvoir restaurer vos donn√©es en cas de besoin."]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:"Donn√©es √† inclure"}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S,onChange:r=>$(r.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Visites archiv√©es"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Inclure l'historique complet des visites pass√©es"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:r=>O(r.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Param√®tres de l'application"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Th√®me, langue, notifications, etc."})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:r=>P(r.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Templates personnalis√©s"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Mod√®les de messages et configurations personnalis√©es"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:r=>M(r.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Chiffrer la sauvegarde"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Prot√©ger les donn√©es sensibles avec un mot de passe"})]})]}),y&&e.jsxs("div",{className:"space-y-3 pl-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Mot de passe"}),e.jsx("input",{type:"password",value:o,onChange:r=>C(r.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Entrez un mot de passe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Confirmer le mot de passe"}),e.jsx("input",{type:"password",value:b,onChange:r=>h(r.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",placeholder:"Confirmez le mot de passe"})]})]})]}),e.jsxs(L,{variant:"primary",onClick:n,disabled:I||y&&(!o||o!==b),className:"w-full",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),I?"Cr√©ation en cours...":"Cr√©er et t√©l√©charger la sauvegarde"]})]}),g==="restore"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-orange-800 dark:text-orange-300",children:[e.jsx("strong",{children:"Attention :"})," La restauration remplacera toutes les donn√©es actuelles. Assurez-vous d'avoir cr√©√© une sauvegarde r√©cente avant de continuer."]})]})}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"S√©lectionner un fichier de sauvegarde"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Fichier JSON (.json) export√© pr√©c√©demment"}),e.jsx("input",{type:"file",accept:".json",onChange:t,className:"hidden",id:"backup-file"}),e.jsx("label",{htmlFor:"backup-file",children:e.jsx("span",{className:"inline-flex items-center justify-center px-4 py-2 border-2 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 text-gray-700 dark:text-gray-300 font-medium rounded-lg cursor-pointer transition-colors",children:"Parcourir"})})]})}),D&&e.jsx("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-green-900 dark:text-green-200",children:D.name}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:c(D.size)})]})]}),e.jsx(L,{variant:"danger",onClick:l,children:"Restaurer"})]})})]}),g==="history"&&e.jsx("div",{className:"space-y-4",children:s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucune sauvegarde"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Cr√©ez votre premi√®re sauvegarde pour s√©curiser vos donn√©es"})]}):s.map(r=>e.jsx(V,{children:e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 dark:bg-primary-900 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6 text-primary-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:new Date(r.date).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r.itemsCount," √©l√©ments ‚Ä¢ ",c(r.size),r.encrypted&&e.jsxs(_,{variant:"default",className:"ml-2",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Chiffr√©"]})]})]})]}),e.jsx(L,{variant:"outline",size:"sm",children:e.jsx(te,{className:"w-4 h-4"})})]})})},r.id))}),e.jsx("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx(L,{variant:"secondary",onClick:v,children:"Fermer"})})]})})},Z={speakers:[{key:"nom",label:"Nom",required:!0},{key:"congregation",label:"Congr√©gation",required:!0},{key:"telephone",label:"T√©l√©phone",required:!1},{key:"email",label:"Email",required:!1},{key:"gender",label:"Genre (male/female/couple)",required:!1}],visits:[{key:"nom",label:"Nom orateur",required:!0},{key:"visitDate",label:"Date (YYYY-MM-DD)",required:!0},{key:"visitTime",label:"Heure (HH:MM)",required:!0},{key:"talkNoOrType",label:"N¬∞ discours",required:!1},{key:"talkTheme",label:"Th√®me discours",required:!1},{key:"host",label:"H√¥te",required:!1},{key:"status",label:"Statut",required:!1}],hosts:[{key:"nom",label:"Nom",required:!0},{key:"telephone",label:"T√©l√©phone",required:!1},{key:"email",label:"Email",required:!1},{key:"address",label:"Adresse",required:!1},{key:"gender",label:"Genre (male/female/couple)",required:!1}]},ss=({isOpen:T,onClose:v,onImport:E})=>{const[i,g]=m.useState("upload"),[d,S]=m.useState("speakers"),[$,f]=m.useState(null),[O,p]=m.useState([]),[P,y]=m.useState([]),[M,o]=m.useState({}),[C,b]=m.useState(null),h=async s=>{const n=s.target.files?.[0];if(!n)return;f(n);const l=(await n.text()).split(`
`).filter(j=>j.trim());if(l.length===0)return;const c=l[0].split(",").map(j=>j.trim().replace(/"/g,""));y(c);const r=l.slice(1).map(j=>{const x=j.split(",").map(G=>G.trim().replace(/"/g,"")),F={};return c.forEach((G,R)=>{F[G]=x[R]||""}),F});p(r),g("mapping")},I=(s,n)=>{o(t=>({...t,[s]:n}))},k=async()=>{g("import");try{const s=O.map(t=>{const l={};return Object.entries(M).forEach(([c,r])=>{r&&t[c]&&(l[r]=t[c])}),l}),n=await E(s,M);b(n),g("result")}catch(s){console.error("Erreur lors de l'import:",s)}},D=()=>{const s=Z[d].filter(t=>t.required);return`${s.filter(t=>Object.values(M).includes(t.key)).length}/${s.length}`},z=()=>Z[d].filter(n=>n.required).every(n=>Object.values(M).includes(n.key));return e.jsx(ne,{isOpen:T,onClose:v,title:"Assistant d'importation",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:["upload","mapping","preview","import","result"].map((s,n)=>e.jsxs(He.Fragment,{children:[e.jsxs("div",{className:`flex items-center gap-2 ${i===s?"text-primary-600":["upload","mapping","preview"].indexOf(i)>n?"text-green-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-medium ${i===s?"bg-primary-100 dark:bg-primary-900/20":["upload","mapping","preview"].indexOf(i)>n?"bg-green-100 dark:bg-green-900/20":"bg-gray-100 dark:bg-gray-800"}`,children:n+1}),e.jsxs("span",{className:"text-sm font-medium hidden md:inline",children:[s==="upload"&&"Fichier",s==="mapping"&&"Mapping",s==="preview"&&"Aper√ßu",s==="import"&&"Import",s==="result"&&"R√©sultat"]})]}),n<4&&e.jsx(ce,{className:"w-4 h-4 text-gray-400"})]},s))}),i==="upload"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Type de donn√©es √† importer"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"speakers",label:"Orateurs",icon:"üë§"},{value:"visits",label:"Visites",icon:"üìÖ"},{value:"hosts",label:"H√¥tes",icon:"üè†"}].map(s=>e.jsxs("button",{onClick:()=>S(s.value),className:`p-4 rounded-lg border-2 transition-all ${d===s.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx("div",{className:"text-3xl mb-2",children:s.icon}),e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:s.label})]},s.value))})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"S√©lectionner un fichier CSV"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Fichier CSV avec en-t√™tes de colonnes"}),e.jsx("input",{type:"file",accept:".csv",onChange:h,className:"hidden",id:"csv-file"}),e.jsx("label",{htmlFor:"csv-file",children:e.jsxs("span",{className:"inline-flex items-center justify-center px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg cursor-pointer transition-colors",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Parcourir"]})})]})}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[e.jsx("strong",{children:"Format attendu :"})," Fichier CSV avec la premi√®re ligne contenant les noms de colonnes. Les colonnes seront mapp√©es √† l'√©tape suivante."]})]})})]}),i==="mapping"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:$?.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[O.length," ligne(s) d√©tect√©e(s)"]})]}),e.jsxs(_,{variant:"default",children:["Champs requis : ",D()]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Mapper les colonnes"}),e.jsx("div",{className:"space-y-3",children:P.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 px-4 py-2 bg-gray-50 dark:bg-gray-800 rounded-lg",children:e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s})}),e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("select",{value:M[s]||"",onChange:n=>I(s,n.target.value),"aria-label":`Mapper la colonne ${s}`,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"-- Ignorer --"}),Z[d].map(n=>e.jsxs("option",{value:n.key,children:[n.label," ",n.required&&"*"]},n.key))]})]},s))})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(L,{variant:"secondary",onClick:()=>g("upload"),children:"Retour"}),e.jsxs(L,{variant:"primary",onClick:()=>g("preview"),disabled:!z(),children:["Aper√ßu",e.jsx(ce,{className:"w-4 h-4 ml-2"})]})]})]}),i==="preview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-900 dark:text-green-200",children:"Pr√™t √† importer"})]}),e.jsxs("p",{className:"text-sm text-green-800 dark:text-green-300",children:[O.length," ",d==="speakers"?"orateur(s)":d==="visits"?"visite(s)":"h√¥te(s)"," ","seront import√©(s)"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Aper√ßu des donn√©es (5 premi√®res lignes)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsx("tr",{children:Z[d].filter(s=>Object.values(M).includes(s.key)).map(s=>e.jsx("th",{className:"px-4 py-2 text-left font-medium text-gray-700 dark:text-gray-300",children:s.label},s.key))})}),e.jsx("tbody",{children:O.slice(0,5).map((s,n)=>e.jsx("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:Z[d].filter(t=>Object.values(M).includes(t.key)).map(t=>{const l=Object.keys(M).find(c=>M[c]===t.key);return e.jsx("td",{className:"px-4 py-2 text-gray-900 dark:text-white",children:l?s[l]:"-"},t.key)})},n))})]})})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(L,{variant:"secondary",onClick:()=>g("mapping"),children:"Retour"}),e.jsxs(L,{variant:"primary",onClick:k,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Lancer l'importation"]})]})]}),i==="import"&&e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Importation en cours..."}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Veuillez patienter pendant le traitement des donn√©es"})]}),i==="result"&&C&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-20 h-20 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Importation termin√©e !"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(V,{children:e.jsxs(H,{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:C.speakersAdded+C.visitsAdded+C.hostsAdded}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Ajout√©(s)"})]})}),e.jsx(V,{children:e.jsxs(H,{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:C.speakersUpdated+C.visitsUpdated+C.hostsUpdated}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Mis √† jour"})]})})]}),C.errors.length>0&&e.jsx("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-orange-900 dark:text-orange-200 mb-2",children:[C.errors.length," erreur(s) d√©tect√©e(s)"]}),e.jsx("ul",{className:"text-sm text-orange-800 dark:text-orange-300 space-y-1",children:C.errors.slice(0,5).map((s,n)=>e.jsxs("li",{children:["‚Ä¢ ",s]},n))})]})]})}),e.jsx("div",{className:"flex gap-3 justify-end",children:e.jsx(L,{variant:"primary",onClick:v,children:"Terminer"})})]})]})})},rs=({isOpen:T,onClose:v,onRestore:E,onDelete:i,onExport:g})=>{const{archivedVisits:d}=le(),[S,$]=m.useState(""),[f,O]=m.useState("all"),[p,P]=m.useState("all"),[y,M]=m.useState(new Set),[o,C]=m.useState("date"),b=m.useMemo(()=>{const l=new Set;return d.forEach(c=>{const r=new Date(c.visitDate).getFullYear();l.add(r)}),Array.from(l).sort((c,r)=>r-c)},[d]),h=m.useMemo(()=>{const l=d.filter(c=>{if(S){const r=S.toLowerCase();if(!c.nom.toLowerCase().includes(r)&&!c.congregation.toLowerCase().includes(r)&&!c.talkTheme?.toLowerCase().includes(r))return!1}return!(f!=="all"&&new Date(c.visitDate).getFullYear()!==f||p!=="all"&&c.status!==p)});return l.sort((c,r)=>{switch(o){case"date":return new Date(r.visitDate).getTime()-new Date(c.visitDate).getTime();case"speaker":return c.nom.localeCompare(r.nom);case"congregation":return c.congregation.localeCompare(r.congregation);default:return 0}}),l},[d,S,f,p,o]),I=l=>{M(c=>{const r=new Set(c);return r.has(l)?r.delete(l):r.add(l),r})},k=()=>{M(new Set(h.map(l=>l.visitId)))},D=()=>{M(new Set)},z=()=>{y.size>0&&(E(Array.from(y)),M(new Set))},s=()=>{y.size>0&&confirm(`‚ö†Ô∏è √ätes-vous s√ªr de vouloir supprimer d√©finitivement ${y.size} visite(s) ?`)&&(i(Array.from(y)),M(new Set))},n=()=>{y.size>0&&g(Array.from(y))},t=l=>{switch(l){case"completed":return e.jsx(_,{variant:"success",children:"Termin√©"});case"cancelled":return e.jsx(_,{variant:"danger",children:"Annul√©"});default:return e.jsx(_,{variant:"default",children:l})}};return e.jsx(ne,{isOpen:T,onClose:v,title:"Gestion des archives",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.length}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Total"})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.filter(l=>l.status==="completed").length}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:"Termin√©es"})]}),e.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:d.filter(l=>l.status==="cancelled").length}),e.jsx("div",{className:"text-sm text-red-800 dark:text-red-300",children:"Annul√©es"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:y.size}),e.jsx("div",{className:"text-sm text-purple-800 dark:text-purple-300",children:"S√©lectionn√©es"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:S,onChange:l=>$(l.target.value),placeholder:"Rechercher par orateur, congr√©gation ou discours...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("select",{value:f,onChange:l=>O(l.target.value==="all"?"all":Number(l.target.value)),"aria-label":"Filtrer par ann√©e",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Toutes les ann√©es"}),b.map(l=>e.jsx("option",{value:l,children:l},l))]}),e.jsxs("select",{value:p,onChange:l=>P(l.target.value),"aria-label":"Filtrer par statut",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Tous les statuts"}),e.jsx("option",{value:"completed",children:"Termin√©es"}),e.jsx("option",{value:"cancelled",children:"Annul√©es"})]}),e.jsxs("select",{value:o,onChange:l=>C(l.target.value),"aria-label":"Trier les archives",className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"date",children:"Trier par date"}),e.jsx("option",{value:"speaker",children:"Trier par orateur"}),e.jsx("option",{value:"congregation",children:"Trier par congr√©gation"})]}),e.jsx("div",{className:"flex-1"}),e.jsx(L,{variant:"outline",size:"sm",onClick:k,children:"Tout s√©lectionner"}),e.jsx(L,{variant:"outline",size:"sm",onClick:D,children:"Tout d√©s√©lectionner"})]})]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Be,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucune archive trouv√©e"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Modifiez vos crit√®res de recherche"})]}):h.map(l=>e.jsx(V,{hoverable:!0,className:`cursor-pointer transition-all ${y.has(l.visitId)?"ring-2 ring-primary-500 bg-primary-50 dark:bg-primary-900/20":""}`,onClick:()=>I(l.visitId),children:e.jsx(H,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"checkbox",checked:y.has(l.visitId),onChange:()=>I(l.visitId),onClick:c=>c.stopPropagation(),"aria-label":`S√©lectionner ${l.nom}`,className:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:l.nom}),t(l.status)]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx($e,{className:"w-3 h-3 inline mr-1"}),new Date(l.visitDate).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"})]}),e.jsx("p",{children:l.congregation}),l.talkTheme&&e.jsxs("p",{className:"text-xs",children:[l.talkNoOrType," - ",l.talkTheme]})]})]})]})})},l.visitId))}),e.jsxs("div",{className:"flex gap-3 justify-between pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(L,{variant:"secondary",onClick:v,children:"Fermer"}),y.size>0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(L,{variant:"outline",onClick:n,children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Exporter (",y.size,")"]}),e.jsxs(L,{variant:"danger",onClick:s,children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Supprimer (",y.size,")"]}),e.jsxs(L,{variant:"primary",onClick:z,children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),"Restaurer (",y.size,")"]})]})]})]})})};function ts(T){const v=[],E=[];return T.speakers&&T.speakers.forEach(i=>{i.telephone&&i.telephone.trim()&&v.push({nom:i.nom,telephone:i.telephone,congregation:i.congregation})}),T.visits&&T.visits.forEach(i=>{i.telephone&&i.telephone.trim()&&v.push({nom:i.nom,telephone:i.telephone,congregation:i.congregation})}),T.hosts&&T.hosts.forEach(i=>{i.telephone&&i.telephone.trim()&&E.push({nom:i.nom,telephone:i.telephone})}),{speakersWithPhones:v,hostsWithPhones:E}}function as(T,v){const E=new Map;return v.forEach(i=>{const g=i.nom.toLowerCase().replace(/\s+/g," ").trim();E.set(g,i.telephone)}),T.map(i=>{const g=i.nom.toLowerCase().replace(/\s+/g," ").trim(),d=E.get(g);return d&&!i.telephone?{...i,telephone:d,updatedAt:new Date().toISOString()}:i})}function ls(T,v){const E=new Map;return v.forEach(i=>{const g=i.nom.toLowerCase().replace(/\s+/g," ").trim();E.set(g,i.telephone)}),T.map(i=>{const g=i.nom.toLowerCase().replace(/\s+/g," ").trim(),d=E.get(g);return d&&!i.telephone?{...i,telephone:d,updatedAt:new Date().toISOString()}:i})}function ns(T,v,E,i){const g=[],d=[];let S=0,$=0;return T.forEach((f,O)=>{const p=v[O];f.telephone!==p.telephone&&p.telephone&&(S++,g.push(`‚úì ${p.nom}: +${p.telephone}`))}),E.forEach((f,O)=>{const p=i[O];f.telephone!==p.telephone&&p.telephone&&($++,d.push(`‚úì ${p.nom}: +${p.telephone}`))}),{speakersUpdated:S,hostsUpdated:$,speakerDetails:g,hostDetails:d}}function is(T,v){const{speakersWithPhones:E,hostsWithPhones:i}=ts(T),g=as(v.speakers,E),d=ls(v.hosts,i),S=ns(v.speakers,g,v.hosts,d);return{updatedSpeakers:g,updatedHosts:d,report:S}}function ds({isOpen:T,onClose:v}){const{speakers:E,hosts:i,updateSpeaker:g,updateHost:d}=le(),[S,$]=m.useState(""),[f,O]=m.useState(!1),[p,P]=m.useState(null),[y,M]=m.useState(!1),o=h=>{const I=h.target.files?.[0];if(I){const k=new FileReader;k.onload=D=>{const z=D.target?.result;$(z),M(!0)},k.readAsText(I)}},C=async()=>{if(S.trim()){O(!0);try{const h=JSON.parse(S),{updatedSpeakers:I,updatedHosts:k,report:D}=is(h,{speakers:E,hosts:i}),z=[];E.forEach(n=>{const t=I.find(l=>l.id===n.id);t&&(!n.telephone||n.telephone.trim()==="")&&t.telephone&&t.telephone.trim()!==""&&z.push(t)});const s=i.filter(n=>{const t=k.find(l=>l.nom===n.nom);return t&&(!n.telephone||n.telephone.trim()==="")&&t.telephone&&t.telephone.trim()!==""});console.log("üîÑ Mise √† jour des orateurs:",z.length),console.log("üîÑ Mise √† jour des h√¥tes:",s.length);for(const n of z)console.log(`üì± Mise √† jour orateur: ${n.nom} -> ${n.telephone}`),g(n),await new Promise(t=>setTimeout(t,50));for(const n of s)console.log(`üè† Mise √† jour h√¥te: ${n.nom} -> ${n.telephone}`),d(n.nom,{telephone:n.telephone}),await new Promise(t=>setTimeout(t,50));setTimeout(()=>{window.dispatchEvent(new CustomEvent("phoneNumbersUpdated",{detail:{speakersUpdated:z.length,hostsUpdated:s.length}}))},100),P({speakersUpdated:D.speakersUpdated,hostsUpdated:D.hostsUpdated,speakerDetails:D.speakerDetails,hostDetails:D.hostDetails,errors:[]})}catch(h){P({speakersUpdated:0,hostsUpdated:0,speakerDetails:[],hostDetails:[],errors:[h instanceof Error?h.message:"Erreur lors du parsing JSON"]})}finally{O(!1)}}},b=()=>{$(""),P(null),M(!1),v()};return T?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(oe,{className:"h-6 w-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Import des Num√©ros de T√©l√©phone"})]}),e.jsx("button",{onClick:b,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Fermer",children:e.jsx(Re,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-140px)]",children:p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Q,{className:"h-5 w-5 text-green-600"}),e.jsx("h3",{className:"font-medium text-green-900",children:"Import termin√© avec succ√®s!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-green-800",children:[e.jsx("span",{className:"font-medium",children:p.speakersUpdated})," orateurs mis √† jour"]}),e.jsxs("div",{className:"text-green-800",children:[e.jsx("span",{className:"font-medium",children:p.hostsUpdated})," h√¥tes mis √† jour"]})]})]}),p.speakerDetails.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"üì± Orateurs mis √† jour"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1 text-sm",children:p.speakerDetails.map((h,I)=>e.jsx("li",{className:"text-gray-700",children:h},I))})})]}),p.hostDetails.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"üè† H√¥tes mis √† jour"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 max-h-48 overflow-y-auto",children:e.jsx("ul",{className:"space-y-1 text-sm",children:p.hostDetails.map((h,I)=>e.jsx("li",{className:"text-gray-700",children:h},I))})})]}),p.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Pe,{className:"h-5 w-5 text-red-600"}),e.jsx("h4",{className:"font-medium text-red-900",children:"Erreurs"})]}),e.jsx("ul",{className:"space-y-1 text-sm text-red-800",children:p.errors.map((h,I)=>e.jsxs("li",{children:["‚Ä¢ ",h]},I))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 transition-colors",children:"Fermer"})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"üìã Instructions"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ S√©lectionnez un fichier JSON contenant les orateurs et h√¥tes avec leurs num√©ros"}),e.jsx("li",{children:'‚Ä¢ Le fichier doit contenir les champs "speakers", "visits" et/ou "hosts"'}),e.jsx("li",{children:"‚Ä¢ Seuls les num√©ros manquants seront ajout√©s (pas de remplacement)"}),e.jsx("li",{children:"‚Ä¢ Un rapport d√©taill√© des modifications sera affich√©"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"S√©lectionner un fichier JSON"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("input",{type:"file",accept:".json",onChange:o,title:"S√©lectionner un fichier JSON contenant les num√©ros de t√©l√©phone",className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),e.jsx(ee,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ou coller le contenu JSON"}),e.jsx("textarea",{value:S,onChange:h=>{$(h.target.value),M(h.target.value.trim().length>0)},placeholder:"Collez ici le contenu JSON avec les num√©ros de t√©l√©phone...",className:"w-full h-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"})]}),y&&S.trim()&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"üëÅÔ∏è Aper√ßu des donn√©es"}),e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{try{const h=JSON.parse(S),I=h.speakers?.filter(z=>z.telephone?.trim()).length||0,k=h.visits?.filter(z=>z.telephone?.trim()).length||0,D=h.hosts?.filter(z=>z.telephone?.trim()).length||0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsxs("span",{children:["Orateurs avec num√©ros: ",I]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsxs("span",{children:["Visites avec num√©ros: ",k]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:["H√¥tes avec num√©ros: ",D]})]})]})}catch{return e.jsx("span",{className:"text-red-600",children:"‚ùå JSON invalide"})}})()})]}),y&&S.trim()&&e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{$(""),M(!1)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Annuler"}),e.jsx("button",{onClick:C,disabled:f,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:f?"‚è≥ Import en cours...":"üì± Importer les num√©ros"})]})]})]})})]})}):null}const je=7,ve=2,js=()=>{const{congregationProfile:T,updateCongregationProfile:v,syncWithGoogleSheet:E,exportData:i,importData:g,mergeDuplicates:d,deleteVisit:S,deleteSpeaker:$,deleteHost:f,speakers:O,hosts:p,visits:P,archivedVisits:y,speakerMessages:M}=le(),{settings:o,updateSettings:C}=Ue(),{addToast:b}=qe(),[h,I]=m.useState("profile"),[k,D]=m.useState(T),[z,s]=m.useState(!1),[n,t]=m.useState(!1),[l,c]=m.useState(!1),[r,j]=m.useState(!1),[x,F]=m.useState(!1),[G,R]=m.useState(!1),Ne=[{id:"profile",label:"Profil",icon:ie},{id:"appearance",label:"Apparence",icon:be},{id:"notifications",label:"Notifications",icon:pe},{id:"security",label:"S√©curit√©",icon:ae},{id:"data",label:"Donn√©es",icon:re},{id:"duplicates",label:"Doublons",icon:Y}],we=()=>{v(k),b("Profil mis √† jour","success")},Se=a=>{C({...o,theme:a}),b("Th√®me mis √† jour","success")},Ce=a=>{C({...o,language:a}),b("Langue mise √† jour","success")},De=()=>{s(!0),E().catch(()=>b("Erreur lors de la synchronisation","error")).finally(()=>{s(!1)})},Ae=10,he=a=>new Promise(u=>{const A=i(),U=new Blob([A],{type:"application/json"}),N=URL.createObjectURL(U),w=document.createElement("a");w.href=N,w.download=`kbv-backup-${new Date().toISOString().slice(0,Ae)}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(N),b("Sauvegarde effectu√©e avec succ√®s","success"),u()}),Me=a=>new Promise((u,A)=>{const U=new FileReader;U.onload=N=>{if(N.target?.result)try{g(N.target.result),u()}catch(w){A(w)}},U.onerror=A,U.readAsText(a)}),Te=(a,u)=>{try{return b("Importation effectu√©e avec succ√®s","success"),Promise.resolve({speakersAdded:0,speakersUpdated:0,visitsAdded:Array.isArray(a)?a.length:1,visitsUpdated:0,hostsAdded:0,hostsUpdated:0,errors:[]})}catch(A){return Promise.resolve({speakersAdded:0,speakersUpdated:0,visitsAdded:0,visitsUpdated:0,hostsAdded:0,hostsUpdated:0,errors:[String(A)]})}},Ee=(a,u,A="keep-recent")=>{let N=0;a.forEach(w=>{if(!w.items||w.items.length<2)return;const W=[...w.items];A==="keep-recent"&&W.sort((q,ge)=>{const Fe=new Date(q.updatedAt||q.createdAt||0).getTime();return new Date(ge.updatedAt||ge.createdAt||0).getTime()-Fe});const J=W[0],Ie=W.slice(1),ze=w.type==="host"?J.nom:J.id||J.visitId,se=Ie.map(q=>w.type==="host"?q.nom:w.type==="visit"||w.type==="archivedVisit"?q.visitId:q.id);u==="merge"?(d(w.type,ze,se),N++):u==="delete"&&(w.type==="speaker"?se.forEach(q=>$(q)):w.type==="host"?se.forEach(q=>f(q)):w.type==="visit"&&se.forEach(q=>S(q)),N++)}),N>0&&b(u==="merge"?`${N} groupe(s) fusionn√©(s) avec succ√®s`:`${N} groupe(s) nettoy√©(s) (doublons supprim√©s)`,"success")};return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Param√®tres"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"G√©rez les param√®tres de l'application et de votre congr√©gation"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-64",children:e.jsx(V,{children:e.jsx(H,{className:"p-2",children:e.jsx("nav",{className:"space-y-1",children:Ne.map(a=>e.jsxs("button",{onClick:()=>I(a.id),className:`
                      w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${h===a.id?"bg-primary-100 text-primary-700 dark:bg-primary-900/50 dark:text-primary-300":"text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-800"}`,children:[e.jsx(a.icon,{className:"w-4 h-4"}),a.label]},a.id))})})})}),e.jsxs("div",{className:"flex-1 min-h-[600px]",children:[h==="profile"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Profil de la Congr√©gation"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Informations g√©n√©rales sur votre congr√©gation"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nom de la congr√©gation"}),e.jsx(K,{value:k.name,onChange:a=>D({...k,name:a.target.value}),placeholder:"Ex: KBV DV Lyon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ville"}),e.jsx(K,{value:k.city||"",onChange:a=>D({...k,city:a.target.value}),placeholder:"Ex: Lyon"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Responsable Accueil"}),e.jsx(K,{value:k.hospitalityOverseer,onChange:a=>D({...k,hospitalityOverseer:a.target.value}),placeholder:"Nom du responsable"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"T√©l√©phone Responsable"}),e.jsx(K,{value:k.hospitalityOverseerPhone,onChange:a=>D({...k,hospitalityOverseerPhone:a.target.value}),placeholder:"+33 6 XX XX XX XX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Jour de r√©union"}),e.jsx(de,{value:k.meetingDay||"Samedi",onChange:a=>D({...k,meetingDay:a.target.value}),options:[{value:"Dimanche",label:"Dimanche"},{value:"Lundi",label:"Lundi"},{value:"Mardi",label:"Mardi"},{value:"Mercredi",label:"Mercredi"},{value:"Jeudi",label:"Jeudi"},{value:"Vendredi",label:"Vendredi"},{value:"Samedi",label:"Samedi"}]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Heure de r√©union"}),e.jsx(K,{type:"time",value:k.meetingTime||"14:30",onChange:a=>D({...k,meetingTime:a.target.value})})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(L,{leftIcon:e.jsx(xe,{className:"w-4 h-4"}),onClick:we,children:"Enregistrer"})})]})]}),h==="appearance"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Apparence"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Personnalisez l'apparence de l'application"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Th√®me"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:[{value:"light",label:"Clair",icon:Ze},{value:"dark",label:"Sombre",icon:Xe},{value:"auto",label:"Auto",icon:We}].map(a=>e.jsxs("button",{onClick:()=>Se(a.value),className:`p-4 border rounded-lg transition-all ${o.theme===a.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300"}`,children:[e.jsx(a.icon,{className:"w-6 h-6 mx-auto mb-2 text-gray-600 dark:text-gray-400"}),e.jsx("div",{className:"text-sm font-medium",children:a.label})]},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Langue"}),e.jsx(de,{value:o.language,onChange:a=>Ce(a.target.value),options:[{value:"fr",label:"Fran√ßais"},{value:"cv",label:"Capverdien"},{value:"pt",label:"Portugais"}],className:"max-w-xs"})]})]})]}),h==="notifications"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),"Notifications"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"G√©rez vos pr√©f√©rences de notifications"})]}),e.jsx(H,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"notifications-enabled",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Notifications activ√©es"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Recevoir des rappels et alertes"})]}),e.jsx("input",{id:"notifications-enabled",type:"checkbox",checked:o.notifications.enabled,onChange:a=>C({...o,notifications:{...o.notifications,enabled:a.target.checked}}),className:"rounded"})]}),o.notifications.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Rappels automatiques"}),e.jsx("div",{className:"space-y-3",children:[{value:je,days:je,description:"1 semaine avant la visite"},{value:ve,days:ve,description:"2 jours avant la visite"}].map(({value:a,days:u,description:A})=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:`reminder-${a}`,className:"cursor-pointer",children:[e.jsxs("div",{className:"font-medium text-gray-900 dark:text-white",children:["J-",u]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:A})]}),e.jsx("input",{id:`reminder-${a}`,type:"checkbox",checked:o.notifications.reminderDays.includes(u),onChange:U=>{const N=U.target.checked?[...o.notifications.reminderDays,u]:o.notifications.reminderDays.filter(w=>w!==u);C({...o,notifications:{...o.notifications,reminderDays:N}})},className:"rounded"})]},a))})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white mb-3",children:"Options"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"sound-enabled",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Son"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Jouer un son pour les notifications"})]}),e.jsx("input",{id:"sound-enabled",type:"checkbox",checked:o.notifications.sound,onChange:a=>C({...o,notifications:{...o.notifications,sound:a.target.checked}}),className:"rounded"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"vibration-enabled",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Vibration"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Faire vibrer l'appareil"})]}),e.jsx("input",{id:"vibration-enabled",type:"checkbox",checked:o.notifications.vibration,onChange:a=>C({...o,notifications:{...o.notifications,vibration:a.target.checked}}),className:"rounded"})]})]})]})]})]})})]}),h==="security"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"S√©curit√©"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"G√©rez la s√©curit√© et le chiffrement des donn√©es"})]}),e.jsx(H,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{htmlFor:"encryption-enabled",className:"cursor-pointer",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Chiffrement activ√©"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Prot√©ger les donn√©es sensibles avec un chiffrement AES-GCM"})]}),e.jsx("input",{id:"encryption-enabled",type:"checkbox",checked:o.encryptionEnabled,onChange:a=>C({...o,encryptionEnabled:a.target.checked}),className:"rounded"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Timeout de session (minutes)"}),e.jsx(de,{value:o.sessionTimeout?.toString()||"30",onChange:a=>C({...o,sessionTimeout:parseInt(a.target.value,10)}),options:[{value:"15",label:"15 minutes"},{value:"30",label:"30 minutes"},{value:"60",label:"1 heure"},{value:"120",label:"2 heures"}],className:"max-w-xs"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Version 1.20.0"})]})})]})})]}),h==="data"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Gestion des Donn√©es"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Synchronisation, sauvegardes et archives"})]}),e.jsx(H,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-300 mb-2",children:"Synchronisation Google Sheets"}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-400 mb-4",children:"Cette fonction r√©cup√®re automatiquement les visites programm√©es depuis votre Google Sheet et met √† jour l'application. Les orateurs et visites existants seront fusionn√©s intelligemment."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsx(L,{leftIcon:e.jsx(Ve,{className:`w-4 h-4 ${z?"animate-spin":""}`}),onClick:De,disabled:z,children:z?"Synchronisation en cours...":"Synchroniser maintenant"}),localStorage.getItem("lastGoogleSheetSync")&&e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Derni√®re synchro :"," ",new Date(localStorage.getItem("lastGoogleSheetSync")).toLocaleString("fr-FR")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-4 p-4 text-left border rounded-lg transition-all hover:border-primary-500 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[e.jsx("div",{className:"p-3 bg-green-100 text-green-600 rounded-full dark:bg-green-900/30 dark:text-green-400",children:e.jsx(xe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Sauvegardes"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"G√©rer les backups locaux et chiffr√©s"})]})]}),e.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-4 p-4 text-left border rounded-lg transition-all hover:border-primary-500 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[e.jsx("div",{className:"p-3 bg-purple-100 text-purple-600 rounded-full dark:bg-purple-900/30 dark:text-purple-400",children:e.jsx(re,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Importer des donn√©es"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Assistant d'importation CSV/JSON"})]})]}),e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-4 p-4 text-left border rounded-lg transition-all hover:border-primary-500 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[e.jsx("div",{className:"p-3 bg-orange-100 text-orange-600 rounded-full dark:bg-orange-900/30 dark:text-orange-400",children:e.jsx(re,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Archives"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Consulter l'historique des visites"})]})]}),e.jsxs("button",{onClick:()=>R(!0),className:"flex items-center gap-4 p-4 text-left border rounded-lg transition-all hover:border-primary-500 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-800",children:[e.jsx("div",{className:"p-3 bg-indigo-100 text-indigo-600 rounded-full dark:bg-indigo-900/30 dark:text-indigo-400",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:"Num√©ros de T√©l√©phone"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Importer les num√©ros depuis JSON"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("h4",{className:"font-medium text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(Je,{className:"w-4 h-4"}),"Liens Utiles"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(L,{variant:"secondary",onClick:()=>window.open("https://docs.google.com/spreadsheets/d/1drIzPPi6AohCroSyUkF1UmMFxuEtMACBF4XATDjBOcg","_blank","noopener,noreferrer"),children:"Ouvrir Google Sheet"}),e.jsx(L,{variant:"outline",onClick:()=>window.open("https://www.jw.org/kea/","_blank","noopener,noreferrer"),children:"JW.ORG (Cap-Verdien)"})]})]})]})})]}),h==="duplicates"&&e.jsxs(V,{children:[e.jsxs(X,{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"D√©tection de Doublons"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Analysez et fusionnez les doublons dans votre base de donn√©es (y compris les archives)"})]}),e.jsxs(H,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:(()=>{const a=new Map;return O.forEach(u=>{const A=u.nom.toLowerCase().trim().replace(/\s+/g," ");a.set(A,(a.get(A)||0)+1)}),Array.from(a.values()).filter(u=>u>1).length})()}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:"Orateurs"})]})]})}),e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"w-6 h-6 text-green-600 dark:text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:(()=>{const a=new Map;return p.forEach(u=>{const A=u.nom.toLowerCase().trim().replace(/\s+/g," ");a.set(A,(a.get(A)||0)+1)}),Array.from(a.values()).filter(u=>u>1).length})()}),e.jsx("div",{className:"text-xs text-green-700 dark:text-green-300",children:"H√¥tes"})]})]})}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-900 dark:text-purple-100",children:(()=>{const a=new Map;return P.forEach(u=>{const A=`${u.id}-${u.visitDate}-${u.visitTime}`;a.set(A,(a.get(A)||0)+1)}),Array.from(a.values()).filter(u=>u>1).length})()}),e.jsx("div",{className:"text-xs text-purple-700 dark:text-purple-300",children:"Visites"})]})]})}),e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-900 dark:text-orange-100",children:(()=>{if(!y)return 0;const a=new Map;y.forEach(N=>{const w=`${N.id}-${N.visitDate}-${N.visitTime}`;a.set(w,(a.get(w)||0)+1)});const u=new Map;P.forEach(N=>{const w=`${N.id}-${N.visitDate}-${N.visitTime||""}`,W=y.filter(J=>J.id===N.id&&J.visitDate===N.visitDate&&J.visitTime===N.visitTime);W.length>0&&u.set(w,(u.get(w)||0)+W.length+1)});const A=Array.from(a.values()).filter(N=>N>1).length,U=Array.from(u.values()).filter(N=>N>1).length;return A+U})()}),e.jsx("div",{className:"text-xs text-orange-700 dark:text-orange-300",children:"Archives"})]})]})}),e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-lg border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-red-600 dark:text-red-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-900 dark:text-red-100",children:(()=>{const a=new Map;M&&M.forEach(A=>{const U=A.message?.trim().toLowerCase()||"",N=A.receivedAt?new Date(A.receivedAt).toISOString():"no-date",w=`${A.speakerId}-${U}-${N}`;a.set(w,(a.get(w)||0)+1)});const u=1;return Array.from(a.values()).filter(A=>A>u).length})()}),e.jsx("div",{className:"text-xs text-red-700 dark:text-red-300",children:"Messages"})]})]})})]}),e.jsxs("div",{className:"text-center pt-4",children:[e.jsxs(L,{onClick:()=>F(!0),size:"lg",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Lancer l'analyse compl√®te"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-3",children:"Cliquez pour voir les d√©tails et fusionner les doublons"})]})]})]})]})]}),e.jsx(es,{isOpen:n,onClose:()=>t(!1),onBackup:he,onRestore:Me}),e.jsx(ss,{isOpen:l,onClose:()=>c(!1),onImport:Te}),e.jsx(rs,{isOpen:r,onClose:()=>j(!1),onRestore:a=>{a.forEach(u=>{}),b(`${a.length} visite(s) restaur√©e(s)`,"success")},onDelete:a=>{a.forEach(u=>S(u)),b(`${a.length} visite(s) supprim√©e(s)`,"info")},onExport:async a=>{await he()}}),e.jsx(Qe,{isOpen:x,onClose:()=>F(!1),onMerge:Ee}),e.jsx(ds,{isOpen:G,onClose:()=>R(!1)})]})};export{js as Settings,js as default};
//# sourceMappingURL=Settings-CyLmVcFD.js.map
