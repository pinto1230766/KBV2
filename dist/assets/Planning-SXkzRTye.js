import{c as q,u as W,j as e,k as _,C as B,l as se,i as A,m as xe,f as z,g as I,B as S,M as le,A as je,S as ue,n as F,o as Pe,p as Ie,a as Fe,D as De,T as Be,P as qe,X as fe}from"./index-CUj4VCjl.js";import{r as c,a as He,R as ke}from"./charts-CCOFnOOy.js";import{C as Ue}from"./CommunicationProgress-D-eCyIL9.js";import{C as re}from"./copy-BQBGxYHl.js";import{M as pe,P as _e,U as ye,S as Y,I as U}from"./Select-Bwvzh9xp.js";import{X as me,T as Ne,P as We,C as Xe,E as Ze,l as Ge,V as Ye}from"./VisitActionModal-qfZ2Rabn.js";import{S as Se}from"./FeedbackFormModal-D2BCS8G_.js";import{T as Te}from"./trash-2-CL8UGa8v.js";import{f as R,s as ge,g as he,h as Je,j as Ke,k as Qe,l as et,m as tt,n as te,q as at,r as st,p as ae,t as ve}from"./utils-FTT-aY8U.js";import{F as Me,P as rt,v as lt,c as nt,W as it}from"./WorkloadIndicator-CTyMNamD.js";import{A as dt,R as ct,a as de}from"./rotate-ccw-Ci-Kkx7_.js";import{S as Ae}from"./MessageGeneratorModal-BGVep8eO.js";import"./react-vendor-B9D_A6Vq.js";import"./link-BV1ppNjq.js";const ot=q("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);const xt=q("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);const mt=q("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const gt=q("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const ht=q("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);const ut=q("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const pt=q("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const yt=q("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const Oe=q("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),bt=({isOpen:r,onClose:x,visit:t,onResolve:g})=>{const{visits:a,hosts:h}=W(),[n,f]=c.useState(new Map),b=c.useMemo(()=>{const d=[],o=a.find(u=>u.id===t.id&&u.visitId!==t.visitId&&u.visitDate===t.visitDate&&u.status!=="cancelled");if(o&&d.push({id:"conflict-speaker-date",type:"speaker",severity:"critical",message:"Orateur d√©j√† programm√©",details:`${t.nom} est d√©j√† programm√© le ${new Date(t.visitDate).toLocaleDateString("fr-FR")}`,affectedVisit:o,suggestions:[{id:"suggest-reschedule",type:"reschedule",description:"Reprogrammer cette visite √† une autre date",impact:"medium"},{id:"suggest-cancel-other",type:"cancel",description:"Annuler l'autre visite",impact:"high"}]}),h.find(u=>u.nom===t.host)?.unavailableDates?.includes(t.visitDate)){const u=h.filter(D=>!D.unavailableDates?.includes(t.visitDate)&&D.gender===t.congregation);d.push({id:"conflict-host-unavailable",type:"host",severity:"warning",message:"H√¥te indisponible",details:`${t.host} n'est pas disponible le ${new Date(t.visitDate).toLocaleDateString("fr-FR")}`,suggestions:u.slice(0,3).map((D,M)=>({id:`suggest-host-${M}`,type:"change_host",description:`Assigner √† ${D.nom}`,newHost:D,impact:"low"}))})}const y=a.find(u=>u.visitId!==t.visitId&&u.talkNoOrType===t.talkNoOrType&&u.status==="completed"&&Math.abs(new Date(u.visitDate).getTime()-new Date(t.visitDate).getTime())<2160*60*60*1e3);y&&t.talkNoOrType&&d.push({id:"conflict-talk-recent",type:"talk",severity:"info",message:"Discours r√©cemment donn√©",details:`Le discours ${t.talkNoOrType} a √©t√© donn√© il y a moins de 3 mois`,affectedVisit:y,suggestions:[{id:"suggest-different-talk",type:"change_speaker",description:"Choisir un autre discours",impact:"low"},{id:"suggest-ignore",type:"reschedule",description:"Continuer quand m√™me",impact:"low"}]});const N=a.filter(u=>{const D=new Date(u.visitDate),M=new Date(t.visitDate);return D.getMonth()===M.getMonth()&&D.getFullYear()===M.getFullYear()&&u.status!=="cancelled"});return N.length>5&&d.push({id:"conflict-overload",type:"date",severity:"warning",message:"Charge √©lev√©e ce mois",details:`${N.length} visites programm√©es ce mois`,suggestions:[{id:"suggest-next-month",type:"reschedule",description:"D√©placer au mois suivant",impact:"medium"}]}),d},[t,a,h]),j=d=>{switch(d){case"critical":return"text-red-600 bg-red-100 dark:bg-red-900/20";case"warning":return"text-orange-600 bg-orange-100 dark:bg-orange-900/20";case"info":return"text-blue-600 bg-blue-100 dark:bg-blue-900/20"}},m=d=>{switch(d){case"critical":return e.jsx(me,{className:"w-5 h-5"});case"warning":return e.jsx(se,{className:"w-5 h-5"});case"info":return e.jsx(xe,{className:"w-5 h-5"})}},v=(d,o)=>{f(C=>{const y=new Map(C);return y.set(d,o),y})},k=()=>{n.forEach((d,o)=>{g&&g({conflictId:o,suggestionId:d,action:"apply"})}),x()};return e.jsx(_,{isOpen:r,onClose:x,title:"D√©tection de Conflits",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(B,{className:"w-6 h-6 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(t.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," ","√† ",t.visitTime]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[b.length," conflit",b.length>1?"s":""," d√©tect√©",b.length>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(A,{variant:"danger",children:[b.filter(d=>d.severity==="critical").length," critique",b.filter(d=>d.severity==="critical").length>1?"s":""]}),e.jsxs(A,{variant:"warning",children:[b.filter(d=>d.severity==="warning").length," avertissement",b.filter(d=>d.severity==="warning").length>1?"s":""]})]})]}),b.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun conflit d√©tect√©"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Cette visite peut √™tre programm√©e sans probl√®me"})]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:b.map(d=>e.jsx(z,{className:`border-l-4 ${d.severity==="critical"?"border-l-red-600":d.severity==="warning"?"border-l-orange-500":"border-l-blue-500"}`,children:e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${j(d.severity)}`,children:m(d.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:d.message}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:d.details})]})]}),d.suggestions.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Solutions sugg√©r√©es :"}),d.suggestions.map(o=>e.jsx("button",{onClick:()=>v(d.id,o.id),className:`w-full text-left p-3 rounded-lg border-2 transition-all ${n.get(d.id)===o.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.description})]}),e.jsxs(A,{variant:o.impact==="high"?"danger":o.impact==="medium"?"warning":"default",children:["Impact"," ",o.impact==="high"?"√©lev√©":o.impact==="medium"?"moyen":"faible"]})]})},o.id))]})]})},d.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(S,{variant:"secondary",onClick:x,children:"Annuler"}),b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"outline",onClick:()=>{b.forEach(d=>{g&&g({conflictId:d.id,suggestionId:"",action:"ignore"})}),x()},children:"Ignorer les conflits"}),e.jsxs(S,{variant:"primary",onClick:k,disabled:n.size===0,children:["Appliquer les solutions (",n.size,")"]})]})]})]})})},ce=[{value:"speaker_unavailable",label:"Orateur indisponible",icon:"üë§"},{value:"host_unavailable",label:"H√¥te indisponible",icon:"üè†"},{value:"congregation_conflict",label:"Conflit de congr√©gation",icon:"‚ö†Ô∏è"},{value:"weather",label:"Conditions m√©t√©o",icon:"üåßÔ∏è"},{value:"health",label:"Raisons de sant√©",icon:"üè•"},{value:"emergency",label:"Urgence",icon:"üö®"},{value:"duplicate",label:"Doublon d√©tect√©",icon:"üìã"},{value:"other",label:"Autre raison",icon:"üìù"}],jt=({isOpen:r,onClose:x,visit:t,onCancel:g})=>{const[a,h]=c.useState(null),[n,f]=c.useState(""),[b,j]=c.useState(!0),[m,v]=c.useState(!0),[k,d]=c.useState(!1),[o,C]=c.useState(""),[y,N]=c.useState(""),[u,D]=c.useState(!1),M=()=>{if(!a)return;const s={visitId:t.visitId,reason:a,customReason:a==="other"?n:void 0,notifySpeaker:b,notifyHost:m,proposeReschedule:k,suggestedNewDate:k?o:void 0,internalNotes:y,cancelledBy:"Coordinateur",cancelledAt:new Date().toISOString()};g(s),x()},E=()=>{const s=ce.find(l=>l.value===a);return`Bonjour ${t.nom},

Nous sommes au regret de vous informer que la visite pr√©vue le ${new Date(t.visitDate).toLocaleDateString("fr-FR")} doit √™tre annul√©e.

Raison : ${s?.label}${a==="other"&&n?` - ${n}`:""}

${k&&o?`Nous vous proposons de reprogrammer cette visite le ${new Date(o).toLocaleDateString("fr-FR")}.

`:""}Nous vous contacterons prochainement pour convenir d'une nouvelle date.

Cordialement,
KBV Lyon`};return u?e.jsx(_,{isOpen:r,onClose:x,title:"Confirmer l'annulation",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(se,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200 mb-2",children:"Attention : Action irr√©versible"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:"Vous √™tes sur le point d'annuler d√©finitivement cette visite. Cette action ne peut pas √™tre annul√©e."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Orateur"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:t.nom})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Date"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:new Date(t.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Raison"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ce.find(s=>s.value===a)?.label})]})]}),(b||m)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Notifications √† envoyer"})]}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-1",children:[b&&e.jsxs("li",{children:["‚Ä¢ Notification √† l'orateur (",t.nom,")"]}),m&&e.jsxs("li",{children:["‚Ä¢ Notification √† l'h√¥te (",t.host,")"]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(S,{variant:"secondary",onClick:()=>D(!1),children:"Retour"}),e.jsxs(S,{variant:"danger",onClick:M,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Confirmer l'annulation"]})]})]})}):e.jsx(_,{isOpen:r,onClose:x,title:"Annuler une visite",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(B,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:t.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(t.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," ","√† ",t.visitTime]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Discours :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:t.talkNoOrType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"H√¥te :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:t.host})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Raison de l'annulation *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ce.map(s=>e.jsx("button",{onClick:()=>h(s.value),className:`p-3 rounded-lg border-2 text-left transition-all ${a===s.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.label})]})},s.value))})]}),a==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Pr√©cisez la raison"}),e.jsx("textarea",{value:n,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,placeholder:"D√©crivez la raison de l'annulation..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notifications"}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>j(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'orateur"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation √† ",t.nom]})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:s=>v(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'h√¥te"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation √† ",t.host]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>d(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Proposer une reprogrammation"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Sugg√©rer une nouvelle date dans le message d'annulation"})]})]}),k&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouvelle date propos√©e"}),e.jsx("input",{type:"date",value:o,onChange:s=>C(s.target.value),min:new Date().toISOString().split("T")[0],"aria-label":"Nouvelle date propos√©e",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes internes (optionnel)"}),e.jsx("textarea",{value:y,onChange:s=>N(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:2,placeholder:"Notes pour l'√©quipe (non envoy√©es aux participants)..."})]}),(b||m)&&a&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(le,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Aper√ßu du message"})]}),e.jsx("pre",{className:"text-xs text-blue-800 dark:text-blue-300 whitespace-pre-wrap font-sans",children:E()})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(S,{variant:"secondary",onClick:x,children:"Annuler"}),e.jsxs(S,{variant:"danger",onClick:()=>D(!0),disabled:!a||a==="other"&&!n,children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Annuler la visite"]})]})]})})},ft=({isOpen:r,onClose:x,visit:t,onSelectReplacement:g})=>{const{speakers:a,visits:h}=W(),[n,f]=c.useState(""),[b,j]=c.useState(!1),[m,v]=c.useState(!0),[k,d]=c.useState(null),[o,C]=c.useState(!0),[y,N]=c.useState(!1),u=c.useMemo(()=>{const s=[];return a.forEach(l=>{if(l.id===t.id)return;let p=0;const w=[],X=[],Z=l.talkHistory.map(T=>T.talkNo.toString());if(t.talkNoOrType&&Z.includes(t.talkNoOrType)?(p+=50,w.push("Poss√®de le m√™me discours"),X.push(t.talkNoOrType)):Z.forEach(T=>X.push(T)),!h.some(T=>T.id===l.id&&T.visitDate===t.visitDate&&T.status!=="cancelled"))p+=30,w.push("Disponible √† cette date");else{if(m)return;w.push("‚ö†Ô∏è D√©j√† programm√© ce jour")}l.congregation===t.congregation&&(p+=20,w.push("M√™me congr√©gation")),h.filter(T=>T.id===l.id&&T.status==="completed"&&new Date(T.visitDate)>new Date(Date.now()-2160*60*60*1e3)).length===0&&(p+=15,w.push("Pas de visite r√©cente")),l.isVehiculed&&(p+=10,w.push("V√©hicul√©")),l.telephone&&(p+=5,w.push("T√©l√©phone disponible"));const K=h.filter(T=>T.id===l.id&&T.status==="completed").sort((T,ie)=>new Date(ie.visitDate).getTime()-new Date(T.visitDate).getTime())[0];s.push({speaker:l,score:p,reasons:w,availableTalks:X,lastVisit:K?.visitDate})}),s.sort((l,p)=>p.score-l.score).filter(l=>n?l.speaker.nom.toLowerCase().includes(n.toLowerCase())||l.speaker.congregation.toLowerCase().includes(n.toLowerCase()):!0)},[a,h,t,n,m]),D=()=>{k&&(g(k,o),x())},M=s=>s>=80?"text-green-600 bg-green-100 dark:bg-green-900/20":s>=50?"text-blue-600 bg-blue-100 dark:bg-blue-900/20":s>=30?"text-orange-600 bg-orange-100 dark:bg-orange-900/20":"text-gray-600 bg-gray-100 dark:bg-gray-900/20",E=s=>s>=80?"Excellent match":s>=50?"Bon match":s>=30?"Match acceptable":"Match faible";return e.jsx(_,{isOpen:r,onClose:x,title:"Trouver un rempla√ßant d'urgence",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(je,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200",children:"Remplacement d'urgence requis"}),e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300 mt-1",children:["Visite de ",e.jsx("strong",{children:t.nom})," le"," ",e.jsx("strong",{children:new Date(t.visitDate).toLocaleDateString("fr-FR")})," √†"," ",e.jsx("strong",{children:t.visitTime})]}),t.talkNoOrType&&e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300",children:["Discours : ",e.jsx("strong",{children:t.talkNoOrType})," - ",t.talkTheme]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:s=>f(s.target.value),placeholder:"Rechercher un orateur...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs(S,{variant:"outline",onClick:()=>N(!y),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Filtres"]})]}),y&&e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m,onChange:s=>v(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Uniquement disponibles"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:s=>j(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Proximit√© g√©ographique"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:u.length}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Orateurs trouv√©s"})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.filter(s=>s.score>=50).length}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:"Bons matchs"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:u.filter(s=>s.availableTalks.includes(t.talkNoOrType||"")).length}),e.jsx("div",{className:"text-sm text-purple-800 dark:text-purple-300",children:"M√™me discours"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(je,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun orateur trouv√©"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Essayez de modifier vos crit√®res de recherche"})]}):u.map(s=>e.jsx(z,{hoverable:!0,className:`cursor-pointer transition-all ${k?.id===s.speaker.id?"ring-2 ring-primary-500 bg-primary-50 dark:bg-primary-900/20":""}`,onClick:()=>d(s.speaker),children:e.jsx(I,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:s.speaker.nom.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:s.speaker.nom}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(pe,{className:"w-3 h-3"}),s.speaker.congregation]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.reasons.map((l,p)=>e.jsx(A,{variant:"default",className:"text-xs",children:l},p))}),s.availableTalks.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Discours : "}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[s.availableTalks.slice(0,5).join(", "),s.availableTalks.length>5&&` +${s.availableTalks.length-5}`]})]}),s.speaker.telephone&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(_e,{className:"w-3 h-3"}),s.speaker.telephone]}),s.lastVisit&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 dark:text-gray-500",children:[e.jsx(B,{className:"w-3 h-3"}),"Derni√®re visite : ",new Date(s.lastVisit).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full ${M(s.score)}`,children:e.jsx("span",{className:"text-lg font-bold",children:s.score})}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:E(s.score)})]})]})})},s.speaker.id))}),k&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:s=>C(s.target.checked),className:"mt-1 w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Envoyer une notification imm√©diate"})]}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300 mt-1",children:["Un message sera envoy√© √† ",k.nom," pour l'informer du remplacement d'urgence"]})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(S,{variant:"secondary",onClick:x,children:"Annuler"}),e.jsxs(S,{variant:"primary",onClick:D,disabled:!k,children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"S√©lectionner ce rempla√ßant"]})]})]})})},kt=({visit:r,onClick:x,onAction:t})=>{const[g,a]=c.useState(!1),h=c.useRef(null),n=j=>{switch(j){case"confirmed":return e.jsx(A,{variant:"success",size:"sm",children:"Confirm√©"});case"pending":return e.jsx(A,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(A,{variant:"default",size:"sm",children:"Termin√©"});case"cancelled":return e.jsx(A,{variant:"danger",size:"sm",children:"Annul√©"});default:return e.jsx(A,{variant:"default",size:"sm",children:j})}},f=(j,m)=>{m.stopPropagation(),t&&t(r,j),a(!1)},b=[{action:"edit",label:"Modifier",icon:We,color:"text-blue-600"},{action:"message",label:"Envoyer un message",icon:le,color:"text-green-600"},{action:"expenses",label:"D√©penses",icon:Xe,color:"text-purple-600"},{action:"logistics",label:"Logistique",icon:Ne,color:"text-blue-500"},{action:"status",label:"Changer le statut",icon:xe,color:"text-orange-600"},{action:"feedback",label:"Bilan",icon:Se,color:"text-yellow-500"},{action:"delete",label:"Supprimer",icon:Te,color:"text-red-600"}];return e.jsx(z,{hoverable:!0,className:"h-full relative overflow-visible",onClick:x,children:e.jsxs(I,{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-sm",children:r.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm line-clamp-1",children:r.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.congregation})]})]}),n(r.status)]}),e.jsxs("div",{className:"space-y-2 mb-4 flex-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(B,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"capitalize",children:R(new Date(r.visitDate),"EEEE d MMMM yyyy",{locale:F})})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(re,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:r.visitTime})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(pe,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"line-clamp-1",children:r.locationType==="physical"?"Salle du Royaume":"Visioconf√©rence"})]}),r.host&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(ye,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsxs("span",{className:"line-clamp-1",children:["Chez ",r.host]})]}),r.logistics?.checklist&&r.logistics.checklist.some(j=>!j.isCompleted)&&e.jsxs("div",{className:"flex items-center text-xs text-orange-600 dark:text-orange-400 mt-1",children:[e.jsx(Ne,{className:"w-3 h-3 mr-2"}),e.jsx("span",{children:"Logistique √† compl√©ter"})]})]}),e.jsx("div",{className:"pt-3 mt-3 border-t border-gray-100 dark:border-gray-700",children:e.jsx(Ue,{visit:r,size:"sm"})}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded inline-block mb-1",children:r.talkNoOrType==="Assembl√©e"||r.talkNoOrType==="Congr√®s"?r.talkNoOrType:`Discours n¬∞${r.talkNoOrType}`}),r.talkTheme&&r.talkNoOrType!=="Assembl√©e"&&r.talkNoOrType!=="Congr√®s"&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2 mt-1",children:r.talkTheme})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:h,"aria-label":"Options",className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:j=>{j.stopPropagation(),a(!g)},children:e.jsx(yt,{className:"w-4 h-4"})}),g&&He.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/20 backdrop-blur-sm",onClick:j=>{j.stopPropagation(),a(!1)}}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl z-50 w-72 overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:e.jsx("div",{className:"p-2",children:b.map(j=>e.jsxs("button",{className:"w-full px-4 py-3 text-left text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3 transition-colors mb-1 last:mb-0",onClick:m=>f(j.action,m),children:[e.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${j.color.replace("text-","bg-")}`,children:e.jsx(j.icon,{className:`w-5 h-5 ${j.color}`})}),j.label]},j.action))})})]}),document.body)]})]})]})})},Nt=({visits:r,onVisitClick:x,onVisitAction:t})=>r.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouv√©e pour cette p√©riode."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:r.map((g,a)=>e.jsx(kt,{visit:g,onClick:()=>x?.(g),onAction:t},`${g.id}-${a}`))}),vt=({visits:r,onVisitClick:x,onVisitAction:t})=>{const g=a=>{switch(a){case"confirmed":return e.jsx(A,{variant:"success",size:"sm",children:"Confirm√©"});case"pending":return e.jsx(A,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(A,{variant:"default",size:"sm",children:"Termin√©"});case"cancelled":return e.jsx(A,{variant:"danger",size:"sm",children:"Annul√©"});default:return e.jsx(A,{variant:"default",size:"sm",children:a})}};return r.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouv√©e pour cette p√©riode."})}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Orateur"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Discours"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Lieu / H√¥te"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:r.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:()=>x?.(a),children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:R(new Date(a.visitDate),"dd/MM/yyyy")}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.visitTime})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-xs mr-3",children:a.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.nom}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.congregation})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:["N¬∞",a.talkNoOrType]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:a.talkTheme})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:a.locationType==="physical"?"Salle du Royaume":"Visioconf√©rence"}),a.host&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Chez ",a.host]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g(a.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 p-1",onClick:h=>{h.stopPropagation(),t?.(a,"edit")},title:"Modifier",children:e.jsx(rt,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 p-1",onClick:h=>{h.stopPropagation(),t?.(a,"message")},title:"Message",children:e.jsx(le,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-red-600 dark:hover:text-red-400 p-1",onClick:h=>{h.stopPropagation(),t?.(a,"delete")},title:"Supprimer",children:e.jsx(Te,{className:"w-4 h-4"})})]})})]},a.id))})]})})})},wt=({visits:r,onVisitClick:x})=>{const[t,g]=c.useState(new Date),a=()=>g(at(t,1)),h=()=>g(te(t,1)),n=()=>g(new Date),f=ge(t),b=he(f),j=Je(f,{locale:F}),m=Ke(b,{locale:F}),v=Qe({start:j,end:m}),k=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],d=o=>r.filter(C=>st(new Date(C.visitDate),o));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:R(t,"MMMM yyyy",{locale:F})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:h,"aria-label":"Mois pr√©c√©dent",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"px-3 py-1 text-sm font-medium text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/20 rounded-md",children:"Aujourd'hui"}),e.jsx("button",{onClick:a,"aria-label":"Mois suivant",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(Ie,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:k.map(o=>e.jsx("div",{className:"py-3 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o},o))}),e.jsx("div",{className:"grid grid-cols-7 auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:v.map(o=>{const C=d(o),y=et(o,f),N=tt(o);return e.jsxs("div",{className:`
                min-h-[120px] bg-white dark:bg-gray-800 p-2 transition-colors
                ${y?"":"bg-gray-50 dark:bg-gray-800/50 text-gray-400 dark:text-gray-600"}
                ${N?"bg-blue-50/30 dark:bg-blue-900/10":""}
              `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`
                    text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                    ${N?"bg-primary-600 text-white":y?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}
                  `,children:R(o,"d")}),C.length>0&&e.jsx("span",{className:"text-xs font-medium text-gray-400",children:C.length})]}),e.jsx("div",{className:"space-y-1 mt-1",children:C.map(u=>e.jsxs("button",{onClick:()=>x?.(u),className:`
                      w-full text-left px-2 py-1 rounded text-xs font-medium truncate transition-colors
                      ${u.status==="confirmed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50":u.status==="pending"?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300 hover:bg-orange-200 dark:hover:bg-orange-900/50":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                    `,children:[u.visitTime," - ",u.nom]},u.id))})]},o.toString())})})]})},Ct=({isOpen:r,onClose:x,initialDate:t})=>{const{speakers:g,hosts:a,addVisit:h,publicTalks:n,visits:f,congregationProfile:b}=W(),{addToast:j}=Fe(),[m,v]=c.useState(!1),[k,d]=c.useState(""),[o,C]=c.useState({has:!1}),[y,N]=c.useState({visitDate:t?t.toISOString().split("T")[0]:"",visitTime:b.meetingTime||"14:30",locationType:"physical",status:"pending",talkNoOrType:"",talkTheme:"",nom:"",id:"",host:"",congregation:""});c.useEffect(()=>{y.visitDate&&(u(y.visitDate),D(y.visitDate))},[y.visitDate]);const u=l=>{const p=new Date(l),w=new Date;return w.setHours(0,0,0,0),p<w?(d("La date doit √™tre dans le futur"),!1):(d(""),!0)},D=l=>{const p=f.find(w=>w.visitDate===l);C(p?{has:!0,speakerName:p.nom}:{has:!1})},M=async l=>{if(l.preventDefault(),!u(y.visitDate||"")){j("Veuillez s√©lectionner une date valide dans le futur","error");return}v(!0);try{if(!y.id||!y.visitDate)throw new Error("Veuillez remplir les champs obligatoires");const p={...y,visitId:lt(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await h(p),j("Visite programm√©e avec succ√®s","success"),x()}catch(p){j(p instanceof Error?p.message:"Erreur lors de la cr√©ation","error")}finally{v(!1)}},E=l=>{const p=g.find(w=>w.id===l);p&&N(w=>({...w,id:p.id,nom:p.nom,congregation:p.congregation}))},s=l=>{const p=n.find(w=>w.number.toString()===l);p&&N(w=>({...w,talkNoOrType:p.number.toString(),talkTheme:p.theme}))};return e.jsx(_,{isOpen:r,onClose:x,title:"Programmer une visite",size:"lg",footer:e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"ghost",onClick:x,disabled:m,children:"Annuler"}),e.jsx(S,{onClick:M,isLoading:m,children:"Enregistrer"})]}),children:e.jsx("form",{onSubmit:M,className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(Y,{label:"Orateur",options:[{value:"",label:"S√©lectionner un orateur"},...g.map(l=>({value:l.id,label:`${l.nom} (${l.congregation})`}))],value:y.id||"",onChange:l=>E(l.target.value),required:!0})}),e.jsx(U,{type:"date",label:"Date",value:y.visitDate||"",onChange:l=>N(p=>({...p,visitDate:l.target.value})),required:!0,error:k}),o.has&&!k&&e.jsx("div",{className:"col-span-2 -mt-4",children:e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[e.jsx(se,{className:"w-4 h-4 text-yellow-600 dark:text-yellow-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[e.jsx("p",{className:"font-medium",children:"Une visite est d√©j√† programm√©e ce jour"}),e.jsxs("p",{className:"text-xs mt-1",children:["Orateur pr√©vu : ",o.speakerName]})]})]})}),e.jsx(U,{type:"time",label:"Heure",value:y.visitTime||"",onChange:l=>N(p=>({...p,visitTime:l.target.value})),required:!0}),e.jsx("div",{className:"col-span-2",children:e.jsx(Y,{label:"Discours (liste)",options:[{value:"",label:"S√©lectionner un discours"},...n.map(l=>({value:l.number.toString(),label:`N¬∞${l.number} - ${l.theme}`}))],value:y.talkNoOrType||"",onChange:l=>s(l.target.value)})}),e.jsx(U,{label:"N¬∞ Discours (manuel)",value:y.talkNoOrType||"",onChange:l=>N(p=>({...p,talkNoOrType:l.target.value})),placeholder:"Ex: 185"}),e.jsx(U,{label:"Titre du discours (manuel)",value:y.talkTheme||"",onChange:l=>N(p=>({...p,talkTheme:l.target.value})),placeholder:"Ex: Nega iluzon di mundu..."}),e.jsx(Y,{label:"Type de lieu",options:[{value:"physical",label:"Salle du Royaume"},{value:"zoom",label:"Visioconf√©rence"},{value:"streaming",label:"Streaming"}],value:y.locationType||"physical",onChange:l=>N(p=>({...p,locationType:l.target.value}))}),e.jsx(Y,{label:"Contact d'accueil",options:[{value:"",label:"Aucun"},...a.map(l=>({value:l.nom,label:l.nom}))],value:y.host||"",onChange:l=>N(p=>({...p,host:l.target.value}))})]})})})},Dt=()=>{const{speakers:r,visits:x}=W(),[t,g]=ke.useState(""),h=ke.useMemo(()=>r.map(n=>({speaker:n,workload:nt(n,x)})).sort((n,f)=>f.workload.currentLoad-n.workload.currentLoad),[r,x]).filter(({speaker:n})=>n.nom.toLowerCase().includes(t.toLowerCase())||n.congregation.toLowerCase().includes(t.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analyse de la Charge et Disponibilit√©"}),e.jsx("div",{className:"w-64",children:e.jsx(U,{placeholder:"Rechercher un orateur...",leftIcon:e.jsx(ue,{className:"w-4 h-4"}),value:t,onChange:n=>g(n.target.value)})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(({speaker:n,workload:f})=>e.jsx(z,{className:"overflow-hidden",children:e.jsxs(I,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold",children:n.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:n.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.congregation})]})]}),e.jsx(it,{workload:f})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Charge actuelle"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[f.currentLoad,"%"]})]}),e.jsx("progress",{value:f.currentLoad,max:100,className:`w-full h-2 rounded-full ${f.workloadScore>=5?"[&::-webkit-progress-value]:bg-red-500 [&::-moz-progress-bar]:bg-red-500":f.workloadScore>=4?"[&::-webkit-progress-value]:bg-orange-500 [&::-moz-progress-bar]:bg-orange-500":f.workloadScore>=3?"[&::-webkit-progress-value]:bg-yellow-500 [&::-moz-progress-bar]:bg-yellow-500":"[&::-webkit-progress-value]:bg-green-500 [&::-moz-progress-bar]:bg-green-500"} [&::-webkit-progress-bar]:bg-gray-100 [&::-webkit-progress-bar]:dark:bg-gray-700 [&::-moz-progress-bar]:bg-gray-100 [&::-moz-progress-bar]:dark:bg-gray-700`})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 border-t border-gray-100 dark:border-gray-700 pt-3",children:[e.jsx("span",{children:"Derni√®re visite:"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:f.lastVisit?new Date(f.lastVisit).toLocaleDateString():"Aucune"})]})]})]})},n.id))})]})},St=({visits:r})=>{if(r.length===0)return e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Aucune visite √† afficher dans la chronologie."});const x=r.reduce((g,a)=>{const h=ae(a.visitDate),n=R(h,"yyyy-MM",{locale:F});return g[n]||(g[n]=[]),g[n].push(a),g},{}),t=Object.keys(x).sort();return e.jsxs("div",{className:"relative space-y-8 p-4",children:[e.jsx("div",{className:"absolute left-4 md:left-1/2 top-4 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700 -ml-[1px]"}),t.map(g=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-center mb-6 relative z-10",children:e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 px-4 py-1 rounded-full text-sm font-semibold border-4 border-white dark:border-gray-900",children:R(ae(`${g}-01`),"MMMM yyyy",{locale:F})})}),e.jsx("div",{className:"space-y-6",children:x[g].map((a,h)=>{const n=ae(a.visitDate),f=h%2===0;return e.jsxs("div",{className:`flex flex-col md:flex-row items-center gap-4 md:gap-8 ${f?"md:flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-full md:w-1/2 pl-8 md:pl-0",children:e.jsxs(z,{className:"p-4 hover:shadow-lg transition-shadow border-l-4 border-l-primary-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-600 font-medium",children:[e.jsx(B,{className:"w-4 h-4"}),R(n,"EEEE d",{locale:F})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a.status==="confirmed"?"bg-green-100 text-green-800":a.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:a.status==="confirmed"?"Confirm√©":a.status==="pending"?"En attente":a.status})]}),e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-2",children:a.nom}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-3 h-3"}),a.congregation]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-3 h-3"}),e.jsx("div",{className:"flex-1 min-w-0",children:a.talkNoOrType?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:["N¬∞",a.talkNoOrType]}),a.talkTheme&&e.jsx("div",{className:"text-xs truncate",children:a.talkTheme})]}):"Pas de discours"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-3 h-3"}),a.visitTime]})]})]})}),e.jsx("div",{className:"absolute left-4 md:left-1/2 w-4 h-4 bg-primary-500 rounded-full md:-ml-2 border-4 border-white dark:border-gray-900 shadow-sm z-10 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("div",{className:"hidden md:block w-1/2"})]},a.id)})})]},g))]})},Tt=()=>{const{visits:r}=W(),[x,t]=c.useState(new Date().toISOString().slice(0,7)),[g]=c.useState("‚Ç¨"),a=c.useMemo(()=>r.flatMap(m=>(m.expenses||[]).map(v=>({...v,visitNom:m.nom,visitDate:m.visitDate}))),[r]),h=c.useMemo(()=>{const[m,v]=x.split("-").map(Number),k=ge(new Date(m,v-1)),d=he(new Date(m,v-1)),o=ge(te(k,1)),C=he(te(k,1)),y=a.filter(s=>ve(new Date(s.date),{start:k,end:d})),N=a.filter(s=>ve(new Date(s.date),{start:o,end:C})),u=y.reduce((s,l)=>s+l.amount,0),D=N.reduce((s,l)=>s+l.amount,0),M=D===0?0:(u-D)/D*100,E=y.reduce((s,l)=>{const p=l.category||"Autre";return s[p]=(s[p]||0)+l.amount,s},{});return{total:u,variation:M,count:y.length,byCategory:E,expenses:y.sort((s,l)=>new Date(l.date).getTime()-new Date(s.date).getTime())}},[a,x]),n=r.filter(m=>(m.expenses?.length||0)>0).length,f=n===0?0:a.reduce((m,v)=>m+v.amount,0)/n,b=()=>{const v=[["Date","Visite","Description","Cat√©gorie","Montant"].join(","),...h.expenses.map(o=>[o.date,`"${o.visitNom}"`,`"${o.description}"`,o.category,o.amount].join(","))].join(`
`),k=new Blob([v],{type:"text/csv;charset=utf-8;"}),d=document.createElement("a");d.href=URL.createObjectURL(k),d.download=`depenses_${x}.csv`,document.body.appendChild(d),d.click(),document.body.removeChild(d)},j=Array.from({length:12},(m,v)=>{const k=te(new Date,v),d=R(k,"yyyy-MM"),o=R(k,"MMMM yyyy",{locale:F});return{value:d,label:o.charAt(0).toUpperCase()+o.slice(1)}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-purple-600"}),"Tableau de bord financier"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Suivi des co√ªts et remboursements"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx(Y,{value:x,onChange:m=>t(m.target.value),options:j,className:"min-w-[180px]"}),e.jsx(S,{variant:"secondary",onClick:b,leftIcon:e.jsx(De,{className:"w-4 h-4"}),children:"Export"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(z,{children:e.jsxs(I,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"D√©penses du mois"}),e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[h.total.toFixed(2)," ",g]}),e.jsxs("div",{className:`flex items-center text-xs mt-1 ${h.variation>0?"text-red-500":"text-green-500"}`,children:[h.variation>0?e.jsx(xt,{className:"w-3 h-3 mr-1"}):e.jsx(ot,{className:"w-3 h-3 mr-1"}),Math.abs(h.variation).toFixed(1),"% vs mois dernier"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:e.jsx(Ze,{className:"w-5 h-5"})})]})}),e.jsx(z,{children:e.jsxs(I,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Co√ªt moyen / Visite"}),e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[f.toFixed(2)," ",g]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Sur toutes les visites"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:e.jsx(Be,{className:"w-5 h-5"})})]})}),e.jsx(z,{children:e.jsxs(I,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Nombre de notes"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:h.count}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ce mois-ci"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400",children:e.jsx(B,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(z,{className:"h-full",children:e.jsxs(I,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"R√©partition par cat√©gorie"}),e.jsx("div",{className:"space-y-4",children:Object.entries(h.byCategory).length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Aucune donn√©e"}):Object.entries(h.byCategory).sort(([,m],[,v])=>v-m).map(([m,v])=>{const k=v/h.total*100;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:m}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[v.toFixed(2)," ",g," (",k.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`bg-purple-600 h-2 rounded-full transition-all duration-500 w-[${k}%]`})})]},m)})})]})}),e.jsx(z,{className:"h-full",children:e.jsxs(I,{className:"p-0",children:[e.jsx("div",{className:"p-5 border-b border-gray-100 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Derni√®res d√©penses"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700 max-h-[300px] overflow-y-auto",children:h.expenses.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune d√©pense ce mois-ci"}):h.expenses.map(m=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:m.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[R(new Date(m.date),"dd MMM",{locale:F})," ‚Ä¢"," ",m.visitNom]})]}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:[m.amount.toFixed(2)," ",g]})]})},m.id))})]})})]})]})},we=({value:r,onChange:x,placeholder:t="S√©lectionner une date",className:g="",required:a=!1,disabled:h=!1,min:n,max:f})=>e.jsx("div",{className:`relative ${g}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:r||"",onChange:b=>x?.(b.target.value),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors",placeholder:t,required:a,disabled:h,min:n,max:f}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(B,{className:"w-4 h-4 text-gray-400"})})]})}),oe=r=>r?R(r,"yyyy-MM-dd"):"",Ce=r=>r?ae(r):null,Mt=({isOpen:r,onClose:x,dateRange:t,setDateRange:g,statusFilter:a,setStatusFilter:h,typeFilter:n,setTypeFilter:f})=>{const[b,j]=c.useState(t),[m,v]=c.useState(a),[k,d]=c.useState(n);c.useEffect(()=>{r&&(j(t),v(a),d(n))},[r,t,a,n]);const o=()=>{g(b),h(m),f(k),x()},C=()=>{x()},y=()=>{j({start:null,end:null}),v("all"),d("all")};return e.jsxs(_,{isOpen:r,onClose:x,title:"Filtres avanc√©s",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Statut"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"pending",label:"En attente"},{value:"confirmed",label:"Confirm√©"},{value:"completed",label:"Termin√©"},{value:"cancelled",label:"Annul√©"}].map(N=>e.jsx("button",{onClick:()=>v(N.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${m===N.value?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:N.label},N.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Type de visite"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"physical",label:"Physique"},{value:"zoom",label:"Zoom"},{value:"streaming",label:"Streaming"}].map(N=>e.jsx("button",{onClick:()=>d(N.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${k===N.value?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:N.label},N.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Plage de dates"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{value:oe(b.start),onChange:N=>j(u=>({...u,start:Ce(N)})),placeholder:"Date de d√©but"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(we,{value:oe(b.end),onChange:N=>j(u=>({...u,end:Ce(N)})),placeholder:"Date de fin",min:oe(b.start)})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(S,{variant:"ghost",onClick:y,children:"R√©initialiser"}),e.jsx(S,{variant:"ghost",onClick:C,children:"Annuler"}),e.jsx(S,{onClick:o,children:"Appliquer les filtres"})]})]})},ee=c.memo(({icon:r,value:x,label:t,bgColor:g,textColor:a,iconBg:h})=>e.jsx("div",{className:`${g} p-4 rounded-lg border`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${h} flex items-center justify-center`,children:e.jsx(r,{className:`w-4 h-4 ${a}`})}),e.jsxs("div",{children:[e.jsx("div",{className:`text-lg font-semibold ${a.replace("text-","text-").replace("blue-600","blue-900").replace("dark:text-blue-400","dark:text-blue-100")}`,children:x}),e.jsx("div",{className:"text-xs text-blue-700 dark:text-blue-300",children:t})]})]})})),At=c.memo(({viewOption:r,currentView:x,onViewChange:t})=>e.jsx("button",{onClick:()=>t(r.id),className:`p-2 rounded-md transition-all text-xs ${x===r.id?"bg-white dark:bg-gray-600 shadow-sm text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,title:r.description,children:e.jsx(r.icon,{className:"w-4 h-4"})})),Xt=()=>{const{visits:r,archivedVisits:x}=W(),[t,g]=c.useState("cards"),[a,h]=c.useState(""),[n,f]=c.useState("all"),[b,j]=c.useState("all"),[m,v]=c.useState(!1),[k,d]=c.useState(!1),[o,C]=c.useState(!1),[y,N]=c.useState({start:null,end:null}),[u,D]=c.useState(null),[M,E]=c.useState("edit"),[s,l]=c.useState(!1),[p,w]=c.useState(!1),[X,Z]=c.useState(!1),[ne,J]=c.useState(!1),K=c.useRef(null),T=Ge.useReactToPrint({contentRef:K,documentTitle:`Planning-visites-${new Date().toLocaleDateString()}`}),ie=()=>{if(t==="archives"){const V=[["Date","Heure","Orateur","Congr√©gation","Discours","Th√®me","H√¥te"].join(","),...x.map(O=>[O.visitDate,O.visitTime,`"${O.nom}"`,`"${O.congregation}"`,O.talkNoOrType||"",`"${O.talkTheme||""}"`,`"${O.host||""}"`].join(","))].join(`
`),G=new Blob([V],{type:"text/csv;charset=utf-8;"}),P=document.createElement("a");P.href=URL.createObjectURL(G),P.download=`visites_archivees_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(P),P.click(),document.body.removeChild(P)}else t==="finance"||T()},be=c.useCallback(i=>g(i),[]),Ve=c.useCallback(i=>h(i.target.value),[]),Re=c.useCallback(()=>v(!0),[]),Le=c.useCallback(()=>v(!1),[]),H=c.useCallback((i,V)=>{D(i),E(V),d(!0)},[]),$e=c.useCallback(()=>{d(!1),D(null)},[]),L=c.useMemo(()=>r.filter(i=>{const V=i.nom.toLowerCase().includes(a.toLowerCase())||i.congregation.toLowerCase().includes(a.toLowerCase())||i.talkNoOrType?.toLowerCase().includes(a.toLowerCase())||i.notes?.toLowerCase().includes(a.toLowerCase()),G=n==="all"||i.status===n,P=b==="all"||i.locationType===b,O=new Date(i.visitDate),$=(!y.start||O>=y.start)&&(!y.end||O<=y.end);return V&&G&&P&&$}).sort((i,V)=>new Date(i.visitDate).getTime()-new Date(V.visitDate).getTime()),[r,a,n,b,y]),Q=c.useMemo(()=>{const i=L.length,V=L.filter($=>$.status==="confirmed").length,G=L.filter($=>$.status==="pending").length,P=L.filter($=>$.status==="completed").length,O=L.filter($=>new Date($.visitDate)>=new Date&&$.status==="confirmed").length;return{total:i,confirmed:V,pending:G,completed:P,upcoming:O}},[L]),ze=c.useMemo(()=>[{id:"cards",label:"Cartes",icon:ht,description:"Vue visuelle des visites"},{id:"list",label:"Liste",icon:ut,description:"Tableau d√©taill√©"},{id:"calendar",label:"Calendrier",icon:B,description:"Vue calendrier"}],[]),Ee=c.useMemo(()=>[{id:"archives",label:"Archives",icon:de,description:"Visites termin√©es"},{id:"timeline",label:"Chronologie",icon:gt,description:"Timeline verticale"},{id:"workload",label:"Disponibilit√©",icon:mt,description:"Charge des orateurs"},{id:"finance",label:"Finances",icon:Oe,description:"Suivi des co√ªts"}],[]);return e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{leftIcon:e.jsx(qe,{className:"w-4 h-4"}),onClick:Re,size:"lg",children:"Programmer une visite"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4",children:[e.jsx(ee,{icon:B,value:Q.total,label:"Total",bgColor:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-200 dark:border-blue-800",textColor:"text-blue-600 dark:text-blue-400",iconBg:"bg-blue-100 dark:bg-blue-900"}),e.jsx(ee,{icon:()=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),value:Q.confirmed,label:"Confirm√©es",bgColor:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",textColor:"text-green-600 dark:text-green-400",iconBg:"bg-green-100 dark:bg-green-900"}),e.jsx(ee,{icon:re,value:Q.pending,label:"En attente",bgColor:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg border border-orange-200 dark:border-orange-800",textColor:"text-orange-600 dark:text-orange-400",iconBg:"bg-orange-100 dark:bg-orange-900"}),e.jsx(ee,{icon:()=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500"}),value:Q.upcoming,label:"√Ä venir",bgColor:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg border border-purple-200 dark:border-purple-800",textColor:"text-purple-600 dark:text-purple-400",iconBg:"bg-purple-100 dark:bg-purple-900"})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between bg-white dark:bg-gray-800 p-3 md:p-4 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex flex-col gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-1 min-w-0 md:min-w-64",children:e.jsx(U,{placeholder:"Rechercher une visite...",leftIcon:e.jsx(ue,{className:"w-4 h-4"}),value:a,onChange:Ve})}),e.jsx(S,{variant:"secondary",size:"sm",leftIcon:e.jsx(Me,{className:"w-4 h-4"}),onClick:()=>C(!0),children:"Filtres"})]}),(n!=="all"||b!=="all")&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[n!=="all"&&e.jsxs("button",{onClick:()=>f("all"),className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300 hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[n==="pending"&&"En attente",n==="confirmed"&&"Confirm√©",n==="completed"&&"Termin√©",n==="cancelled"&&"Annul√©",e.jsx(fe,{className:"w-3 h-3"})]}),b!=="all"&&e.jsxs("button",{onClick:()=>j("all"),className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors",children:[b==="physical"&&"Physique",b==="zoom"&&"Zoom",b==="streaming"&&"Streaming",e.jsx(fe,{className:"w-3 h-3"})]}),e.jsx("button",{onClick:()=>{f("all"),j("all")},className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 underline",children:"Effacer tout"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full lg:w-auto justify-between lg:justify-end",children:[e.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-gray-700 p-1 rounded-lg",children:[ze.map(i=>e.jsx(At,{viewOption:i,currentView:t,onViewChange:be},i.id)),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>J(!ne),className:`p-2 rounded-md transition-all text-xs ${["timeline","workload","finance"].includes(t)?"bg-white dark:bg-gray-600 shadow-sm text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700"}`,title:"Plus de vues",children:e.jsx(pt,{className:"w-4 h-4"})}),ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>J(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:Ee.map(i=>e.jsxs("button",{onClick:()=>{be(i.id),J(!1)},className:`w-full flex items-center gap-3 px-4 py-3 text-sm transition-colors ${t===i.id?"bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,children:[e.jsx(i.icon,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:i.label}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:i.description})]})]},i.id))})]})]})]}),e.jsx(S,{variant:"secondary",size:"sm",leftIcon:e.jsx(De,{className:"w-4 h-4"}),onClick:ie,children:"Exporter"})]})]}),e.jsxs("div",{className:"min-h-[400px] md:min-h-[600px]",ref:K,children:[t==="cards"&&e.jsx(Nt,{visits:L,onVisitAction:H,onVisitClick:i=>H(i,"edit")}),t==="list"&&e.jsx(vt,{visits:L,onVisitAction:H,onVisitClick:i=>H(i,"edit")}),t==="calendar"&&e.jsx(wt,{visits:L,onVisitClick:i=>H(i,"edit")}),t==="timeline"&&e.jsx(St,{visits:L}),t==="workload"&&e.jsx(Dt,{}),t==="finance"&&e.jsx(Tt,{}),t==="archives"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(de,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Visites archiv√©es (",x.length,")"]})]}),x.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(de,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Aucune visite archiv√©e"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Les visites termin√©es appara√Ætront ici automatiquement."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:x.sort((i,V)=>new Date(V.visitDate).getTime()-new Date(i.visitDate).getTime()).map(i=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:i.nom}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i.congregation})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",children:"Termin√©e"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Date:"}),e.jsx("span",{className:"font-medium",children:new Date(i.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Heure:"}),e.jsx("span",{children:i.visitTime})]}),i.talkNoOrType&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Discours:"}),e.jsx("span",{children:i.talkNoOrType})]}),i.host&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"H√¥te:"}),e.jsx("span",{children:i.host})]})]}),i.talkTheme&&e.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300 italic",children:['"',i.talkTheme,'"']})}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx(S,{variant:"secondary",size:"sm",onClick:()=>H(i,"message"),leftIcon:e.jsx(le,{className:"w-3 h-3"}),children:"Message"}),e.jsx(S,{variant:"secondary",size:"sm",onClick:()=>H(i,"feedback"),leftIcon:e.jsx(Se,{className:"w-3 h-3"}),children:"Bilan"})]})]},i.visitId))})]})]}),r.filter(i=>i.status==="confirmed"&&new Date(i.visitDate)<new Date).length>0&&e.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-900/50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-orange-100 dark:bg-orange-900 flex items-center justify-center",children:e.jsx(re,{className:"w-4 h-4 md:w-5 md:h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-orange-900 dark:text-orange-100",children:"Visites pass√©es √† archiver"}),e.jsxs("p",{className:"text-sm text-orange-700 dark:text-orange-300",children:[r.filter(i=>i.status==="confirmed"&&new Date(i.visitDate)<new Date).length," ","visite(s) pass√©e(s) n√©cessite(nt) une action"]})]})]}),e.jsx(S,{variant:"secondary",size:"sm",children:"Voir tout"})]})}),e.jsx(Ct,{isOpen:m,onClose:Le}),e.jsx(Ye,{isOpen:k,onClose:$e,visit:u,action:M}),e.jsx(Mt,{isOpen:o,onClose:()=>C(!1),dateRange:y,setDateRange:N,statusFilter:n,setStatusFilter:f,typeFilter:b,setTypeFilter:j}),u&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{isOpen:s,onClose:()=>l(!1),visit:u,onResolve:i=>{console.log("Conflict resolved:",i),l(!1)}}),e.jsx(jt,{isOpen:p,onClose:()=>w(!1),visit:u,onCancel:i=>{console.log("Visit cancelled:",i),w(!1)}}),e.jsx(ft,{isOpen:X,onClose:()=>Z(!1),visit:u,onSelectReplacement:i=>{console.log("Replacement selected:",i),Z(!1)}})]})]})};export{Xt as Planning};
//# sourceMappingURL=Planning-SXkzRTye.js.map
