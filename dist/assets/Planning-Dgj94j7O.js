import{c as W,j as e,d as B,e as H,C as I,g as ne,M as ie,k as me,l as U,m as Ve,i as te,u as J,b as Re,n as K,f as R,o as le,H as ze,I as Ee,p as $e,B as T,h as ye,D as Ce,T as Pe,q as Ie,A as fe,P as Fe,S as Be,X as je}from"./index-DUL-pobT.js";import{r as d,a as qe,R as ke}from"./charts-Cazb4rp-.js";import{M as de,U as G,B as O,P as He}from"./Badge-D10Q5L1j.js";import{C as Ue}from"./CommunicationProgress-S9pAULaS.js";import{T as Ne,P as _e,C as We,A as Xe,E as Ye,X as he,l as Ze,L as Ge,V as Ke}from"./VisitActionModal-DQbWhb0I.js";import{S as Se}from"./FeedbackFormModal-DUCHbmuA.js";import{T as Te,I as Je}from"./Input-BYRE2Q1N.js";import{f as P,s as ue,g as pe,h as Qe,j as ea,k as aa,l as ta,m as sa,n as se,q as ra,r as la,p as re,t as ve}from"./utils-FTT-aY8U.js";import{P as na,v as ia,c as da,W as ca,F as Me}from"./WorkloadIndicator-Cyp1gL7f.js";import{u as oa}from"./useVisitNotifications-1rgRa40W.js";import{S as xa,C as ga}from"./Select-BWq3nbgf.js";import{S as Oe}from"./MessageGeneratorModal-DQL85ffh.js";import{R as ma,A as oe}from"./rotate-ccw-DXFXJgwd.js";import"./react-vendor-B9D_A6Vq.js";const ha=W("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);const ua=W("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);const pa=W("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);const ya=W("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);const ba=W("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);const fa=W("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);const ja=W("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);const Ae=W("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),ka=({visit:l,onClick:g,onAction:a})=>{const[c,t]=d.useState(!1),u=d.useRef(null),n=b=>{switch(b){case"confirmed":return e.jsx(O,{variant:"success",size:"sm",children:"Confirmé"});case"pending":return e.jsx(O,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(O,{variant:"default",size:"sm",children:"Terminé"});case"cancelled":return e.jsx(O,{variant:"danger",size:"sm",children:"Annulé"});default:return e.jsx(O,{variant:"default",size:"sm",children:b})}},f=(b,x)=>{x.stopPropagation(),a&&a(l,b),t(!1)},p=[{action:"edit",label:"Modifier",icon:_e,color:"text-blue-600"},{action:"message",label:"Envoyer un message",icon:ie,color:"text-green-600"},{action:"expenses",label:"Dépenses",icon:We,color:"text-purple-600"},{action:"logistics",label:"Logistique",icon:Ne,color:"text-blue-500"},{action:"status",label:"Changer le statut",icon:me,color:"text-orange-600"},{action:"feedback",label:"Bilan",icon:Se,color:"text-yellow-500"},{action:"delete",label:"Supprimer",icon:Te,color:"text-red-600"}];return e.jsx(B,{hoverable:!0,className:"h-full relative overflow-visible",onClick:g,children:e.jsxs(H,{className:"p-4 flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-sm",children:l.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white text-sm line-clamp-1",children:l.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:l.congregation})]})]}),n(l.status)]}),e.jsxs("div",{className:"space-y-2 mb-4 flex-1",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(I,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"capitalize",children:P(new Date(l.visitDate),"EEEE d MMMM yyyy",{locale:U})})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(ne,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{children:l.visitTime})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(de,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsx("span",{className:"line-clamp-1",children:l.locationType==="physical"?"Salle du Royaume":"Visioconférence"})]}),l.host&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx(G,{className:"w-4 h-4 mr-2 text-gray-400"}),e.jsxs("span",{className:"line-clamp-1",children:["Chez ",l.host]})]}),l.logistics?.checklist&&l.logistics.checklist.some(b=>!b.isCompleted)&&e.jsxs("div",{className:"flex items-center text-xs text-orange-600 dark:text-orange-400 mt-1",children:[e.jsx(Ne,{className:"w-3 h-3 mr-2"}),e.jsx("span",{children:"Logistique à compléter"})]})]}),e.jsx("div",{className:"pt-3 mt-3 border-t border-gray-100 dark:border-gray-700",children:e.jsx(Ue,{visit:l,size:"sm"})}),e.jsxs("div",{className:"pt-3 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs font-medium text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded inline-block mb-1",children:l.talkNoOrType==="Assemblée"||l.talkNoOrType==="Congrès"?l.talkNoOrType:`Discours n°${l.talkNoOrType}`}),l.talkTheme&&l.talkNoOrType!=="Assemblée"&&l.talkNoOrType!=="Congrès"&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2 mt-1",children:l.talkTheme})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{ref:u,"aria-label":"Options",className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",onClick:b=>{b.stopPropagation(),t(!c)},children:e.jsx(ja,{className:"w-4 h-4"})}),c&&qe.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-50 bg-black/20 backdrop-blur-sm",onClick:b=>{b.stopPropagation(),t(!1)}}),e.jsx("div",{className:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl z-50 w-72 overflow-hidden animate-in fade-in zoom-in-95 duration-200",children:e.jsx("div",{className:"p-2",children:p.map(b=>e.jsxs("button",{className:"w-full px-4 py-3 text-left text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg flex items-center gap-3 transition-colors mb-1 last:mb-0",onClick:x=>f(b.action,x),children:[e.jsx("div",{className:`p-2 rounded-full bg-opacity-10 ${b.color.replace("text-","bg-")}`,children:e.jsx(b.icon,{className:`w-5 h-5 ${b.color}`})}),b.label]},b.action))})})]}),document.body)]})]})]})})},Na=({visits:l,onVisitClick:g,onVisitAction:a})=>l.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouvée pour cette période."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:l.map((c,t)=>e.jsx(ka,{visit:c,onClick:()=>g?.(c),onAction:a},`${c.id}-${t}`))}),va=({visits:l,onVisitClick:g,onVisitAction:a})=>{const c=t=>{switch(t){case"confirmed":return e.jsx(O,{variant:"success",size:"sm",children:"Confirmé"});case"pending":return e.jsx(O,{variant:"warning",size:"sm",children:"En attente"});case"completed":return e.jsx(O,{variant:"default",size:"sm",children:"Terminé"});case"cancelled":return e.jsx(O,{variant:"danger",size:"sm",children:"Annulé"});default:return e.jsx(O,{variant:"default",size:"sm",children:t})}};return l.length===0?e.jsx("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucune visite trouvée pour cette période."})}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Orateur"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Discours"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Lieu / Hôte"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Statut"}),e.jsx("th",{scope:"col",className:"relative px-6 py-3",children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:l.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors cursor-pointer",onClick:()=>g?.(t),children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:P(new Date(t.visitDate),"dd/MM/yyyy")}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.visitTime})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-xs mr-3",children:t.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.nom}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.congregation})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-white",children:["N°",t.talkNoOrType]}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs",children:t.talkTheme})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:t.locationType==="physical"?"Salle du Royaume":"Visioconférence"}),t.host&&e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Chez ",t.host]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c(t.status)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{className:"text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 p-1",onClick:u=>{u.stopPropagation(),a?.(t,"edit")},title:"Modifier",children:e.jsx(na,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 p-1",onClick:u=>{u.stopPropagation(),a?.(t,"message")},title:"Message",children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("button",{className:"text-gray-400 hover:text-red-600 dark:hover:text-red-400 p-1",onClick:u=>{u.stopPropagation(),a?.(t,"delete")},title:"Supprimer",children:e.jsx(Te,{className:"w-4 h-4"})})]})})]},t.id))})]})})})},wa=({visits:l,onVisitClick:g})=>{const[a,c]=d.useState(new Date),t=()=>c(ra(a,1)),u=()=>c(se(a,1)),n=()=>c(new Date),f=ue(a),p=pe(f),b=Qe(f,{locale:U}),x=ea(p,{locale:U}),k=aa({start:b,end:x}),j=["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],r=o=>l.filter(C=>la(new Date(C.visitDate),o));return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:P(a,"MMMM yyyy",{locale:U})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,"aria-label":"Mois précédent",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(Ve,{className:"w-5 h-5"})}),e.jsx("button",{onClick:n,className:"px-3 py-1 text-sm font-medium text-primary-600 hover:bg-primary-50 dark:text-primary-400 dark:hover:bg-primary-900/20 rounded-md",children:"Aujourd'hui"}),e.jsx("button",{onClick:t,"aria-label":"Mois suivant",className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-600 dark:text-gray-400",children:e.jsx(te,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:j.map(o=>e.jsx("div",{className:"py-3 text-center text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:o},o))}),e.jsx("div",{className:"grid grid-cols-7 auto-rows-fr bg-gray-200 dark:bg-gray-700 gap-px",children:k.map(o=>{const C=r(o),v=ta(o,f),D=sa(o);return e.jsxs("div",{className:`
                min-h-[120px] bg-white dark:bg-gray-800 p-2 transition-colors
                ${v?"":"bg-gray-50 dark:bg-gray-800/50 text-gray-400 dark:text-gray-600"}
                ${D?"bg-blue-50/30 dark:bg-blue-900/10":""}
              `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`
                    text-sm font-medium w-7 h-7 flex items-center justify-center rounded-full
                    ${D?"bg-primary-600 text-white":v?"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}
                  `,children:P(o,"d")}),C.length>0&&e.jsx("span",{className:"text-xs font-medium text-gray-400",children:C.length})]}),e.jsx("div",{className:"space-y-1 mt-1",children:C.map(m=>e.jsxs("button",{onClick:()=>g?.(m),className:`
                      w-full text-left px-2 py-1 rounded text-xs font-medium truncate transition-colors
                      ${m.status==="confirmed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300 hover:bg-green-200 dark:hover:bg-green-900/50":m.status==="pending"?"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300 hover:bg-orange-200 dark:hover:bg-orange-900/50":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}
                    `,children:[m.visitTime," - ",m.nom]},m.id))})]},o.toString())})})]})},Da=({isOpen:l,onClose:g,initialDate:a})=>{const{speakers:c,hosts:t,addVisit:u,publicTalks:n,visits:f,congregationProfile:p}=J(),{addToast:b}=Re(),{scheduleVisitReminder:x}=oa(),[k,j]=d.useState(!1),[r,o]=d.useState(1),[C,v]=d.useState(""),[D,m]=d.useState({has:!1}),[h,S]=d.useState({visitDate:a?a.toISOString().split("T")[0]:"",visitTime:p.meetingTime||"14:30",locationType:"physical",status:"pending",talkNoOrType:"",talkTheme:"",nom:"",id:"",host:"",congregation:""});d.useEffect(()=>{l&&o(1),a&&S(i=>({...i,visitDate:a.toISOString().split("T")[0]}))},[l,a]),d.useEffect(()=>{h.visitDate&&(F(h.visitDate),s(h.visitDate))},[h.visitDate]);const F=i=>{const w=new Date(i),M=new Date;return M.setHours(0,0,0,0),w<M?(v("La date doit être dans le futur"),!1):(v(""),!0)},s=i=>{const w=f.find(M=>M.visitDate===i);m(w?{has:!0,speakerName:w.nom}:{has:!1})},N=i=>{const w=c.find(M=>M.id===i);if(w){const M=w.congregation==="Lyon KBV"||w.congregation==="Lyon";S(X=>({...X,id:w.id,nom:w.nom,congregation:w.congregation,host:M?"":X.host}))}},A=i=>{const w=n.find(M=>M.number.toString()===i);S(w?M=>({...M,talkNoOrType:w.number.toString(),talkTheme:w.theme}):M=>({...M,talkNoOrType:i}))},z=async()=>{if(!F(h.visitDate||"")){b("Veuillez sélectionner une date valide","error");return}j(!0);try{if(!h.id||!h.visitDate)throw new Error("Champs obligatoires manquants");const i={...h,visitId:ia(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await u(i),await x(i),b("Visite programmée avec succès","success"),g()}catch{b("Erreur lors de la création","error")}finally{j(!1)}},_=h.congregation==="Lyon KBV"||h.congregation==="Lyon";return e.jsx(K,{isOpen:l,onClose:g,title:"",size:"lg",padding:"none",hideCloseButton:!0,className:"max-sm:rounded-none overflow-hidden",children:e.jsxs("div",{className:"flex flex-col h-[85vh] md:h-auto bg-white dark:bg-gray-900 md:max-h-[85vh]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-600 to-violet-600 p-6 md:p-8 text-white relative overflow-hidden shrink-0",children:[e.jsx(I,{className:"absolute right-[-10px] top-[-10px] w-32 h-32 opacity-10 rotate-12"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-2xl font-black tracking-tighter mb-1",children:"Nouvelle Visite"}),e.jsx("p",{className:"text-indigo-100 text-sm",children:"Organisez le programme spirituel"}),e.jsxs("div",{className:"flex items-center gap-2 mt-6",children:[[1,2,3].map(i=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:R("w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all duration-300",r>=i?"bg-white text-indigo-600 shadow-md scale-110":"bg-indigo-900/40 text-indigo-300"),children:i}),i<3&&e.jsx("div",{className:R("w-8 md:w-16 h-1 mx-2 rounded-full",r>i?"bg-white/50":"bg-indigo-900/20")})]},i)),e.jsx("span",{className:"ml-auto text-xs font-bold uppercase tracking-widest opacity-80",children:r===1?"Date & Orateur":r===2?"Logistique":"Confirmation"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 md:p-8 space-y-8",children:[r===1&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest pl-1",children:"Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"date",value:h.visitDate,onChange:i=>S(w=>({...w,visitDate:i.target.value})),className:R("w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 transition-all",C?"focus:ring-red-500 bg-red-50 dark:bg-red-900/20":"focus:ring-indigo-500")})]}),C&&e.jsx("p",{className:"text-xs text-red-600 font-medium pl-1",children:C})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest pl-1",children:"Heure"}),e.jsxs("div",{className:"relative",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"time",value:h.visitTime,onChange:i=>S(w=>({...w,visitTime:i.target.value})),className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500"})]})]})]}),D.has&&e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-800 rounded-xl flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600 shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-orange-800 dark:text-orange-200",children:"Attention : Conflit potentiel"}),e.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-300 mt-1",children:["Une visite est déjà prévue ce jour avec ",D.speakerName,"."]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest pl-1",children:"Orateur"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:h.id||"",onChange:i=>N(i.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500 appearance-none",children:[e.jsx("option",{value:"",children:"Sélectionner un orateur..."}),c.map(i=>e.jsxs("option",{value:i.id,children:[i.nom," (",i.congregation,")"]},i.id))]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx(te,{className:"w-4 h-4 text-gray-400 rotate-90"})})]})]}),e.jsxs("div",{className:"space-y-4 pt-2 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-4 h-4 text-indigo-500"}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:"Discours"})]}),e.jsxs("div",{className:"grid grid-cols-[1fr,2fr] gap-4",children:[e.jsx("input",{placeholder:"N°",value:h.talkNoOrType||"",onChange:i=>A(i.target.value),list:"talks-list",className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500"}),e.jsx("input",{placeholder:"Thème du discours...",value:h.talkTheme||"",onChange:i=>S(w=>({...w,talkTheme:i.target.value})),className:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500"}),e.jsx("datalist",{id:"talks-list",children:n.map(i=>e.jsx("option",{value:i.number,children:i.theme},i.number))})]})]})]}),r===2&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest pl-1",children:"Mode de diffusion"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{id:"physical",label:"Présentiel",icon:de},{id:"zoom",label:"Zoom",icon:G},{id:"streaming",label:"Streaming",icon:G}].map(i=>e.jsxs("button",{onClick:()=>S(w=>({...w,locationType:i.id})),className:R("flex flex-col items-center gap-2 p-4 rounded-xl border-2 transition-all",h.locationType===i.id?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-700 dark:text-indigo-300":"border-gray-100 dark:border-gray-800 text-gray-500 hover:border-gray-200"),children:[e.jsx(i.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-bold",children:i.label})]},i.id))})]}),h.locationType==="physical"&&!_&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-gray-100 dark:border-gray-800 animate-in fade-in duration-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-teal-500"}),e.jsx("h4",{className:"text-sm font-bold text-gray-900 dark:text-white",children:"Hospitalité"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:h.host||"",onChange:i=>S(w=>({...w,host:i.target.value})),className:"w-full pl-4 pr-10 py-3 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-teal-500 appearance-none",children:[e.jsx("option",{value:"",children:"Sélectionner un hôte..."}),t.map((i,w)=>e.jsx("option",{value:i.nom,children:i.nom},w))]}),e.jsx(te,{className:"absolute right-4 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 rotate-90 pointer-events-none"})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl flex gap-3 text-blue-700 dark:text-blue-300 text-xs leading-relaxed",children:[e.jsx(Ee,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsx("p",{children:"L'orateur vient d'une autre congrégation. Pensez à vérifier ses besoins en matière de repas ou d'hébergement."})]})]}),_&&e.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-800 rounded-2xl text-center",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Aucune logistique nécessaire pour un orateur local."})})]}),r===3&&e.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-8 duration-300 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx($e,{className:"w-10 h-10 text-green-600 dark:text-green-400"})}),e.jsx("h3",{className:"text-xl font-black text-gray-900 dark:text-white",children:"Tout semble correct ?"}),e.jsx("p",{className:"text-gray-500 text-sm max-w-sm mx-auto",children:"Vérifiez les détails ci-dessous avant de confirmer la programmation de cette visite."}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-2xl p-6 text-left space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"Date"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:new Date(h.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"Orateur"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:h.nom})]}),e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"Discours"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-right max-w-[200px] truncate",children:h.talkNoOrType?`N°${h.talkNoOrType} - ${h.talkTheme}`:"Non défini"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"Logistique"}),e.jsx(O,{variant:"default",className:"text-xs",children:h.host||"Aucun hôte"})]})]})]})]}),e.jsxs("div",{className:"p-6 md:p-8 border-t border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900 shrink-0 flex justify-between items-center",children:[r>1&&e.jsx(T,{variant:"ghost",onClick:()=>o(i=>i-1),children:"Précédent"}),r===1&&e.jsx(T,{variant:"ghost",onClick:g,className:"text-red-500 hover:bg-red-50",children:"Annuler"}),r<3?e.jsxs(T,{className:"ml-auto bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-200 dark:shadow-none",onClick:()=>{if(!h.visitDate||!h.id){b("Veuillez remplir les champs obligatoires","error");return}o(i=>i+1)},children:["Suivant ",e.jsx(te,{className:"w-4 h-4 ml-1"})]}):e.jsx(T,{className:"ml-auto bg-green-600 hover:bg-green-700 text-white shadow-lg shadow-green-200 dark:shadow-none px-8",onClick:z,isLoading:k,children:"Confirmer"})]})]})})},Ca=()=>{const{speakers:l,visits:g}=J(),[a,c]=ke.useState(""),u=ke.useMemo(()=>l.map(n=>({speaker:n,workload:da(n,g)})).sort((n,f)=>f.workload.currentLoad-n.workload.currentLoad),[l,g]).filter(({speaker:n})=>n.nom.toLowerCase().includes(a.toLowerCase())||n.congregation.toLowerCase().includes(a.toLowerCase()));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Analyse de la Charge et Disponibilité"}),e.jsx("div",{className:"w-64",children:e.jsx(Je,{placeholder:"Rechercher un orateur...",leftIcon:e.jsx(ye,{className:"w-4 h-4"}),value:a,onChange:n=>c(n.target.value)})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(({speaker:n,workload:f})=>e.jsx(B,{className:"overflow-hidden",children:e.jsxs(H,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold",children:n.nom.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:n.nom}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:n.congregation})]})]}),e.jsx(ca,{workload:f})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-500",children:"Charge actuelle"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[f.currentLoad,"%"]})]}),e.jsx("progress",{value:f.currentLoad,max:100,className:`w-full h-2 rounded-full ${f.workloadScore>=5?"[&::-webkit-progress-value]:bg-red-500 [&::-moz-progress-bar]:bg-red-500":f.workloadScore>=4?"[&::-webkit-progress-value]:bg-orange-500 [&::-moz-progress-bar]:bg-orange-500":f.workloadScore>=3?"[&::-webkit-progress-value]:bg-yellow-500 [&::-moz-progress-bar]:bg-yellow-500":"[&::-webkit-progress-value]:bg-green-500 [&::-moz-progress-bar]:bg-green-500"} [&::-webkit-progress-bar]:bg-gray-100 [&::-webkit-progress-bar]:dark:bg-gray-700 [&::-moz-progress-bar]:bg-gray-100 [&::-moz-progress-bar]:dark:bg-gray-700`})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500 border-t border-gray-100 dark:border-gray-700 pt-3",children:[e.jsx("span",{children:"Dernière visite:"}),e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:f.lastVisit?new Date(f.lastVisit).toLocaleDateString():"Aucune"})]})]})]})},n.id))})]})},Sa=({visits:l})=>{if(l.length===0)return e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"Aucune visite à afficher dans la chronologie."});const g=l.reduce((c,t)=>{const u=re(t.visitDate),n=P(u,"yyyy-MM",{locale:U});return c[n]||(c[n]=[]),c[n].push(t),c},{}),a=Object.keys(g).sort();return e.jsxs("div",{className:"relative space-y-8 p-4",children:[e.jsx("div",{className:"absolute left-4 md:left-1/2 top-4 bottom-4 w-0.5 bg-gray-200 dark:bg-gray-700 -ml-[1px]"}),a.map(c=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-center mb-6 relative z-10",children:e.jsx("span",{className:"bg-primary-100 dark:bg-primary-900 text-primary-800 dark:text-primary-200 px-4 py-1 rounded-full text-sm font-semibold border-4 border-white dark:border-gray-900",children:P(re(`${c}-01`),"MMMM yyyy",{locale:U})})}),e.jsx("div",{className:"space-y-6",children:g[c].map((t,u)=>{const n=re(t.visitDate),f=u%2===0;return e.jsxs("div",{className:`flex flex-col md:flex-row items-center gap-4 md:gap-8 ${f?"md:flex-row-reverse":""}`,children:[e.jsx("div",{className:"w-full md:w-1/2 pl-8 md:pl-0",children:e.jsxs(B,{className:"p-4 hover:shadow-lg transition-shadow border-l-4 border-l-primary-500",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-primary-600 font-medium",children:[e.jsx(I,{className:"w-4 h-4"}),P(n,"EEEE d",{locale:U})]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.status==="confirmed"?"bg-green-100 text-green-800":t.status==="pending"?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"}`,children:t.status==="confirmed"?"Confirmé":t.status==="pending"?"En attente":t.status})]}),e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-2",children:t.nom}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-3 h-3"}),t.congregation]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("div",{className:"flex-1 min-w-0",children:t.talkNoOrType?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-medium",children:["N°",t.talkNoOrType]}),t.talkTheme&&e.jsx("div",{className:"text-xs truncate",children:t.talkTheme})]}):"Pas de discours"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-3 h-3"}),t.visitTime]})]})]})}),e.jsx("div",{className:"absolute left-4 md:left-1/2 w-4 h-4 bg-primary-500 rounded-full md:-ml-2 border-4 border-white dark:border-gray-900 shadow-sm z-10 flex items-center justify-center",children:e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("div",{className:"hidden md:block w-1/2"})]},t.id)})})]},c))]})},Ta=()=>{const{visits:l}=J(),[g,a]=d.useState(new Date().toISOString().slice(0,7)),[c]=d.useState("€"),t=d.useMemo(()=>l.flatMap(x=>(x.expenses||[]).map(k=>({...k,visitNom:x.nom,visitDate:x.visitDate}))),[l]),u=d.useMemo(()=>{const[x,k]=g.split("-").map(Number),j=ue(new Date(x,k-1)),r=pe(new Date(x,k-1)),o=ue(se(j,1)),C=pe(se(j,1)),v=t.filter(s=>ve(new Date(s.date),{start:j,end:r})),D=t.filter(s=>ve(new Date(s.date),{start:o,end:C})),m=v.reduce((s,N)=>s+N.amount,0),h=D.reduce((s,N)=>s+N.amount,0),S=h===0?0:(m-h)/h*100,F=v.reduce((s,N)=>{const A=N.category||"Autre";return s[A]=(s[A]||0)+N.amount,s},{});return{total:m,variation:S,count:v.length,byCategory:F,expenses:v.sort((s,N)=>new Date(N.date).getTime()-new Date(s.date).getTime())}},[t,g]),n=l.filter(x=>(x.expenses?.length||0)>0).length,f=n===0?0:t.reduce((x,k)=>x+k.amount,0)/n,p=()=>{const k=[["Date","Visite","Description","Catégorie","Montant"].join(","),...u.expenses.map(o=>[o.date,`"${o.visitNom}"`,`"${o.description}"`,o.category,o.amount].join(","))].join(`
`),j=new Blob([k],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(j),r.download=`depenses_${g}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r)},b=Array.from({length:12},(x,k)=>{const j=se(new Date,k),r=P(j,"yyyy-MM"),o=P(j,"MMMM yyyy",{locale:U});return{value:r,label:o.charAt(0).toUpperCase()+o.slice(1)}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-purple-600"}),"Tableau de bord financier"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Suivi des coûts et remboursements"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx(xa,{value:g,onChange:x=>a(x.target.value),options:b,className:"min-w-[180px]"}),e.jsx(T,{variant:"secondary",onClick:p,leftIcon:e.jsx(Ce,{className:"w-4 h-4"}),children:"Export"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(B,{children:e.jsxs(H,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Dépenses du mois"}),e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[u.total.toFixed(2)," ",c]}),e.jsxs("div",{className:`flex items-center text-xs mt-1 ${u.variation>0?"text-red-500":"text-green-500"}`,children:[u.variation>0?e.jsx(Xe,{className:"w-3 h-3 mr-1"}):e.jsx(ha,{className:"w-3 h-3 mr-1"}),Math.abs(u.variation).toFixed(1),"% vs mois dernier"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400",children:e.jsx(Ye,{className:"w-5 h-5"})})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Coût moyen / Visite"}),e.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[f.toFixed(2)," ",c]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Sur toutes les visites"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400",children:e.jsx(Pe,{className:"w-5 h-5"})})]})}),e.jsx(B,{children:e.jsxs(H,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Nombre de notes"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.count}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Ce mois-ci"})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400",children:e.jsx(I,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(B,{className:"h-full",children:e.jsxs(H,{className:"p-5",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white mb-4",children:"Répartition par catégorie"}),e.jsx("div",{className:"space-y-4",children:Object.entries(u.byCategory).length===0?e.jsx("p",{className:"text-center text-gray-500 py-4",children:"Aucune donnée"}):Object.entries(u.byCategory).sort(([,x],[,k])=>k-x).map(([x,k])=>{const j=k/u.total*100;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:x}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[k.toFixed(2)," ",c," (",j.toFixed(0),"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`bg-purple-600 h-2 rounded-full transition-all duration-500 w-[${j}%]`})})]},x)})})]})}),e.jsx(B,{className:"h-full",children:e.jsxs(H,{className:"p-0",children:[e.jsx("div",{className:"p-5 border-b border-gray-100 dark:border-gray-700",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Dernières dépenses"})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700 max-h-[300px] overflow-y-auto",children:u.expenses.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Aucune dépense ce mois-ci"}):u.expenses.map(x=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white text-sm",children:x.description}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[P(new Date(x.date),"dd MMM",{locale:U})," •"," ",x.visitNom]})]}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white text-sm",children:[x.amount.toFixed(2)," ",c]})]})},x.id))})]})})]})]})},we=({value:l,onChange:g,placeholder:a="Sélectionner une date",className:c="",required:t=!1,disabled:u=!1,min:n,max:f})=>e.jsx("div",{className:`relative ${c}`,children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"date",value:l||"",onChange:p=>g?.(p.target.value),className:"w-full px-3 py-2 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-colors",placeholder:a,required:t,disabled:u,min:n,max:f}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx(I,{className:"w-4 h-4 text-gray-400"})})]})}),xe=l=>l?P(l,"yyyy-MM-dd"):"",De=l=>l?re(l):null,Ma=({isOpen:l,onClose:g,dateRange:a,setDateRange:c,statusFilter:t,setStatusFilter:u,typeFilter:n,setTypeFilter:f})=>{const[p,b]=d.useState(a),[x,k]=d.useState(t),[j,r]=d.useState(n);d.useEffect(()=>{l&&(b(a),k(t),r(n))},[l,a,t,n]);const o=()=>{c(p),u(x),f(j),g()},C=()=>{g()},v=()=>{b({start:null,end:null}),k("all"),r("all")};return e.jsxs(K,{isOpen:l,onClose:g,title:"Filtres avancés",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Statut"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"pending",label:"En attente"},{value:"confirmed",label:"Confirmé"},{value:"completed",label:"Terminé"},{value:"cancelled",label:"Annulé"}].map(D=>e.jsx("button",{onClick:()=>k(D.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${x===D.value?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:D.label},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Type de visite"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"Tous"},{value:"physical",label:"Physique"},{value:"zoom",label:"Zoom"},{value:"streaming",label:"Streaming"}].map(D=>e.jsx("button",{onClick:()=>r(D.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${j===D.value?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:D.label},D.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Plage de dates"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{value:xe(p.start),onChange:D=>b(m=>({...m,start:De(D)})),placeholder:"Date de début"}),e.jsx("span",{className:"text-gray-500",children:"-"}),e.jsx(we,{value:xe(p.end),onChange:D=>b(m=>({...m,end:De(D)})),placeholder:"Date de fin",min:xe(p.start)})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx(T,{variant:"ghost",onClick:v,children:"Réinitialiser"}),e.jsx(T,{variant:"ghost",onClick:C,children:"Annuler"}),e.jsx(T,{onClick:o,children:"Appliquer les filtres"})]})]})},Oa=({isOpen:l,onClose:g,visit:a,onResolve:c})=>{const{visits:t,hosts:u}=J(),[n,f]=d.useState(new Map),p=d.useMemo(()=>{const r=[],o=t.find(m=>m.id===a.id&&m.visitId!==a.visitId&&m.visitDate===a.visitDate&&m.status!=="cancelled");if(o&&r.push({id:"conflict-speaker-date",type:"speaker",severity:"critical",message:"Orateur déjà programmé",details:`${a.nom} est déjà programmé le ${new Date(a.visitDate).toLocaleDateString("fr-FR")}`,affectedVisit:o,suggestions:[{id:"suggest-reschedule",type:"reschedule",description:"Reprogrammer cette visite à une autre date",impact:"medium"},{id:"suggest-cancel-other",type:"cancel",description:"Annuler l'autre visite",impact:"high"}]}),u.find(m=>m.nom===a.host)?.unavailableDates?.includes(a.visitDate)){const m=u.filter(h=>!h.unavailableDates?.includes(a.visitDate)&&h.gender===a.congregation);r.push({id:"conflict-host-unavailable",type:"host",severity:"warning",message:"Hôte indisponible",details:`${a.host} n'est pas disponible le ${new Date(a.visitDate).toLocaleDateString("fr-FR")}`,suggestions:m.slice(0,3).map((h,S)=>({id:`suggest-host-${S}`,type:"change_host",description:`Assigner à ${h.nom}`,newHost:h,impact:"low"}))})}const v=t.find(m=>m.visitId!==a.visitId&&m.talkNoOrType===a.talkNoOrType&&m.status==="completed"&&Math.abs(new Date(m.visitDate).getTime()-new Date(a.visitDate).getTime())<2160*60*60*1e3);v&&a.talkNoOrType&&r.push({id:"conflict-talk-recent",type:"talk",severity:"info",message:"Discours récemment donné",details:`Le discours ${a.talkNoOrType} a été donné il y a moins de 3 mois`,affectedVisit:v,suggestions:[{id:"suggest-different-talk",type:"change_speaker",description:"Choisir un autre discours",impact:"low"},{id:"suggest-ignore",type:"reschedule",description:"Continuer quand même",impact:"low"}]});const D=t.filter(m=>{const h=new Date(m.visitDate),S=new Date(a.visitDate);return h.getMonth()===S.getMonth()&&h.getFullYear()===S.getFullYear()&&m.status!=="cancelled"});return D.length>5&&r.push({id:"conflict-overload",type:"date",severity:"warning",message:"Charge élevée ce mois",details:`${D.length} visites programmées ce mois`,suggestions:[{id:"suggest-next-month",type:"reschedule",description:"Déplacer au mois suivant",impact:"medium"}]}),r},[a,t,u]),b=r=>{switch(r){case"critical":return"text-red-600 bg-red-100 dark:bg-red-900/20";case"warning":return"text-orange-600 bg-orange-100 dark:bg-orange-900/20";case"info":return"text-blue-600 bg-blue-100 dark:bg-blue-900/20"}},x=r=>{switch(r){case"critical":return e.jsx(he,{className:"w-5 h-5"});case"warning":return e.jsx(le,{className:"w-5 h-5"});case"info":return e.jsx(me,{className:"w-5 h-5"})}},k=(r,o)=>{f(C=>{const v=new Map(C);return v.set(r,o),v})},j=()=>{n.forEach((r,o)=>{c&&c({conflictId:o,suggestionId:r,action:"apply"})}),g()};return e.jsx(K,{isOpen:l,onClose:g,title:"Détection de Conflits",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx(I,{className:"w-6 h-6 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:a.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(a.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," ","à ",a.visitTime]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-orange-500"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:[p.length," conflit",p.length>1?"s":""," détecté",p.length>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"danger",children:[p.filter(r=>r.severity==="critical").length," critique",p.filter(r=>r.severity==="critical").length>1?"s":""]}),e.jsxs(O,{variant:"warning",children:[p.filter(r=>r.severity==="warning").length," avertissement",p.filter(r=>r.severity==="warning").length>1?"s":""]})]})]}),p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(me,{className:"w-16 h-16 mx-auto mb-4 text-green-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun conflit détecté"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Cette visite peut être programmée sans problème"})]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:p.map(r=>e.jsx(B,{className:`border-l-4 ${r.severity==="critical"?"border-l-red-600":r.severity==="warning"?"border-l-orange-500":"border-l-blue-500"}`,children:e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${b(r.severity)}`,children:x(r.severity)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:r.message}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:r.details})]})]}),r.suggestions.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Solutions suggérées :"}),r.suggestions.map(o=>e.jsx("button",{onClick:()=>k(r.id,o.id),className:`w-full text-left p-3 rounded-lg border-2 transition-all ${n.get(r.id)===o.id?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:o.description})]}),e.jsxs(O,{variant:o.impact==="high"?"danger":o.impact==="medium"?"warning":"default",children:["Impact"," ",o.impact==="high"?"élevé":o.impact==="medium"?"moyen":"faible"]})]})},o.id))]})]})},r.id))}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(T,{variant:"secondary",onClick:g,children:"Annuler"}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"outline",onClick:()=>{p.forEach(r=>{c&&c({conflictId:r.id,suggestionId:"",action:"ignore"})}),g()},children:"Ignorer les conflits"}),e.jsxs(T,{variant:"primary",onClick:j,disabled:n.size===0,children:["Appliquer les solutions (",n.size,")"]})]})]})]})})},ge=[{value:"speaker_unavailable",label:"Orateur indisponible",icon:"👤"},{value:"host_unavailable",label:"Hôte indisponible",icon:"🏠"},{value:"congregation_conflict",label:"Conflit de congrégation",icon:"⚠️"},{value:"weather",label:"Conditions météo",icon:"🌧️"},{value:"health",label:"Raisons de santé",icon:"🏥"},{value:"emergency",label:"Urgence",icon:"🚨"},{value:"duplicate",label:"Doublon détecté",icon:"📋"},{value:"other",label:"Autre raison",icon:"📝"}],Aa=({isOpen:l,onClose:g,visit:a,onCancel:c})=>{const[t,u]=d.useState(null),[n,f]=d.useState(""),[p,b]=d.useState(!0),[x,k]=d.useState(!0),[j,r]=d.useState(!1),[o,C]=d.useState(""),[v,D]=d.useState(""),[m,h]=d.useState(!1),S=()=>{if(!t)return;const s={visitId:a.visitId,reason:t,customReason:t==="other"?n:void 0,notifySpeaker:p,notifyHost:x,proposeReschedule:j,suggestedNewDate:j?o:void 0,internalNotes:v,cancelledBy:"Coordinateur",cancelledAt:new Date().toISOString()};c(s),g()},F=()=>{const s=ge.find(N=>N.value===t);return`Bonjour ${a.nom},

Nous sommes au regret de vous informer que la visite prévue le ${new Date(a.visitDate).toLocaleDateString("fr-FR")} doit être annulée.

Raison : ${s?.label}${t==="other"&&n?` - ${n}`:""}

${j&&o?`Nous vous proposons de reprogrammer cette visite le ${new Date(o).toLocaleDateString("fr-FR")}.

`:""}Nous vous contacterons prochainement pour convenir d'une nouvelle date.

Cordialement,
KBV Lyon`};return m?e.jsx(K,{isOpen:l,onClose:g,title:"Confirmer l'annulation",size:"md",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(le,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200 mb-2",children:"Attention : Action irréversible"}),e.jsx("p",{className:"text-sm text-red-800 dark:text-red-300",children:"Vous êtes sur le point d'annuler définitivement cette visite. Cette action ne peut pas être annulée."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Orateur"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:a.nom})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Date"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:new Date(a.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Raison"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:ge.find(s=>s.value===t)?.label})]})]}),(p||x)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Notifications à envoyer"})]}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-300 space-y-1",children:[p&&e.jsxs("li",{children:["• Notification à l'orateur (",a.nom,")"]}),x&&e.jsxs("li",{children:["• Notification à l'hôte (",a.host,")"]})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(T,{variant:"secondary",onClick:()=>h(!1),children:"Retour"}),e.jsxs(T,{variant:"danger",onClick:S,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Confirmer l'annulation"]})]})]})}):e.jsx(K,{isOpen:l,onClose:g,title:"Annuler une visite",size:"lg",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(I,{className:"w-5 h-5 text-primary-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:a.nom}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[new Date(a.visitDate).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"})," ","à ",a.visitTime]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Discours :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:a.talkNoOrType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Hôte :"}),e.jsx("span",{className:"ml-2 text-gray-900 dark:text-white",children:a.host})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Raison de l'annulation *"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ge.map(s=>e.jsx("button",{onClick:()=>u(s.value),className:`p-3 rounded-lg border-2 text-left transition-all ${t===s.value?"border-primary-500 bg-primary-50 dark:bg-primary-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:s.icon}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.label})]})},s.value))})]}),t==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Précisez la raison"}),e.jsx("textarea",{value:n,onChange:s=>f(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:3,placeholder:"Décrivez la raison de l'annulation..."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Notifications"}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>b(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'orateur"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation à ",a.nom]})]})]}),e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:s=>k(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Notifier l'hôte"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Envoyer un message d'annulation à ",a.host]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:s=>r(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ma,{className:"w-4 h-4 text-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Proposer une reprogrammation"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Suggérer une nouvelle date dans le message d'annulation"})]})]}),j&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nouvelle date proposée"}),e.jsx("input",{type:"date",value:o,onChange:s=>C(s.target.value),min:new Date().toISOString().split("T")[0],"aria-label":"Nouvelle date proposée",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes internes (optionnel)"}),e.jsx("textarea",{value:v,onChange:s=>D(s.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:2,placeholder:"Notes pour l'équipe (non envoyées aux participants)..."})]}),(p||x)&&t&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900 dark:text-blue-200",children:"Aperçu du message"})]}),e.jsx("pre",{className:"text-xs text-blue-800 dark:text-blue-300 whitespace-pre-wrap font-sans",children:F()})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(T,{variant:"secondary",onClick:g,children:"Annuler"}),e.jsxs(T,{variant:"danger",onClick:()=>h(!0),disabled:!t||t==="other"&&!n,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Annuler la visite"]})]})]})})},La=({isOpen:l,onClose:g,visit:a,onSelectReplacement:c})=>{const{speakers:t,visits:u}=J(),[n,f]=d.useState(""),[p,b]=d.useState(!1),[x,k]=d.useState(!0),[j,r]=d.useState(null),[o,C]=d.useState(!0),[v,D]=d.useState(!1),m=d.useMemo(()=>{const s=[];return t.forEach(N=>{if(N.id===a.id)return;let A=0;const z=[],_=[],i=N.talkHistory.map(L=>L.talkNo.toString());if(a.talkNoOrType&&i.includes(a.talkNoOrType)?(A+=50,z.push("Possède le même discours"),_.push(a.talkNoOrType)):i.forEach(L=>_.push(L)),!u.some(L=>L.id===N.id&&L.visitDate===a.visitDate&&L.status!=="cancelled"))A+=30,z.push("Disponible à cette date");else{if(x)return;z.push("⚠️ Déjà programmé ce jour")}N.congregation===a.congregation&&(A+=20,z.push("Même congrégation")),u.filter(L=>L.id===N.id&&L.status==="completed"&&new Date(L.visitDate)>new Date(Date.now()-2160*60*60*1e3)).length===0&&(A+=15,z.push("Pas de visite récente")),N.isVehiculed&&(A+=10,z.push("Véhiculé")),N.telephone&&(A+=5,z.push("Téléphone disponible"));const X=u.filter(L=>L.id===N.id&&L.status==="completed").sort((L,ce)=>new Date(ce.visitDate).getTime()-new Date(L.visitDate).getTime())[0];s.push({speaker:N,score:A,reasons:z,availableTalks:_,lastVisit:X?.visitDate})}),s.sort((N,A)=>A.score-N.score).filter(N=>n?N.speaker.nom.toLowerCase().includes(n.toLowerCase())||N.speaker.congregation.toLowerCase().includes(n.toLowerCase()):!0)},[t,u,a,n,x]),h=()=>{j&&(c(j,o),g())},S=s=>s>=80?"text-green-600 bg-green-100 dark:bg-green-900/20":s>=50?"text-blue-600 bg-blue-100 dark:bg-blue-900/20":s>=30?"text-orange-600 bg-orange-100 dark:bg-orange-900/20":"text-gray-600 bg-gray-100 dark:bg-gray-900/20",F=s=>s>=80?"Excellent match":s>=50?"Bon match":s>=30?"Match acceptable":"Match faible";return e.jsx(K,{isOpen:l,onClose:g,title:"Trouver un remplaçant d'urgence",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[e.jsx(fe,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-red-900 dark:text-red-200",children:"Remplacement d'urgence requis"}),e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300 mt-1",children:["Visite de ",e.jsx("strong",{children:a.nom})," le"," ",e.jsx("strong",{children:new Date(a.visitDate).toLocaleDateString("fr-FR")})," à"," ",e.jsx("strong",{children:a.visitTime})]}),a.talkNoOrType&&e.jsxs("p",{className:"text-sm text-red-800 dark:text-red-300",children:["Discours : ",e.jsx("strong",{children:a.talkNoOrType})," - ",a.talkTheme]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:s=>f(s.target.value),placeholder:"Rechercher un orateur...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs(T,{variant:"outline",onClick:()=>D(!v),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Filtres"]})]}),v&&e.jsxs("div",{className:"flex gap-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:s=>k(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Uniquement disponibles"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:s=>b(s.target.checked),className:"w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Proximité géographique"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:m.length}),e.jsx("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:"Orateurs trouvés"})]}),e.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.filter(s=>s.score>=50).length}),e.jsx("div",{className:"text-sm text-green-800 dark:text-green-300",children:"Bons matchs"})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:m.filter(s=>s.availableTalks.includes(a.talkNoOrType||"")).length}),e.jsx("div",{className:"text-sm text-purple-800 dark:text-purple-300",children:"Même discours"})]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Aucun orateur trouvé"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Essayez de modifier vos critères de recherche"})]}):m.map(s=>e.jsx(B,{hoverable:!0,className:`cursor-pointer transition-all ${j?.id===s.speaker.id?"ring-2 ring-primary-500 bg-primary-50 dark:bg-primary-900/20":""}`,onClick:()=>r(s.speaker),children:e.jsx(H,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center text-primary-700 dark:text-primary-300 font-bold text-lg",children:s.speaker.nom.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:s.speaker.nom}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(de,{className:"w-3 h-3"}),s.speaker.congregation]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:s.reasons.map((N,A)=>e.jsx(O,{variant:"default",className:"text-xs",children:N},A))}),s.availableTalks.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Discours : "}),e.jsxs("span",{className:"text-gray-900 dark:text-white",children:[s.availableTalks.slice(0,5).join(", "),s.availableTalks.length>5&&` +${s.availableTalks.length-5}`]})]}),s.speaker.telephone&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(He,{className:"w-3 h-3"}),s.speaker.telephone]}),s.lastVisit&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500 dark:text-gray-500",children:[e.jsx(I,{className:"w-3 h-3"}),"Dernière visite : ",new Date(s.lastVisit).toLocaleDateString("fr-FR")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full ${S(s.score)}`,children:e.jsx("span",{className:"text-lg font-bold",children:s.score})}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:F(s.score)})]})]})})},s.speaker.id))}),j&&e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:s=>C(s.target.checked),className:"mt-1 w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900 dark:text-blue-200",children:"Envoyer une notification immédiate"})]}),e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-300 mt-1",children:["Un message sera envoyé à ",j.nom," pour l'informer du remplacement d'urgence"]})]})]})}),e.jsxs("div",{className:"flex gap-3 justify-end pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(T,{variant:"secondary",onClick:g,children:"Annuler"}),e.jsxs(T,{variant:"primary",onClick:h,disabled:!j,children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Sélectionner ce remplaçant"]})]})]})})},ae=d.memo(({icon:l,value:g,label:a,colorClasses:c})=>e.jsxs("div",{className:R("relative overflow-hidden rounded-2xl p-5 border transition-all duration-300 hover:scale-[1.02] shadow-sm",c.bg,"border-white/20 dark:border-gray-700/50"),children:[e.jsxs("div",{className:"relative z-10 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:R("text-xs font-bold uppercase tracking-widest mb-1",c.text,"opacity-70"),children:a}),e.jsx("h3",{className:R("text-3xl font-black tracking-tighter",c.text),children:g})]}),e.jsx("div",{className:R("p-3 rounded-xl",c.iconBg),children:e.jsx(l,{className:R("w-6 h-6",c.text)})})]}),e.jsx("div",{className:R("absolute -bottom-4 -right-4 w-24 h-24 rounded-full opacity-10",c.text,"bg-current blur-2xl")})]})),Ya=()=>{const{visits:l,archivedVisits:g}=J(),[a,c]=d.useState("cards"),[t,u]=d.useState(""),[n,f]=d.useState("all"),[p,b]=d.useState("all"),[x,k]=d.useState(!1),[j,r]=d.useState(!1),[o,C]=d.useState(!1),[v,D]=d.useState({start:null,end:null}),[m,h]=d.useState(null),[S,F]=d.useState("edit"),[s,N]=d.useState(!1),[A,z]=d.useState(!1),[_,i]=d.useState(!1),[w,M]=d.useState(!1),X=d.useRef(null),L=Ze.useReactToPrint({contentRef:X,documentTitle:`Planning-visites-${new Date().toLocaleDateString()}`}),ce=()=>{if(a==="archives"){const E=[["Date","Heure","Orateur","Congrégation","Discours","Thème","Hôte"].join(","),...g.map(V=>[V.visitDate,V.visitTime,`"${V.nom}"`,`"${V.congregation}"`,V.talkNoOrType||"",`"${V.talkTheme||""}"`,`"${V.host||""}"`].join(","))].join(`
`),Z=new Blob([E],{type:"text/csv;charset=utf-8;"}),$=document.createElement("a");$.href=URL.createObjectURL(Z),$.download=`visites_archivees_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild($),$.click(),document.body.removeChild($)}else a==="finance"||L()},Y=d.useCallback((y,E)=>{h(y),F(E),r(!0)},[]),Le=d.useCallback(()=>{r(!1),h(null)},[]),q=d.useMemo(()=>l.filter(y=>{const E=y.nom.toLowerCase().includes(t.toLowerCase())||y.congregation.toLowerCase().includes(t.toLowerCase())||y.talkNoOrType?.toLowerCase().includes(t.toLowerCase())||y.notes?.toLowerCase().includes(t.toLowerCase()),Z=n==="all"||y.status===n,$=p==="all"||y.locationType===p,V=new Date(y.visitDate),be=(!v.start||V>=v.start)&&(!v.end||V<=v.end);return E&&Z&&$&&be}).sort((y,E)=>new Date(y.visitDate).getTime()-new Date(E.visitDate).getTime()),[l,t,n,p,v]),Q=d.useMemo(()=>{const y=q.length,E=q.filter(V=>V.status==="confirmed").length,Z=q.filter(V=>V.status==="pending").length,$=q.filter(V=>new Date(V.visitDate)>=new Date&&V.status==="confirmed").length;return{total:y,confirmed:E,pending:Z,upcoming:$}},[q]),ee=({id:y,label:E,icon:Z,desc:$})=>e.jsxs("button",{onClick:()=>{c(y),M(!1)},className:R("w-full flex items-center gap-3 px-4 py-3 text-sm transition-colors group",a===y?"bg-primary-50 text-primary-700 dark:bg-primary-900/20 dark:text-primary-400":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700/50"),children:[e.jsx("div",{className:R("p-2 rounded-lg group-hover:bg-white dark:group-hover:bg-gray-800 transition-colors",a===y?"bg-white dark:bg-gray-800":"bg-gray-100 dark:bg-gray-800"),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-xs uppercase tracking-tight",children:E}),e.jsx("div",{className:"text-[10px] text-gray-500 dark:text-gray-400 mt-0.5",children:$})]})]});return e.jsxs("div",{className:"space-y-6 max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(O,{className:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300 border-none px-3 py-1 font-bold text-[10px] tracking-widest uppercase",children:"Planning"}),e.jsx("span",{className:"text-gray-400 text-xs font-medium",children:new Date().getFullYear()})]}),e.jsx("h1",{className:"text-3xl font-black text-gray-900 dark:text-white tracking-tighter",children:"Gestion des Visites"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{variant:"secondary",className:"font-bold border-gray-200 dark:border-gray-700 shadow-sm",leftIcon:e.jsx(Ce,{className:"w-4 h-4"}),onClick:ce,children:"Exporter"}),e.jsx(T,{className:"bg-indigo-600 hover:bg-indigo-700 text-white shadow-lg shadow-indigo-200 dark:shadow-none font-bold px-6",leftIcon:e.jsx(Fe,{className:"w-5 h-5"}),onClick:()=>k(!0),children:"Programmer"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ae,{icon:ya,value:Q.total,label:"Total Visites",colorClasses:{bg:"bg-blue-50 dark:bg-blue-900/10",text:"text-blue-600 dark:text-blue-400",iconBg:"bg-white dark:bg-blue-900/30"}}),e.jsx(ae,{icon:Be,value:Q.confirmed,label:"Confirmées",colorClasses:{bg:"bg-green-50 dark:bg-green-900/10",text:"text-green-600 dark:text-green-400",iconBg:"bg-white dark:bg-green-900/30"}}),e.jsx(ae,{icon:ne,value:Q.pending,label:"En Attente",colorClasses:{bg:"bg-orange-50 dark:bg-orange-900/10",text:"text-orange-600 dark:text-orange-400",iconBg:"bg-white dark:bg-orange-900/30"}}),e.jsx(ae,{icon:I,value:Q.upcoming,label:"À Venir",colorClasses:{bg:"bg-purple-50 dark:bg-purple-900/10",text:"text-purple-600 dark:text-purple-400",iconBg:"bg-white dark:bg-purple-900/30"}})]}),e.jsxs("div",{className:"sticky top-20 z-30 bg-white/80 dark:bg-gray-900/80 backdrop-blur-xl p-2 rounded-2xl border border-gray-200 dark:border-gray-800 shadow-sm flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"relative flex-1 group",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 group-focus-within:text-indigo-500 transition-colors"}),e.jsx("input",{type:"text",placeholder:"Rechercher orateur, congrégation...",value:t,onChange:y=>u(y.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 dark:bg-gray-800 border-none rounded-xl text-sm font-medium focus:ring-2 focus:ring-indigo-500/20 transition-all placeholder:text-gray-400"})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 md:pb-0 scrollbar-none",children:[e.jsxs("button",{onClick:()=>C(!0),className:R("flex items-center gap-2 px-4 py-2.5 rounded-xl text-sm font-bold transition-all border shrink-0",n!=="all"||p!=="all"?"bg-indigo-50 text-indigo-600 border-indigo-200 dark:bg-indigo-900/20 dark:border-indigo-800":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-700 hover:border-gray-300"),children:[e.jsx(Me,{className:"w-4 h-4"}),e.jsx("span",{children:"Filtres"}),(n!=="all"||p!=="all")&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-indigo-500 ml-1"})]}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-1 rounded-xl flex items-center shrink-0",children:[{id:"cards",icon:Ge},{id:"list",icon:fa},{id:"calendar",icon:I}].map(y=>e.jsx("button",{onClick:()=>c(y.id),className:R("p-2 rounded-lg transition-all",a===y.id?"bg-white dark:bg-gray-700 text-indigo-600 dark:text-indigo-400 shadow-sm":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"),children:e.jsx(y.icon,{className:"w-4 h-4"})},y.id))}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>M(!w),className:R("flex items-center gap-2 px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-wide transition-all border shrink-0",["timeline","workload","finance","archives"].includes(a)?"bg-gray-900 text-white dark:bg-white dark:text-gray-900 border-transparent shadow-lg":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border-gray-200 dark:border-gray-700 hover:border-gray-300"),children:[e.jsx("span",{children:"Vues Avancées"}),e.jsx(ga,{className:"w-3 h-3"})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>M(!1)}),e.jsx("div",{className:"absolute right-0 top-full mt-2 w-56 bg-white dark:bg-gray-900 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-800 z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200",children:e.jsxs("div",{className:"p-2 space-y-1",children:[e.jsx("div",{className:"px-3 py-2 text-[10px] uppercase font-black tracking-widest text-gray-400",children:"Analyses"}),e.jsx(ee,{id:"timeline",label:"Chronologie",icon:ba,desc:"Vue temporelle verticale"}),e.jsx(ee,{id:"workload",label:"Disponibilité",icon:ua,desc:"Charge des orateurs"}),e.jsx(ee,{id:"finance",label:"Finances",icon:Ae,desc:"Suivi des dépenses"}),e.jsx("div",{className:"my-1 border-t border-gray-100 dark:border-gray-800"}),e.jsx(ee,{id:"archives",label:"Archives",icon:oe,desc:"Historique complet"})]})})]})]})]})]}),(n!=="all"||p!=="all")&&e.jsxs("div",{className:"flex flex-wrap gap-2 animate-in fade-in slide-in-from-top-2",children:[n!=="all"&&e.jsxs(O,{variant:"primary",className:"pl-2 pr-1 py-1 flex items-center gap-1",children:["Statut: ",n,e.jsx("button",{onClick:()=>f("all"),className:"p-0.5 hover:bg-white/20 rounded-full",children:e.jsx(je,{className:"w-3 h-3"})})]}),p!=="all"&&e.jsxs(O,{variant:"default",className:"pl-2 pr-1 py-1 flex items-center gap-1 bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",children:["Type: ",p,e.jsx("button",{onClick:()=>b("all"),className:"p-0.5 hover:bg-black/10 dark:hover:bg-white/10 rounded-full",children:e.jsx(je,{className:"w-3 h-3"})})]}),e.jsx("button",{onClick:()=>{f("all"),b("all")},className:"text-xs text-gray-500 hover:text-red-500 font-medium underline px-2",children:"Tout effacer"})]}),e.jsxs("div",{className:"min-h-[500px] animate-in fade-in duration-500",ref:X,children:[a==="cards"&&e.jsx("div",{className:"bg-transparent",children:e.jsx(Na,{visits:q,onVisitAction:Y,onVisitClick:y=>Y(y,"edit")})}),a==="list"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",children:e.jsx(va,{visits:q,onVisitAction:Y,onVisitClick:y=>Y(y,"edit")})}),a==="calendar"&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 p-4",children:e.jsx(wa,{visits:q,onVisitClick:y=>Y(y,"edit")})}),a==="timeline"&&e.jsx(Sa,{visits:q}),a==="workload"&&e.jsx(Ca,{}),a==="finance"&&e.jsx("div",{className:"rounded-3xl overflow-hidden",children:e.jsx(Ta,{})}),a==="archives"&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl border border-gray-200 dark:border-gray-700 p-8 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded-2xl",children:e.jsx(oe,{className:"w-6 h-6 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black text-gray-900 dark:text-white tracking-tight",children:"Visites archivées"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[g.length," visite(s) dans l'historique"]})]})]}),g.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-900/50 rounded-2xl border-2 border-dashed border-gray-200 dark:border-gray-700",children:[e.jsx(oe,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-sm font-bold text-gray-900 dark:text-white uppercase tracking-widest mb-1",children:"Aucune archive"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Les visites terminées apparaîtront ici automatiquement."})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:g.sort((y,E)=>new Date(E.visitDate).getTime()-new Date(y.visitDate).getTime()).map(y=>e.jsxs("div",{className:"group bg-gray-50 dark:bg-gray-900/30 rounded-2xl border border-gray-200 dark:border-gray-700 p-5 hover:border-gray-300 dark:hover:border-gray-600 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:y.nom}),e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mt-1",children:y.congregation})]}),e.jsx(O,{variant:"success",className:"text-[10px] px-2 py-0.5",children:"Terminée"})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4",children:[e.jsxs("div",{className:"flex justify-between py-1 border-b border-gray-100 dark:border-gray-700/50",children:[e.jsx("span",{className:"text-gray-500 text-xs uppercase font-bold tracking-wider",children:"Date"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-200",children:new Date(y.visitDate).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"flex justify-between py-1 border-b border-gray-100 dark:border-gray-700/50",children:[e.jsx("span",{className:"text-gray-500 text-xs uppercase font-bold tracking-wider",children:"Numéro"}),e.jsx("span",{className:"font-medium",children:y.talkNoOrType||"-"})]})]}),e.jsxs("div",{className:"mt-4 flex gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx(T,{variant:"secondary",className:"flex-1 text-xs h-8",onClick:()=>Y(y,"message"),leftIcon:e.jsx(ie,{className:"w-3 h-3"}),children:"Message"}),e.jsx(T,{variant:"secondary",className:"flex-1 text-xs h-8",onClick:()=>Y(y,"feedback"),leftIcon:e.jsx(Se,{className:"w-3 h-3"}),children:"Bilan"})]})]},y.visitId))})]})]}),e.jsx(Da,{isOpen:x,onClose:()=>k(!1)}),e.jsx(Ke,{isOpen:j,onClose:Le,visit:m,action:S}),e.jsx(Ma,{isOpen:o,onClose:()=>C(!1),dateRange:v,setDateRange:D,statusFilter:n,setStatusFilter:f,typeFilter:p,setTypeFilter:b}),m&&e.jsxs(e.Fragment,{children:[e.jsx(Oa,{isOpen:s,onClose:()=>N(!1),visit:m,onResolve:y=>N(!1)}),e.jsx(Aa,{isOpen:A,onClose:()=>z(!1),visit:m,onCancel:()=>z(!1)}),e.jsx(La,{isOpen:_,onClose:()=>i(!1),visit:m,onSelectReplacement:()=>i(!1)})]})]})};export{Ya as Planning};
//# sourceMappingURL=Planning-Dgj94j7O.js.map
