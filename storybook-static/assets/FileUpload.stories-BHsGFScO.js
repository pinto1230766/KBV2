import{r as t,j as r}from"./iframe-BdHU-FLj.js";import{B as L}from"./Button-2jS3QZp2.js";import{c as U}from"./cn-BB8OEnXs.js";import{c as I}from"./createLucideIcon-ClzONTEY.js";import{C as H}from"./check-circle-DHBlsod4.js";import{X as K}from"./x-BC62ssot.js";import"./preload-helper-PPVm8Dsz.js";import"./bundle-mjs-BNe0Xlio.js";const X=I("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);const Z=I("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);const _=I("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),J={defaultSrc:["'self'"],scriptSrc:["'self'","'unsafe-inline'","'unsafe-eval'","https://cdn.jsdelivr.net","https://unpkg.com"],styleSrc:["'self'","'unsafe-inline'","https://fonts.googleapis.com"],imgSrc:["'self'","data:","blob:","https:","http:"],fontSrc:["'self'","https://fonts.gstatic.com","data:"],connectSrc:["'self'","https://api.kbv-lyon.fr","wss:","https:","http:"],frameSrc:["'none'"],objectSrc:["'none'"],mediaSrc:["'self'","blob:","data:"],workerSrc:["'self'","blob:"],manifestSrc:["'self'"],baseUri:["'self'"],formAction:["'self'"],frameAncestors:["'none'"]};function Q(){const s=[];for(const[c,a]of Object.entries(J)){const d=c.replace(/([A-Z])/g,"-$1").toLowerCase();Array.isArray(a)&&a.length>0?s.push(`${d} ${a.join(" ")}`):typeof a=="string"&&s.push(`${d} ${a}`)}return s.join("; ")}Q();function Y(s,c={}){const{maxSize:a=5*1024*1024,allowedTypes:d=["image/jpeg","image/png","image/gif","application/pdf"],allowedExtensions:g=[".jpg",".jpeg",".png",".gif",".pdf"]}=c;if(s.size>a)return{valid:!1,error:`File size exceeds maximum allowed size of ${a/(1024*1024)}MB`};if(!d.includes(s.type))return{valid:!1,error:`File type ${s.type} is not allowed`};const y=s.name.toLowerCase();return g.some(f=>y.endsWith(f))?{valid:!0}:{valid:!1,error:"File extension is not allowed"}}function ee(){const[s,c]=t.useState([]),a=t.useCallback((n,l,o,x={})=>{const k=`notification-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,v=x.duration??(n==="error"?8e3:5e3),F={id:k,type:n,title:l,message:o,duration:v,persistent:x.persistent??!1,action:x.action,retry:x.retry,timestamp:new Date};return c(j=>[...j,F]),!F.persistent&&v>0&&setTimeout(()=>{f(k)},v),k},[]),d=t.useCallback((n,l,o)=>a("error",n,l,o),[a]),g=t.useCallback((n,l,o)=>a("warning",n,l,o),[a]),y=t.useCallback((n,l,o)=>a("info",n,l,o),[a]),S=t.useCallback((n,l,o)=>a("success",n,l,{...o,duration:3e3}),[a]),f=t.useCallback(n=>{c(l=>l.filter(o=>o.id!==n))},[]),N=t.useCallback(()=>{c([])},[]),m=t.useCallback(()=>{c(n=>n.filter(l=>l.type!=="error"))},[]),w=t.useCallback(()=>s.filter(n=>n.type==="error"),[s]);return{notifications:s,showError:d,showWarning:g,showInfo:y,showSuccess:S,dismissNotification:f,dismissAll:N,clearErrors:m,getErrors:w}}function O({onFilesSelected:s,onFileRejected:c,accept:a="image/*,.pdf",multiple:d=!1,maxFiles:g=5,maxSize:y=5*1024*1024,className:S,disabled:f=!1,showPreview:N=!0}){const[m,w]=t.useState([]),[n,l]=t.useState(!1),{showError:o,showSuccess:x}=ee(),k=["image/jpeg","image/jpg","image/png","image/gif","image/webp","application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],v=[".jpg",".jpeg",".png",".gif",".webp",".pdf",".txt",".doc",".docx"],F=t.useCallback(e=>{const i=Y(e,{maxSize:y,allowedTypes:k,allowedExtensions:v}),h={file:e,isValid:i.valid,error:i.error};if(i.valid&&e.type.startsWith("image/")&&N){const u=new FileReader;u.onload=C=>{w(p=>p.map(P=>P.file===e?{...P,preview:C.target?.result}:P))},u.readAsDataURL(e)}return h},[y,N]),j=t.useCallback(e=>{if(!e)return;const i=Array.from(e);if(m.length+i.length>g){o("Trop de fichiers",`Maximum ${g} fichiers autorisés (${m.length} déjà sélectionnés)`);return}const h=i.map(F),u=h.filter(p=>p.isValid),C=h.filter(p=>!p.isValid);u.length>0&&(w(p=>[...p,...u]),s(u.map(p=>p.file)),u.length===i.length?x("Succès",`${u.length} fichier(s) ajouté(s) avec succès`):o("Fichiers partiellement acceptés",`${u.length}/${i.length} fichiers acceptés`)),C.length>0&&C.forEach(p=>{p.error&&(o("Fichier refusé",`${p.file.name}: ${p.error}`),c?.(p.error))})},[m.length,g,F,s,c,o,x]),R=t.useCallback(e=>{w(i=>i.filter((h,u)=>u!==e))},[]),V=t.useCallback(e=>{e.preventDefault(),l(!1),j(e.dataTransfer.files)},[j]),W=t.useCallback(e=>{e.preventDefault(),l(!0)},[]),G=t.useCallback(e=>{e.preventDefault(),l(!1)},[]),B=t.useCallback(()=>{const e=document.createElement("input");e.type="file",e.accept=a,e.multiple=d,e.onchange=i=>{const h=i.target;j(h.files)},e.click()},[a,d,j]);return r.jsxs("div",{className:U("space-y-4",S),children:[r.jsxs("div",{className:U("border-2 border-dashed rounded-lg p-6 text-center transition-colors cursor-pointer",n?"border-blue-500 bg-blue-50 dark:bg-blue-950":"border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500",f&&"opacity-50 cursor-not-allowed"),onDrop:V,onDragOver:W,onDragLeave:G,onClick:f?void 0:B,children:[r.jsx(_,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Glissez-déposez vos fichiers ici ou cliquez pour sélectionner"}),r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:["Formats acceptés: ",v.join(", ")," • Taille max:"," ",Math.round(y/(1024*1024)),"MB"]}),d&&r.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:["Maximum ",g," fichiers"]})]}),m.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["Fichiers sélectionnés (",m.length,")"]}),r.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:m.map((e,i)=>r.jsxs("div",{className:U("flex items-center space-x-3 p-3 rounded-lg border",e.isValid?"border-green-200 bg-green-50 dark:border-green-800 dark:bg-green-950":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-950"),children:[e.preview&&r.jsx("img",{src:e.preview,alt:e.file.name,className:"w-10 h-10 object-cover rounded"}),!e.preview&&r.jsx(Z,{className:"w-10 h-10 text-gray-400"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:U("text-sm font-medium truncate",e.isValid?"text-green-900 dark:text-green-100":"text-red-900 dark:text-red-100"),children:e.file.name}),r.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400",children:[r.jsxs("span",{children:[Math.round(e.file.size/1024)," KB"]}),r.jsx("span",{children:"•"}),r.jsx("span",{children:e.file.type})]}),e.error&&r.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:e.error})]}),r.jsx("div",{className:"flex-shrink-0",children:e.isValid?r.jsx(H,{className:"w-5 h-5 text-green-500"}):r.jsx(X,{className:"w-5 h-5 text-red-500"})}),r.jsx("button",{onClick:h=>{h.stopPropagation(),R(i)},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Supprimer le fichier",children:r.jsx(K,{className:"w-4 h-4"})})]},`${e.file.name}-${i}`))})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(L,{onClick:B,disabled:f,variant:"outline",leftIcon:r.jsx(_,{className:"w-4 h-4"}),children:d?"Ajouter des fichiers":"Sélectionner un fichier"}),m.length>0&&r.jsxs(L,{onClick:()=>{const e=m.filter(i=>i.isValid).map(i=>i.file);s(e),x("Succès",`${e.length} fichier(s) prêt(s) pour l'upload`)},disabled:f||m.every(e=>!e.isValid),variant:"primary",children:["Confirmer (",m.filter(e=>e.isValid).length,")"]})]})]})}O.__docgenInfo={description:"",methods:[],displayName:"FileUpload",props:{onFilesSelected:{required:!0,tsType:{name:"signature",type:"function",raw:"(files: File[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"File"}],raw:"File[]"},name:"files"}],return:{name:"void"}}},description:""},onFileRejected:{required:!1,tsType:{name:"signature",type:"function",raw:"(reason: string) => void",signature:{arguments:[{type:{name:"string"},name:"reason"}],return:{name:"void"}}},description:""},accept:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'image/*,.pdf'",computed:!1}},multiple:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},maxFiles:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5",computed:!1}},maxSize:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"5 * 1024 * 1024",computed:!1}},className:{required:!1,tsType:{name:"string"},description:""},disabled:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},showPreview:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};const ce={title:"UI/FileUpload",component:O,parameters:{layout:"centered"},tags:["autodocs"]},b=s=>{const[c,a]=t.useState([]);return r.jsxs("div",{className:"w-96",children:[r.jsx(O,{...s,onFilesSelected:a}),c.length>0&&r.jsxs("div",{className:"mt-4",children:[r.jsx("h3",{className:"font-semibold",children:"Fichiers sélectionnés:"}),r.jsx("ul",{className:"list-disc pl-5",children:c.map((d,g)=>r.jsxs("li",{children:[d.name," (",Math.round(d.size/1024)," KB)"]},g))})]})]})},D={render:s=>r.jsx(b,{...s}),args:{label:"Upload de fichiers"}},$={render:s=>r.jsx(b,{...s}),args:{label:"Upload d'images",accept:"image/*"}},T={render:s=>r.jsx(b,{...s}),args:{label:"Upload de PDF",accept:".pdf"}},q={render:s=>r.jsx(b,{...s}),args:{label:"Fichiers multiples",multiple:!0,maxFiles:5}},A={render:s=>r.jsx(b,{...s}),args:{label:"Taille limitée à 2 MB",maxSize:2*1024*1024}},E={render:s=>r.jsx(b,{...s}),args:{label:"Upload obligatoire",required:!0}},M={render:s=>r.jsx(b,{...s}),args:{label:"Upload désactivé",disabled:!0}},z={render:s=>r.jsx(b,{...s}),args:{label:"Upload avec prévisualisation",accept:"image/*",showPreview:!0}};D.parameters={...D.parameters,docs:{...D.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload de fichiers'
  }
}`,...D.parameters?.docs?.source}}};$.parameters={...$.parameters,docs:{...$.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload d\\'images',
    accept: 'image/*'
  }
}`,...$.parameters?.docs?.source}}};T.parameters={...T.parameters,docs:{...T.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload de PDF',
    accept: '.pdf'
  }
}`,...T.parameters?.docs?.source}}};q.parameters={...q.parameters,docs:{...q.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Fichiers multiples',
    multiple: true,
    maxFiles: 5
  }
}`,...q.parameters?.docs?.source}}};A.parameters={...A.parameters,docs:{...A.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Taille limitée à 2 MB',
    maxSize: 2 * 1024 * 1024
  }
}`,...A.parameters?.docs?.source}}};E.parameters={...E.parameters,docs:{...E.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload obligatoire',
    required: true
  }
}`,...E.parameters?.docs?.source}}};M.parameters={...M.parameters,docs:{...M.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload désactivé',
    disabled: true
  }
}`,...M.parameters?.docs?.source}}};z.parameters={...z.parameters,docs:{...z.parameters?.docs,source:{originalSource:`{
  render: args => <FileUploadWithState {...args} />,
  args: {
    label: 'Upload avec prévisualisation',
    accept: 'image/*',
    showPreview: true
  }
}`,...z.parameters?.docs?.source}}};const de=["Default","ImagesOnly","PDFOnly","MultipleFiles","WithSizeLimit","Required","Disabled","WithPreview"];export{D as Default,M as Disabled,$ as ImagesOnly,q as MultipleFiles,T as PDFOnly,E as Required,z as WithPreview,A as WithSizeLimit,de as __namedExportsOrder,ce as default};
